{
  "santabaRelease": 229,
  "defaultDashboardFilters": {
    "defaultDashboardFilterDetails": []
  },
  "widgetTokens": [
    {
      "name": "MapGroupPathFilter",
      "value": "*"
    },
    {
      "name": "MapShowWeather",
      "value": "global"
    },
    {
      "name": "MapIgnoreCleared",
      "value": "false"
    },
    {
      "name": "MapSourceType",
      "value": "resources"
    },
    {
      "name": "HideMapOptions",
      "value": "false"
    },
    {
      "name": "MapOverlayOption",
      "value": "wildfires"
    },
    {
      "name": "MapIgnoreWarnings",
      "value": "false"
    },
    {
      "name": "MapIgnoreErrors",
      "value": "false"
    },
    {
      "name": "MapIgnoreCriticals",
      "value": "false"
    },
    {
      "name": "isMapWidgetVirtualizationDisabled",
      "value": "true"
    },
    {
      "name": "AutoResetMapOnRefresh",
      "value": "false"
    },
    {
      "name": "MapShowTiltControls",
      "value": "false"
    },
    {
      "name": "MapDisplayProperties",
      "value": "region"
    },
    {
      "name": "MapDisableClustering",
      "value": "false"
    },
    {
      "name": "MapStyle",
      "value": "silver"
    }
  ],
  "name": "Better Map Widget",
  "description": "This is a custom-developed widget to demonstrate several concepts I'd love to see rolled into LogicMonitor's core Map widget.",
  "overwriteGroupFields": false,
  "widgetsConfigVersion": 2,
  "type": "dashboard",
  "widgets": [
    {
      "position": {
        "col": 1,
        "sizex": 10,
        "row": 1,
        "sizey": 12
      },
      "config": {
        "displaySettings": {},
        "isSupportCustomProperty": false,
        "supportCustomProperty": false,
        "name": "Better Map Widget",
        "description": "",
        "theme": "newBorderGray",
        "interval": 15,
        "type": "text",
        "timescale": "day",
        "version": 2,
        "content": "<!--\n\tBetter Map Widget\n\tDeveloped by Kevin Ford\n\tVersion 2.78 - Integrated Authentication Version\n\tIntegrated authentication improvements by Steve Villardi\n\n\tSome of the ideas behind this project:\n\t* Support for thousands pins on the map, though be aware that Google Maps will start to struggle if too many pins.\n\t* Adjacent pins get grouped/clustered together for a cleaner map display.\n\t* Clusters use a donut chart to represent the severities of the grouped markers.\n\t* Easy toggling of weather layers.\n\t* Display more information when clicking a marker.\n\t* Quick & easy filtering of what's displayed on the map.\n\t* Provide a way to plot connections between resources (and eventually groups).\n\n\tPrerequisites:\n\t* The user needs \"View\" permissions to the dashboard plus any displayed groups and/or resources.\n\t* Group's or resources with valid addresses set in the usual 'location' property.\n\n\tTO USE:\n\t1. Create a new Text widget to the dashboard.\n\t2. On the Text widget's edit dialog, click the \"Source\" button and paste in the contents of this script, then save the widget.\n\t3. At this point the widget should be ready to use. You can customize the defaults for the widget either via dashboard tokens or by changing variables here within the script.\n\t   For instance, the script defaults to using \"*\" for the group filter. You can change the default by setting a \"MapGroupPathFilter\" dashboard token, or by hard-coding it in the script's \"groupPathFilter\" variable below.\n\t   NOTE: defaults set via dashboard tokens will take precedence over those hard-coded in the script.\n\n\tOPTIONAL DASHBOARD TOKENS:\n\t* 'MapGroupPathFilter': Allows setting a default group path to start. Default is \"*\".\n\t* 'MapShowWeather': If weather should be shown by default. Options are \"global\" or \"nexrad\". Default is \"global\".\n\t* 'MapOverlayOption': Which optional overlay to default to when weather is shown. Options are \"wildfires\", \"outages\" or \"earthquakes\". Default is \"wildfires\".\n\t* 'HideMapOptions': If \"true\" then will hide the options bar by default. Default is \"false\".\n\t* 'MapSourceType': Whether to map \"groups\", \"resources\", or \"services\". Default is \"groups\".\n\t* 'MapIgnoreCleared': If \"true\" then will only show items currently alerting (useful for maps with thousands of markers). Default is \"false\".\n\t* 'MapIgnoreWarnings': If \"true\" then won't show items in \"Warning\" status. Default is \"false\".\n\t* 'MapIgnoreErrors': If \"true\" then won't show items in \"Error\" status. Default is \"false\".\n\t* 'MapIgnoreCriticals': If \"true\" then won't show items in \"Critical\" status. Default is \"false\".\n\t* 'AutoResetMapOnRefresh': If \"true\" then the map will automatically zoom to encompass all items on timed refreshes. Default is \"false\".\n\t* 'MapShowTiltControls': If \"true\" then the tilt & rotation controls for the map will be shown. Default is \"false\".\n\t* 'MapDisableClustering': If \"true\" then clustering of adjacent markers on the map will be disabled. Might be desirable if showing connections between locations since clustering might hide markers at certain zoom levels. Default is \"false\".\n\t* 'MapDisplayProperties': An optional comma-delimited list of custom properties to show when viewing a group's/resource's details.\n\t* 'MapStyle': Allows one of the following available map style options: \"silver\", \"standard\", \"dark\", \"aubergine\", or \"silverblue\". Default is \"silver\".\n\n\tLIMITATIONS:\n\t* This widget is currently unable to leverage LogicMonitor's native dashboard filters.\n\t* Being custom-developed, LogicMonitor's support teams will be limited in what they can assist with regarding questions/issues.\n--><script>\n\t// Whether we're plotting \"groups\" or \"resources\" or \"services\" (strongly recommend staying with groups or services)...\n\t// You can either set it here or in a dashboard token named 'MapSourceType'...\n\tlet mapSourceType = \"groups\";\n\n\t// Preferred map style. Available options: \"silver\" (the default), \"standard\", \"dark\", \"aubergine\", or \"silverBlue\"...\n\tlet mapStyle = \"silver\";\n\n\t// Whether to ignore items with no active alerts (useful for maps with thousands of markers)...\n\t// You can either set it here or in a dashboard token named 'MapIgnoreCleared'...\n\tlet showCleared = true;\n\tlet showWarnings = true;\n\tlet showErrors = true;\n\tlet showCriticals = true;\n\tlet showSDT = true;\n\n\t// Capture if a group filter...\n\t// You can set it here or in a dashboard token named \"MapGroupPathFilter\"...\n\tlet groupPathFilter = \"*\";\n\n\t// Interval for updating group status data (in minutes)...\n\tlet statusUpdateIntervalMinutes = 2;\n\n\t// Flag to disable marker clustering if needed...\n\tlet disableClustering = false;\n\n\t// Whether to show weather by default. Options are: \"no\", \"global\", \"nexrad\"...\n\t// You can set it here or in a dashboard token named \"MapShowWeather\"...\n\tlet showWeatherDefault = \"no\";\n\n\t// If weather is shown, whether to show \"wildfires\" or \"outages\" or \"earthquakes\"...\n\t// You can set it here or in a dashboard token named \"MapOverlayOption\"...\n\tlet additionalOverlayOption = \"wildfires\";\n\n\t// Whether to show or hide the map options along the top of the widget by default...\n\t// You can set it here or in a dashboard token named \"HideMapOptions\"...\n\tlet hideMapOptionsByDefault = false;\n\n\t// Whether to automatically center the map to encompass all items during timed refreshes...\n\t// You can set it here or in a dashboard token named \"AutoResetMapOnRefresh\"...\n\tlet autoResetMapOnRefresh = false;\n\n\t// When true will not refresh the data on a timed interval (useful ONLY during development)...\n\tlet developmentFlag = false;\n\n\t// Since we generally don't need to poll all properties every time, we can just grab them initially then occasionally every x number of polls based on the following variable (set to 0 to perform a full refresh every time)...\n\tconst fullRefreshInterval = 0;\n\n\t// Optional angle & heading for the Google Map...\n\tlet showMapTiltControls = false;\n\tlet mapTilt = 0;\n\tlet mapHeading = 0;\n\n\t// Whether to include inherited locations in addition to those directly set on resources and/or services (disabling this can greatly increase refresh speed)...\n\tconst pollInheritedLocations = true;\n\n\t// Typically if both a 'latitude' & 'longitude' property are set, then we can assume the address is already geocoded. Set this to \"true\" to force geocoding the address instead...\n\tconst ignoreLatLongProps = false;\n\n\t// Whether the Google Maps uses the \"cooperative\" gesture handling, or \"greedy\" that allows mouse-wheel zooming without having to hold a modifier key (Google's default is \"cooperative\")...\n\tconst mapGestureHandling = \"cooperative\";\n\n\t// An optional comma-delimited list of custom properties to show when viewing a group's/resource's details...\n\t// You can set it here or in a dashboard token named \"MapDisplayProperties\"...\n\tlet displayProps = \"\";\n\n\t// Property to look for connecting information in...\n\tconst connectionInfoProp = \"auto.custom_map_connection_data\";\n\t// Stroke weight of connecting lines...\n\tconst connectingLineWeight = 3;\n\t// Whether to use geodesic lines when connecting two locations (I recommend not so it just plots a straight line vs curve of the Earth)...\n\tconst useGeodesicLines = false;\n\n\t// Default opacity for weather layers...\n\tconst weatherOpacity = 0.2;\n\t// Weather refresh interval in minutes...\n\tconst weatherRefreshMinutes = 5;\n\t// Whether to display details about a wildfire on \"click\" or \"mouseover\"...\n\tconst showWildfireInfoEvent = \"click\";\n\t// Whether the opacity of an earthquake's icon reflects \"time\" since the event, or \"magnitude\"...\n\tlet quakeMode = \"time\";\n</script><!-- We'll use FontAwesome icons to help pretty up things... --><!-- <script src=\"https://use.fontawesome.com/releases/v6.2.0/js/all.js\"></script> --><!-- Our CSS styles... --><style type=\"text/css\">\n\tbody {\n\t\tmargin-top: 0;\n\t}\n\t.customMapBody {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t.customMapBody, #googleMap {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tpadding: 0;\n\t\tmargin: 0;\n\t}\n\t.optionsHidden * {\n\t\tmax-height: 0;\n\t\tmin-height: 0;\n\t\ttransition: all 0.4s ease-out;\n\t}\n\t.optionsVisible * {\n\t\tmax-height: unset;\n\t\tmin-height: auto;\n\t\ttransition: all 0.4s ease-out;\n\t}\n\t.optionsVisibleToggle {\n\t\trotate: 0;\n\t\ttransition: all 1s ease-out;\n\t}\n\t.optionsHiddenToggle {\n\t\trotate: 180deg;\n\t\ttransition: all 1s ease-out;\n\t}\n\t.mapInfoPopupWindow {\n\t\tcolor: rgb(20, 29, 48);\n\t\tpadding: 12px;\n\t\tmin-width: 300px;\n\t\tmax-height: 400px;\n\t\t/* overflow-y: auto; */\n\t\tfont-family: system-ui, -apple-system, sans-serif;\n\t}\n\t#optionsBar {\n\t\twidth: 100%;\n\t\t/* min-height: 25px; */\n\t\tpadding: 3px 0 0 0;\n\t\tmargin: 0;\n\t\tfont-size: small;\n\t\tcolor: #777;\n\t\torder: 1;\n\t\tdisplay: flex;\n\t\tflex-wrap: nowrap;\n\t\tflex: none;\n\t\talign-items: center;\n\t}\n\t#googleMap {\n\t\torder: 2;\n\t\tborder: 1px solid #aaa;\n\t\tborder-radius: 7px;\n\t}\n\t#customMapRefreshButton, #customMapResetZoom {\n\t\tmargin-right: 5px;\n\t}\n\t#optionsBar input[type=\"radio\" i], #optionsBar input[type=\"checkbox\" i] {\n\t\tvertical-align: -0.09em;\n\t}\n\t#mapOptionsArea {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\talign-items: center;\n\t}\n\t#optionsToggleArea {\n\t\tdisplay: none;\n\t\tflex-wrap: wrap;\n\t\talign-items: center;\n\t}\n\t#weatherOptionsArea, #autoZoomOptions {\n\t\tdisplay: inline-flex;\n\t\tflex-wrap: nowrap;\n\t\talign-items: center;\n\t\tmargin: 0 5px;\n\t}\n\t#sevFilterOptions, #weatherOptions {\n\t\tdisplay: flex;\n\t\tborder: 1px solid #ddd;\n\t\tmargin: 3px 10px 3px 5px;\n\t\tpadding: 0;\n\t\talign-content: center;\n\t\talign-items: center;\n\t\theight: 30px;\n\t\tborder-radius: 5px;\n\t}\n\t.sevFilterOption {\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tpadding: 0 3px;\n\t}\n\t#additionalOverlayOptions {\n\t\tpadding: 0 5px;\n\t\tmargin-left: 5px;\n\t\tborder-left: 2px solid lightsteelblue;\n\t\theight: 25px;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t}\n\t#customGroupFilterOptions {\n\t\tpadding-right: 10px;\n\t\tfont-weight: bold;\n\t}\n\t#customGroupFilterField {\n\t\tbackground-color: #eee;\n\t\tborder: 1px solid silver;\n\t\tfont-family: Tahoma, Verdana, Roboto, monospace;\n\t\tmax-width: 150px;\n\t}\n\t#refreshStatusArea {\n\t\t/* font-weight: bold; */\n\t\tfont-size: medium;\n\t\t/* font-size: smaller; */\n\t\t/* color: white; */\n\t\tcolor: darkblue;\n\t\tdisplay: inline-flex;\n\t\tflex-wrap: nowrap;\n\t\talign-items: center;\n\t\ttext-wrap: nowrap;\n\t}\n\t:root {\n\t\t--warning-color: #f5ca1d;\n\t\t/* --warning-color: #f1c40f; */\n\t\t--error-color: #ff8c00;\n\t\t/* --error-color: #f57200; */\n\t\t--critical-color: #e0351b;\n\t\t--clear-color: #85c25d;\n\t\t/* --clear-color: #85c25d; */\n\t\t--sdt-color: #00a1fe;\n\t}\n\t#optionsBar .svg-inline--fa {\n\t\tfont-size: initial;\n\t}\n\t#gearIcon:hover {\n\t\tfilter: brightness(50%);\n\t}\n\t#clearCacheButton {\n\t\theight: 30px;\n\t\twidth: auto;\n\t\tvertical-align: middle;\n\t\tbackground-color: white;\n\t\tborder: 1px solid #ccc;\n\t\tborder-radius: 3px;\n\t\tcursor: pointer;\n\t}\n\t#clearCacheButton:hover {\n\t\tbackground-color: #f0f0f0;\n\t}\n\t#recycleIcon {\n\t\tfill: gray;\n\t}\n\t.toolbarSevIcon {\n\t\tdisplay: flex;\n\t\tmax-width: 25px;\n\t}\n\t.disabled {\n\t\topacity: 0.5 !important;\n\t\tcursor: not-allowed;\n\t\tpointer-events: none;\n\t}\n\t.noResultMessage {\n\t\tcolor: red;\n\t\tfont-size: medium;\n\t}\n\t.sdtNote {\n\t\tfont-size: 0.95em;\n\t\tfont-style: italic;\n\t\tfont-weight: 250;\n\t}\n\t.customItemArea {\n\t\tpadding: 3px;\n\t\tmargin-top: 3px;\n\t\tborder-top: 1px solid #ddd;\n\t\tborder-radius: 4px;\n\t}\n\t/* .customItem {\n\t\tpadding-top: 3px;\n\t} */\n\t.customItem .customItemName {\n\t\tfont-weight: bold;\n\t}\n\t/*\n\t* group styles in unhighlighted state.\n\t*/\n\t.group {\n\t\talign-items: center;\n\t\tbackground-color: #FFFFFF;\n\t\tborder-radius: 50%;\n\t\tcolor: #263238;\n\t\tdisplay: flex;\n\t\tfont-size: 14px;\n\t\tgap: 15px;\n\t\theight: 27px;\n\t\t/* height: 30px; */\n\t\twidth: 27px;\n\t\t/* width: 30px; */\n\t\tjustify-content: center;\n\t\tpadding: 0px;\n\t\tposition: relative;\n\t\ttransition: all 0.3s ease-out;\n\t}\n\t.group::before {\n\t\tcontent: \"\";\n\t\tfilter: blur(9px);\n\t\tdisplay: block;\n\t\tborder: 13px solid rgba(0, 0, 0, 0.7);\n\t\tborder-radius: 50%;\n\t\ttransform: scale(0.55, -0.4) translate(0px, -50px);\n\t\t/* transform: scale(0.55, -0.3) translate(0px, -70px); */\n\t\tposition: absolute;\n\t\tz-index: -1;\n\t}\n\t.group::after {\n\t\tborder-left: 9px solid transparent;\n\t\tborder-right: 10px solid transparent;\n\t\t/* border-left: 11px solid transparent;\n\t\tborder-right: 11px solid transparent; */\n\t\tborder-top: 9px solid #FFFFFF;\n\t\tcontent: \"\";\n\t\theight: 0;\n\t\tleft: 50%;\n\t\tposition: absolute;\n\t\ttop: 95%;\n\t\ttransform: translate(-50%, 0);\n\t\ttransition: all 0.3s ease-out;\n\t\twidth: 0;\n\t\t/* filter: drop-shadow(0px 5px 3px rgba(0, 0, 0, 0.7)); */\n\t}\n\t.group .icon {\n\t\talign-items: center;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tcolor: #FFFFFF;\n\t\t/* padding-top: 5px; */\n\t}\n\t.group .icon svg {\n\t\theight: 20px;\n\t\twidth: auto;\n\t}\n\t.group .details {\n\t\tdisplay: none;\n\t\tflex-direction: column;\n\t\tflex: 1;\n\t\tmin-width: 250px;\n\t}\n\t.group .groupName {\n\t\tfont-weight: 600;\n\t\tmargin-bottom: 8px;\n\t\tfont-size: medium;\n\t}\n\t.group .groupName a {\n\t\tcolor: #1a73e8;\n\t\ttext-decoration: none;\n\t}\n\t.group .groupName a:hover {\n\t\ttext-decoration: underline;\n\t}\n\t.group .description {\n\t\tcolor: #5f6368;\n\t\tfont-size: 12px;\n\t\tline-height: 1.4;\n\t\tmargin-bottom: 12px;\n\t}\n\t.group .features {\n\t\talign-items: center;\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: 8px;\n\t\tflex-wrap: wrap;\n\t}\n\t.group .features > div {\n\t\talign-items: center;\n\t\tbackground: #f8f9fa;\n\t\tborder-radius: 4px;\n\t\tborder: 1px solid #e8eaed;\n\t\tdisplay: flex;\n\t\tfont-size: 12px;\n\t\tgap: 6px;\n\t\tpadding: 4px 8px;\n\t\tcolor: #3c4043;\n\t}\n\t.group .features > div.drillDownButton {\n\t\tbackground-color: #1a73e8;\n\t\tborder-color: #1a73e8;\n\t}\n\t.group .features > div.drillDownButton a {\n\t\tcolor: white;\n\t}\n\t.group .features > div.drillDownButton:hover {\n\t\tbackground-color: #1557b0;\n\t}\n\t.group .close-button {\n\t\tdisplay: none;\n\t\tposition: absolute;\n\t\ttop: 12px;\n\t\tright: 12px;\n\t\tbackground: transparent;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tpadding: 4px;\n\t\tborder-radius: 4px;\n\t\tcolor: #666;\n\t\ttransition: all 0.2s ease;\n\t}\n\t.group .close-button:hover {\n\t\tbackground: #f1f1f1;\n\t\tcolor: #333;\n\t}\n\t.group .close-button svg {\n\t\twidth: 16px;\n\t\theight: 16px;\n\t}\n\t/*\n\t* group styles in highlighted state.\n\t*/\n\t.group.highlight {\n\t\tbackground-color: #FFFFFF;\n\t\tborder-radius: 8px;\n\t\tbox-shadow: 0px 2px 5px rgba(0, 0, 0, 0.5);\n\t\theight: fit-content;\n\t\t/* height: 80px; */\n\t\tpadding: 8px 15px;\n\t\twidth: auto;\n\t\tz-index: 10;\n\t\tmax-width: 400px;\n\t}\n\t.group.highlight::before {\n\t\tdisplay: none;\n\t}\n\t.group.highlight::after {\n\t\tborder-top: 9px solid #FFFFFF;\n\t\ttop: 99%;\n\t\tfilter: drop-shadow(0px 1px 1px rgba(0, 0, 0, 0.4));\n\t}\n\t.group.highlight .details {\n\t\tdisplay: flex;\n\t\tz-index: 10;\n\t}\n\t.group.highlight .icon svg {\n\t\twidth: 50px;\n\t\theight: 50px;\n\t}\n\t.group .link {\n\t\tcolor: white;\n\t}\n\t.group .link:hover {\n\t\t/* color: -webkit-link; */\n\t\tcolor: lightcyan;\n\t}\n\t.group.highlight .close-button {\n\t\tdisplay: block;\n\t}\n\t.indexText {\n\t\tz-index: 100;\n\t}\n\t/*\n\t* Cleared icon colors.\n\t*/\n\t.group.highlight:has(.clear) .icon {\n\t\tcolor: var(--clear-color);\n\t}\n\t.group:not(.highlight):has(.clear) {\n\t\tbackground-color: var(--clear-color);\n\t}\n\t.group:not(.highlight):has(.clear)::after {\n\t\tborder-top: 9px solid var(--clear-color);\n\t\ttop: 85%;\n\t}\n\t/*\n\t* Warning icon colors.\n\t*/\n\t.group.highlight:has(.warn) .icon {\n\t\tcolor: var(--warning-color);\n\t}\n\t.group:not(.highlight):has(.warn) {\n\t\tbackground-color: var(--warning-color);\n\t}\n\t.group:not(.highlight):has(.warn)::after {\n\t\tborder-top: 9px solid var(--warning-color);\n\t\ttop: 85%;\n\t}\n\t/*\n\t* Error icon colors.\n\t*/\n\t.group.highlight:has(.error) .icon {\n\t\tcolor: var(--error-color);\n\t}\n\t.group:not(.highlight):has(.error) {\n\t\tbackground-color: var(--error-color);\n\t}\n\t.group:not(.highlight):has(.error)::after {\n\t\tborder-top: 9px solid var(--error-color);\n\t\ttop: 85%;\n\t}\n\t/*\n\t* Critical icon colors.\n\t*/\n\t.group.highlight:has(.critical) .icon {\n\t\tcolor: var(--critical-color);\n\t}\n\t.group:not(.highlight):has(.critical) {\n\t\tbackground-color: var(--critical-color);\n\t}\n\t.group:not(.highlight):has(.critical)::after {\n\t\tborder-top: 9px solid var(--critical-color);\n\t\ttop: 85%;\n\t}\n\t/*\n\t* SDT icon colors.\n\t*/\n\t.group.highlight:has(.sdt) .icon {\n\t\tcolor: var(--sdt-color);\n\t}\n\t.group:not(.highlight):has(.sdt) {\n\t\tbackground-color: var(--sdt-color);\n\t}\n\t.group:not(.highlight):has(.sdt)::after {\n\t\tborder-top: 9px solid var(--sdt-color);\n\t\ttop: 85%;\n\t}\n\n\t/* Something about the Froala editor causes the default Gmap buttons to be shifted. This appears to fix that... */\n\t.gm-control-active {\n\t\tpadding: 10px !important;\n\t}\n\n\t[data-title]:hover:after {\n\t\topacity: 1;\n\t\ttransition: all 0.1s ease 0.5s;\n\t\tvisibility: visible;\n\t}\n\t[data-title]:after {\n\t\tfont-weight: normal;\n\t\tcontent: attr(data-title);\n\t\tposition: absolute;\n\t\ttop: 2em;\n\t\tleft: 50%;\n\t\tmargin-left: -75px;\n\t\tpadding: 4px;\n\t\tcolor: white;\n\t\tborder-radius: 5px;\n\t\topacity: 0;\n\t\tvisibility: hidden;\n\t\tz-index: 999;\n\t\tbackground-color: black;\n\t\twidth: 150px;\n\t}\n\t[data-title] {\n\t\tposition: relative;\n\t}\n\n\t/* Fix for Google's default control icons being off-center in Safari...  */\n\t@media screen and (-webkit-min-device-pixel-ratio:0) {\n\t\t.gm-control-active {\n\t\t\tdisplay: flex !important;\n\t\t}\n\t}\n</style><!-- Our main widget body... --><div class=\"customMapBody\"><!-- Create our options bar above the map... --><div id=\"optionsBar\" class=\"optionsVisible\"><div id=\"mapOptionsArea\"><span id=\"customGroupFilterOptions\" data-title=\"Path to the items you'd like on the map. Examples:&quot;*&quot;, &quot;Locations/*&quot;\">&nbsp;<label for=\"customGroupFilterField\">Group filter:</label> <input type=\"text\" id=\"customGroupFilterField\" name=\"customGroupFilterField\" value=\"*\" onkeypress=\"groupkeyHandler(event);\"></span> <span id=\"sevFilterOptions\">&nbsp;<span class=\"sevFilterOption\"><input type=\"checkbox\" id=\"showCleared\" name=\"showCleared\" value=\"showCleared\" onclick=\"refreshGroupData();\" data-title=\"Show/hide items with no active alerts\"> <label for=\"showCleared\"><div id=\"showClearedLabel\" class=\"toolbarSevIcon\">Cleared</div></label>&nbsp;</span> <span class=\"sevFilterOption\"><input type=\"checkbox\" id=\"showWarnings\" name=\"showWarnings\" value=\"showWarnings\" onclick=\"refreshGroupData();\" data-title=\"Show/hide items with active Warning alerts\"> <label for=\"showWarnings\"><div id=\"showWarningsLabel\" class=\"toolbarSevIcon\">Warnings</div></label>&nbsp;</span> <span class=\"sevFilterOption\"><input type=\"checkbox\" id=\"showErrors\" name=\"showErrors\" value=\"showErrors\" onclick=\"refreshGroupData();\" data-title=\"Show/hide items with active Error alerts\"> <label for=\"showErrors\"><div id=\"showErrorsLabel\" class=\"toolbarSevIcon\">Errors</div></label>&nbsp;</span> <span class=\"sevFilterOption\"><input type=\"checkbox\" id=\"showCriticals\" name=\"showCriticals\" value=\"showCriticals\" onclick=\"refreshGroupData();\" data-title=\"Show/hide items with active Critical alerts\"> <label for=\"showCriticals\"><div id=\"showCriticalsLabel\" class=\"toolbarSevIcon\">Criticals</div></label>&nbsp;</span> <span class=\"sevFilterOption\"><input type=\"checkbox\" id=\"showSDT\" name=\"showSDT\" value=\"showSDT\" onclick=\"refreshGroupData();\" data-title=\"Show/hide items in Scheduled Down Time (SDT)\"> <label for=\"showSDT\"><div id=\"showSDTLabel\" class=\"toolbarSevIcon\">SDT</div></label>&nbsp;</span>&nbsp;</span> <span data-title=\"Toggle visibility of additional options\">&nbsp;<svg id=\"optionsToggleButton\" onclick=\"toggleMiscOptions()\" width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" style=\"vertical-align: middle;\"><path id=\"gearIcon\" d=\"M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z\" fill=\"#aaa\"></path></svg>&nbsp;</span> <svg id=\"gearIconChevron\" style=\"display: none; margin-left: -3px;\" width=\"10\" height=\"15\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 256 512\"><path d=\"M246.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 256c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l128-128z\" fill=\"#999\"></path></svg><div id=\"optionsToggleArea\"><span id=\"autoZoomOptions\" data-title=\"Automatically reset the map's zoom to encompass all items after timed refreshes. You can also manually do so at any time using the 'Reset map zoom' button on the left of the map.\"><input type=\"checkbox\" id=\"autoZoom\" name=\"autoZoom\" value=\"autoZoom\" onclick=\"enableWeather();\" checked=\"true\"> <label for=\"autoZoom\">Auto-zoom</label>&nbsp;</span> <span id=\"weatherOptionsArea\">&nbsp;<span data-title=\"Enables overlay of current weather radar and more\"><input type=\"checkbox\" id=\"weather\" name=\"weather\" value=\"weather\" onclick=\"enableWeather();\"> <label for=\"weather\">Weather</label>&nbsp;</span> <span id=\"weatherOptions\">&nbsp;<span data-title=\"Weather across the globe (~10-15 minute updates)\" onclick=\"enableWeather();\"><input type=\"radio\" id=\"globalWeather\" name=\"weatherType\" value=\"radar\" checked=\"true\"> <label for=\"globalWeather\">Global</label>&nbsp;</span> <span data-title=\"US NEXRAD Base radar (~5 minute updates)\" onclick=\"enableWeather();\"><input type=\"radio\" id=\"nexradWeather\" name=\"weatherType\" value=\"nexrad-n0q-900913\"> <label for=\"nexradWeather\">NEXRAD (US)</label>&nbsp;</span> <span id=\"additionalOverlayOptions\">&nbsp;<!-- <strong class=\"optionsHeader\">additional overlays:</strong> --> <span data-title=\"Active US wildfires\" onclick=\"enableWeather();\"><input type=\"radio\" id=\"usWildfires\" name=\"otherWeatherOverlays\" value=\"us-fires\" checked=\"true\"> <label for=\"usWildfires\">US Wildfires</label>&nbsp;</span> <span data-title=\"US power outages by county\" onclick=\"enableWeather();\"><input type=\"radio\" id=\"usPowerOutages\" name=\"otherWeatherOverlays\" value=\"us-poweroutages\"> <label for=\"usPowerOutages\">US Power Outages</label>&nbsp;</span> <span data-title=\"Significant earthquakes (magnitude 6+) over the past 7 days\" onclick=\"enableWeather();\"><input type=\"radio\" id=\"earthquakes\" name=\"otherWeatherOverlays\" value=\"earthquakes\"> <label for=\"earthquakes\">Earthquakes</label>&nbsp;</span>&nbsp;</span>&nbsp;</span>&nbsp;</span> <button id=\"clearCacheButton\" type=\"button\" data-title=\"Reset addresses cached locally on your browser (should rarely be needed, only use if you're having issues with the map)\" onclick=\"clearCache();\">&nbsp;<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\" height=\"20\" width=\"20\" style=\"vertical-align: middle;\"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path id=\"recycleIcon\" d=\"M216.3 124C262.5 44 378 44 424.2 124L461.5 188.6L489.2 172.6C497.6 167.7 508.1 168.4 515.8 174.3C523.5 180.2 526.9 190.2 524.4 199.6L500.9 287C497.5 299.8 484.3 307.4 471.5 304L384.1 280.6C374.7 278.1 367.8 270.2 366.5 260.6C365.2 251 369.9 241.5 378.3 236.7L406 220.7L368.7 156.1C347.1 118.8 293.3 118.8 271.7 156.1L266.4 165.2C257.6 180.5 238 185.7 222.7 176.9C207.4 168.1 202.2 148.5 211 133.1L216.3 124zM513.7 343.1C529 334.3 548.6 339.5 557.4 354.8L562.7 363.9C608.9 443.9 551.2 543.9 458.8 543.9L384.2 543.9L384.2 575.9C384.2 585.6 378.4 594.4 369.4 598.1C360.4 601.8 350.1 599.8 343.2 592.9L279.2 528.9C269.8 519.5 269.8 504.3 279.2 495L343.2 431C350.1 424.1 360.4 422.1 369.4 425.8C378.4 429.5 384.2 438.3 384.2 448L384.2 480L458.8 480C501.9 480 528.9 433.3 507.3 396L502 386.9C493.2 371.6 498.4 352 513.7 343.2zM115 299.4L87.3 283.4C78.9 278.5 74.2 269.1 75.5 259.5C76.8 249.9 83.7 242 93.1 239.5L180.5 216C193.3 212.6 206.5 220.2 209.9 233L233.3 320.4C235.8 329.8 232.4 339.7 224.7 345.7C217 351.7 206.5 352.3 198.1 347.4L170.4 331.4L133.1 396C111.5 433.3 138.5 480 181.6 480L192.2 480C209.9 480 224.2 494.3 224.2 512C224.2 529.7 209.9 544 192.2 544L181.6 544C89.3 544 31.6 444 77.8 364L115 299.4z\"></path></svg>&nbsp;</button></div></div><!-- <span id=\"refreshStatusArea\">&nbsp;</span> --></div><!-- Placeholder for our map... --><div id=\"googleMap\">&nbsp;</div></div><!-- Initialize Google Maps... --><script>\n\t// Fetch our map API key to use...\n\tlet apiKey = parent.LMGlobalData.googleMapInfo.key.toString();\n\n\t(g=>{var h,a,k,p=\"The Google Maps JavaScript API\",c=\"google\",l=\"importLibrary\",q=\"__ib__\",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement(\"script\"));e.set(\"libraries\",[...r]+\"\");for(k in g)e.set(k.replace(/[A-Z]/g,t=>\"_\"+t[0].toLowerCase()),g[k]);e.set(\"callback\",c+\".maps.\"+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+\" could not load.\"));a.nonce=m.querySelector(\"script[nonce]\")?.nonce||\"\";m.head.append(a)}));d[l]?console.warn(p+\" only loads once. Ignoring:\",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})\n\t({key: apiKey, v: \"weekly\"});\n</script><!-- Google's Marker Clusterer extension for grouping adjacent markers... --><!-- <script src=\"https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js\"></script> --><script>\n\t/**\n\t* Fetches a Cross-Site Request Forgery (CSRF) token required for subsequent API calls.\n\t*\n\t* This function makes a preliminary request to a dummy endpoint solely to retrieve\n\t* the CSRF token from the response headers.\n\t*\n\t* @async\n\t* @function fetchCsrfToken\n\t* @returns {Promise<string>} A promise that resolves with the CSRF token.\n\t* @throws {Error} If the fetch request fails or the token is not found in headers.\n\t*/\n\tasync function fetchCsrfToken() {\n\t\t// console.debug('Fetching CSRF token...');\n\t\tconst response = await fetch('/santaba/rest/functions/dummy', {\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'X-Csrf-Token': 'Fetch', // Specific header to request the token\n\t\t\t\t'Accept': 'application/json',\n\t\t\t\t'X-Version': '3', // Specify API version if required by this endpoint\n\t\t\t},\n\t\t\tcredentials: 'include', // Include cookies for session management/CSRF\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Failed to fetch CSRF token: ${response.status} ${response.statusText}`);\n\t\t}\n\n\t\tconst token = response.headers.get('X-Csrf-Token');\n\t\tif (!token) {\n\t\t\tthrow new Error('CSRF token not found in response headers.');\n\t\t}\n\t\t// console.debug('CSRF Token fetched successfully.');\n\n\t\treturn token;\n\t}\n\n\t/**\n\t\t* Performs an HTTP request to the LogicMonitor REST API.\n\t\t*\n\t\t* This function handles fetching a CSRF token, constructing the API request,\n\t\t* sending the request, and processing the response. It supports common HTTP verbs\n\t\t* and automatically includes necessary headers and credentials.\n\t\t*\n\t\t* @async\n\t\t* @function LMClient\n\t\t* @param {object} options - The options for the API request.\n\t\t* @param {string} options.resourcePath - The specific API resource path (e.g., /device/devices).\n\t\t* @param {string} [options.queryParams=''] - Optional query parameters string (e.g., ?filter=name:value).\n\t\t* @param {'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE'} options.httpVerb - The HTTP method to use.\n\t\t* @param {object | Array<unknown>} [options.postBody] - The JSON payload for POST/PUT/PATCH requests.\n\t\t* @param {string} [options.apiVersion='3'] - The API version to use. Default is \"3\".\n\t\t* @returns {Promise<object>} A promise that resolves with the JSON response body on success.\n\t\t* @throws {Error} Throws an Error on API errors (>=300 status), network issues,\n\t\t*                 token fetching problems, or JSON handling errors. The error object\n\t\t*                 may contain 'status' and 'statusText' properties for API errors.\n\t*/\n\tasync function LMClient({\n\t\tresourcePath,\n\t\tqueryParams = '', // Default queryParams to empty string\n\t\thttpVerb,\n\t\tpostBody,\n\t\tapiVersion = '3',\n\t}) {\n\t\t// console.debug('LMClient called with:', { resourcePath, queryParams, httpVerb, postBody, apiVersion });\n\t\t// Validate required parameters\n\t\tif (!resourcePath || !httpVerb) {\n\t\t\tthrow new Error('Missing required parameters: resourcePath and httpVerb must be provided.');\n\t\t}\n\t\tconst validVerbs = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'];\n\t\tif (!validVerbs.includes(httpVerb)) {\n\t\t\tthrow new Error(`Invalid httpVerb: ${httpVerb}. Must be one of ${validVerbs.join(', ')}`);\n\t\t}\n\n\t\t// console.debug(`Initiating LogicMonitor API call: ${httpVerb} ${resourcePath}${queryParams}`);\n\n\t\ttry {\n\t\t\t// 1. Fetch the CSRF token\n\t\t\tconst csrfToken = await fetchCsrfToken();\n\n\t\t\t// 2. Construct the API URL and request options\n\t\t\tconst apiUrl = `/santaba/rest${resourcePath}${queryParams}`;\n\t\t\tconst headers = {\n\t\t\t\t'Content-Type': 'application/json', // Consistently set Content-Type\n\t\t\t\t'Accept': 'application/json', // Expect JSON response\n\t\t\t\t'X-Csrf-Token': csrfToken,\n\t\t\t\t'X-Version': apiVersion, // Use the appropriate API version for the main request\n\t\t\t};\n\n\t\t\tconst requestOptions = {\n\t\t\t\tmethod: httpVerb,\n\t\t\t\theaders: headers,\n\t\t\t\tcredentials: 'include', // Necessary for session/cookie-based auth\n\t\t\t};\n\n\t\t\t// 3. Add body only for relevant methods\n\t\t\tif (postBody && (httpVerb === 'POST' || httpVerb === 'PUT' || httpVerb === 'PATCH')) {\n\t\t\t\ttry {\n\t\t\t\t\trequestOptions.body = JSON.stringify(postBody);\n\t\t\t\t\t// console.debug('Request body included:', postBody);\n\t\t\t\t} catch (stringifyError) {\n\t\t\t\t\tconsole.error('Failed to stringify postBody:', stringifyError);\n\t\t\t\t\t// Add user-friendly message to the error\n\t\t\t\t\tstringifyError.message = `Invalid postBody provided. Could not stringify to JSON. Original error: ${stringifyError.message}`;\n\t\t\t\t\tthrow stringifyError;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 4. Make the API call\n\t\t\t// console.debug(`Executing fetch to: ${apiUrl}`);\n\t\t\tconst response = await fetch(apiUrl, requestOptions);\n\t\t\t// console.debug(`Received response status: ${response.status} ${response.statusText}`);\n\n\t\t\t// 5. Process the response\n\t\t\tif (response.ok) { // ok is true for statuses 200-299\n\t\t\t\t// Handle potential empty response body for certain success statuses (e.g., 204 No Content)\n\t\t\t\tif (response.status === 204) {\n\t\t\t\t\tconsole.debug('Received 204 No Content response.');\n\t\t\t\t\treturn {}; // Return an empty object for 204\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\t// Assume response is JSON if status is ok and not 204\n\t\t\t\t\tconst data = await response.json();\n\t\t\t\t\t// console.debug('API call successful, response data received.'); // Avoid logging potentially sensitive data by default\n\t\t\t\t\treturn data;\n\t\t\t\t} catch (jsonError) {\n\t\t\t\t\tconsole.error('Failed to parse JSON response:', jsonError);\n\t\t\t\t\t// Create a new error with more context\n\t\t\t\t\tconst parseError = new Error(`Successfully received response (${response.status}), but failed to parse JSON body. Original error: ${jsonError.message}`);\n\t\t\t\t\tparseError.status = response.status; // Attach status for context\n\t\t\t\t\tparseError.statusText = response.statusText;\n\t\t\t\t\tthrow parseError;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Handle API errors (status >= 300)\n\t\t\t\tconst error = new Error(`API Error: ${response.status} ${response.statusText}`);\n\t\t\t\terror.status = response.status;\n\t\t\t\terror.statusText = response.statusText;\n\n\t\t\t\t// Attempt to get more details from the error response body\n\t\t\t\ttry {\n\t\t\t\t\tconst errorBody = await response.text(); // Use text first in case it's not JSON\n\t\t\t\t\terror.body = errorBody || 'No additional error details provided.'; // Attach body to error\n\t\t\t\t\tconsole.warn(`API Error Body: ${error.body}`); // Log the raw error body\n\t\t\t\t} catch (bodyError) {\n\t\t\t\t\tconsole.warn('Could not read error response body:', bodyError);\n\t\t\t\t\terror.body = 'Could not read error response body.';\n\t\t\t\t}\n\t\t\t\tconsole.error('LogicMonitor API Error:', { status: error.status, statusText: error.statusText });\n\t\t\t\tthrow error; // Throw the augmented error object\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// Catch errors from fetchCsrfToken, fetch itself (network errors), or JSON parsing/stringifying\n\t\t\tconsole.error('An error occurred in LMClient:', error.message || error);\n\n\t\t\t// Re-throw the error to be handled by the caller.\n\t\t\t// Ensure it's always an Error object.\n\t\t\tif (error instanceof Error) {\n\t\t\t\tthrow error;\n\t\t\t} else {\n\t\t\t\t// If it's not an Error object (e.g., the thrown API error object), wrap it\n\t\t\t\tconst wrappedError = new Error(error.message || 'An unexpected error occurred during the API call.');\n\t\t\t\t// Copy relevant properties if they exist\n\t\t\t\tif (error && typeof error === 'object') {\n\t\t\t\t\tif ('status' in error) wrappedError.status = error.status;\n\t\t\t\t\tif ('statusText' in error) wrappedError.statusText = error.statusText;\n\t\t\t\t\tif ('body' in error) wrappedError.body = error.body;\n\t\t\t\t}\n\t\t\t\tthrow wrappedError;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Capture information from specific dashboard tokens we'll be using...\n\t// (Like any token inserted into the Text widget, LogicMonitor automatically inserts these token values as the page is being rendered so Javascript is able to pick them as if the values were there originally. If a token isn't set then the variable's value will be literally what's shown below, including the double-hashtags.)\n\n\t// Capture from token whether to plot \"groups\" or \"resources\" or \"services\"...\n\tlet mapSourceTypeToken = \"##MapSourceType##\";\n\t// If the token value wasn't set then use the values hard-coded above at the beginning of this script...\n\tif (mapSourceTypeToken != \"\\#\\#MapSourceType\\#\\#\") {\n\t\tmapSourceType = mapSourceTypeToken.toLowerCase();\n\t};\n\n\t// Capture from token whether override the map theme...\n\tlet mapStyleToken = \"##MapStyle##\";\n\t// If the token value wasn't set then use the values hard-coded above at the beginning of this script...\n\tif (mapStyleToken != \"\\#\\#MapStyle\\#\\#\") {\n\t\tmapStyle = mapStyleToken.toLowerCase();\n\t};\n\n\t// Capture from token whether to hide the map options...\n\tlet hideMapOptionsByDefaultToken = \"##HideMapOptions##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (hideMapOptionsByDefaultToken.toLowerCase() == \"true\" || hideMapOptionsByDefaultToken.toLowerCase() == \"yes\"|| hideMapOptionsByDefaultToken.toLowerCase() == \"1\") {\n\t\thideMapOptionsByDefault = true;\n\t};\n\n\t// Capture from token whether to hide items that don't have active alerts...\n\tlet ignoreClearedToken = \"##MapIgnoreCleared##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (ignoreClearedToken.toLowerCase() == \"true\" || ignoreClearedToken.toLowerCase() == \"yes\" || ignoreClearedToken.toLowerCase() == \"1\") {\n\t\tshowCleared = false;\n\t};\n\t// Capture from token whether to hide items that have \"Warning\" alerts...\n\tlet ignoreWarningsToken = \"##MapIgnoreWarnings##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (ignoreWarningsToken.toLowerCase() == \"true\" || ignoreWarningsToken.toLowerCase() == \"yes\" || ignoreWarningsToken.toLowerCase() == \"1\") {\n\t\tshowWarnings = false;\n\t};\n\t// Capture from token whether to hide items that have \"Error\" alerts...\n\tlet ignoreErrorsToken = \"##MapIgnoreErrors##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (ignoreErrorsToken.toLowerCase() == \"true\" || ignoreErrorsToken.toLowerCase() == \"yes\" || ignoreErrorsToken.toLowerCase() == \"1\") {\n\t\tshowErrors = false;\n\t};\n\t// Capture from token whether to hide items that have \"Critical\" alerts...\n\tlet ignoreCriticalsToken = \"##MapIgnoreCriticals##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (ignoreCriticalsToken.toLowerCase() == \"true\" || ignoreCriticalsToken.toLowerCase() == \"yes\" || ignoreCriticalsToken.toLowerCase() == \"1\") {\n\t\tshowCriticals = false;\n\t};\n\t// Capture from token whether to hide items that are in SDT...\n\tlet ignoreSDTToken = \"##MapIgnoreSDT##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (ignoreSDTToken.toLowerCase() == \"true\" || ignoreSDTToken.toLowerCase() == \"yes\" || ignoreSDTToken.toLowerCase() == \"1\") {\n\t\tshowSDT = false;\n\t};\n\t// Capture from token whether to show the map tilt/rotation controls...\n\tlet showMapTiltControlsToken = \"##MapShowTiltControls##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (showMapTiltControlsToken.toLowerCase() == \"true\" || showMapTiltControlsToken.toLowerCase() == \"yes\" || showMapTiltControlsToken.toLowerCase() == \"1\") {\n\t\tshowMapTiltControls = true;\n\t};\n\n\t// Capture from token whether to automatically reset the map's zoom to encompass all items on timed refreshes...\n\tlet autoResetMapOnRefreshToken = \"##AutoResetMapOnRefresh##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (autoResetMapOnRefreshToken.toLowerCase() == \"true\" || autoResetMapOnRefreshToken.toLowerCase() == \"yes\" || autoResetMapOnRefreshToken.toLowerCase() == \"1\") {\n\t\tautoResetMapOnRefresh = true;\n\t};\n\n\t// Capture our group filter if defined as a token...\n\tlet dashboardGroupPathToken = \"##MapGroupPathFilter##\";\n\tif (dashboardGroupPathToken != \"\\#\\#MapGroupPathFilter\\#\\#\") {\n\t\tgroupPathFilter = dashboardGroupPathToken;\n\t};\n\tif (groupPathFilter == \"\") {\n\t\t// Default to \"*\" if no value was given...\n\t\tgroupPathFilter = \"*\";\n\t};\n\t// Capture the current path filter to reset the form field if the user completely clears it out...\n\tconst initialGroupPathFilter = groupPathFilter;\n\n\t// Capture our overlay defaults if defined as tokens...\n\tlet dashboardShowWeatherToken = \"##MapShowWeather##\".toLowerCase();\n\tif (dashboardShowWeatherToken == \"global\" || dashboardShowWeatherToken == \"nexrad\") {\n\t\tshowWeatherDefault = dashboardShowWeatherToken;\n\t};\n\tlet dashboardAddlOverlayToken = \"##MapOverlayOption##\".toLowerCase();\n\tif (dashboardAddlOverlayToken == \"wildfires\" || dashboardAddlOverlayToken == \"outages\" || dashboardAddlOverlayToken == \"earthquakes\") {\n\t\tadditionalOverlayOption = dashboardAddlOverlayToken;\n\t};\n\n\t// Capture from token any custom properties to display when viewing an item's details...\n\tlet displayPropsToken = \"##MapDisplayProperties##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (displayPropsToken != \"\\#\\#MapDisplayProperties\\#\\#\") {\n\t\tdisplayProps = displayPropsToken;\n\t};\n\n\t// Capture from token whether to disable marker clustering...\n\tlet disableClusteringToken = \"##MapDisableClustering##\";\n\t// If the token value wasn't set then use the value hard-coded above at the beginning of this script...\n\tif (disableClusteringToken.toLowerCase() == \"true\" || disableClusteringToken.toLowerCase() == \"yes\" || disableClusteringToken.toLowerCase() == \"1\") {\n\t\tdisableClustering = true;\n\t};\n\n\t// Set the form fields as appropriate...\n\tdocument.getElementById(\"showCleared\").checked = showCleared;\n\tdocument.getElementById(\"showWarnings\").checked = showWarnings;\n\tdocument.getElementById(\"showErrors\").checked = showErrors;\n\tdocument.getElementById(\"showCriticals\").checked = showCriticals;\n\tdocument.getElementById(\"showSDT\").checked = showSDT;\n\tdocument.getElementById(\"autoZoom\").checked = autoResetMapOnRefresh;\n\n\tif (showWeatherDefault == \"global\") {\n\t\tdocument.getElementById(\"weather\").checked = true;\n\t\tdocument.getElementById(\"globalWeather\").checked = true;\n\t} else if (showWeatherDefault == \"nexrad\") {\n\t\tdocument.getElementById(\"weather\").checked = true;\n\t\tdocument.getElementById(\"nexradWeather\").checked = true;\n\t};\n\tif (additionalOverlayOption == \"wildfires\") {\n\t\tdocument.getElementById(\"usWildfires\").checked = true\n\t} else if (additionalOverlayOption == \"outages\") {\n\t\tdocument.getElementById(\"usPowerOutages\").checked = true\n\t} else if (additionalOverlayOption == \"earthquakes\") {\n\t\tdocument.getElementById(\"earthquakes\").checked = true\n\t};\n\n\t// Capture information about the current dashboard for use in subsequent REST calls...\n\tconst hostName = parent.window.location.host;\n\tconst locationHash = parent.window.location.hash; // example result: \"#dashboard=21\"\n\tconst dashboardID = locationHash.replace(\"#dashboard=\", \"\");\n\tconst pathName = parent.window.location.pathname;\n\n\t// Note our original tilt & heading values...\n\tconst defaultMapTilt = mapTilt;\n\tconst defaultMapHeading = mapHeading;\n\n\t// SVG icon definitions for our different alert severities...\n\tconst warningIcon = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 1024 1024\" data-tooltip=\"Warning\"><path fill=\"#f5ca1d\" d=\"M118.154 118.154h787.692c43.323 0 78.769 35.446 78.769 78.769v630.154c0 43.323-35.446 78.769-78.769 78.769h-787.692c-43.323 0-78.769-35.446-78.769-78.769v-630.154c0-43.323 35.446-78.769 78.769-78.769v0 0z\"></path> <path fill=\"white\" d=\"M866.462 669.538l-275.692-433.231c-43.323-70.892-114.215-70.892-157.538 0l-275.692 433.231c-43.323 70.892-3.938 157.538 78.769 157.538h551.385c82.708 0 122.092-86.646 78.769-157.538v0 0z\"></path> <path fill=\"#f5ca1d\" d=\"M551.385 748.308h-78.769v-78.769h78.769v78.769zM551.385 630.154h-78.769v-275.692h78.769v275.692z\"></path> </svg>';\n\tconst errorIcon = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 1024 1024\" data-tooltip=\"Error\"><path fill=\"#ff8c00\" d=\"M118.154 118.154h787.692c43.323 0 78.769 35.446 78.769 78.769v630.154c0 43.323-35.446 78.769-78.769 78.769h-787.692c-43.323 0-78.769-35.446-78.769-78.769v-630.154c0-43.323 35.446-78.769 78.769-78.769v0 0z\"></path> <path fill=\"white\" d=\"M866.462 669.538l-275.692-433.231c-43.323-70.892-114.215-70.892-157.538 0l-275.692 433.231c-43.323 70.892-3.938 157.538 78.769 157.538h551.385c82.708 0 122.092-86.646 78.769-157.538v0 0z\"></path> <path fill=\"#ff8c00\" d=\"M551.385 748.308h-78.769v-78.769h78.769v78.769zM551.385 630.154h-78.769v-275.692h78.769v275.692z\"></path> </svg>';\n\tconst criticalIcon = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 1024 1024\" data-tooltip=\"Critical\"><path fill=\"#e0351b\" d=\"M118.154 118.154h787.692c43.323 0 78.769 35.446 78.769 78.769v630.154c0 43.323-35.446 78.769-78.769 78.769h-787.692c-43.323 0-78.769-35.446-78.769-78.769v-630.154c0-43.323 35.446-78.769 78.769-78.769v0 0z\"></path> <path fill=\"white\" d=\"M827.077 590.769c-133.908-232.369-39.385-354.462-39.385-354.462s-173.292 43.323-157.538 157.538c-35.446-31.508-216.615-86.646-114.215-271.754v-3.938h-3.938c-3.938 0-55.138 23.631-94.523 74.831-39.385 47.262-110.277 106.338-63.015 240.246 31.508 74.831 39.385 94.523-39.385 157.538 3.938-15.754 11.815-51.2 0-78.769-27.569-63.015-78.769-78.769-78.769-78.769s43.323 66.954 0 118.154c-39.385 43.323-55.138 129.969-35.446 200.862 15.754 59.077 70.892 106.338 157.538 137.846-7.877-3.938 110.277 43.323 244.185 3.938 59.077-19.692 137.846-43.323 185.108-106.338 39.385-51.2 74.831-129.969 39.385-196.923v0 0z\"></path> <path fill=\"#e0351b\" d=\"M551.385 827.077h-78.769v-78.769h78.769v78.769zM551.385 708.923h-78.769v-275.692h78.769v275.692z\"></path> </svg>';\n\tconst clearedIcon = '<svg width=\"50\" height=\"50\" viewBox=\"0 0 50 50\" xmlns=\"http://www.w3.org/2000/svg\" data-tooltip=\"No alerts\"><path id=\"Shape\" fill=\"#ffffff\" fill-rule=\"evenodd\" stroke=\"none\" d=\"M 43 25 C 43 15.61116 35.164986 8 25.5 8 C 15.835016 8 8 15.61116 8 25 C 8 34.38884 15.835016 42 25.5 42 C 35.164986 42 43 34.38884 43 25 Z\"/><path id=\"Path\" fill=\"#85c25d\" stroke=\"none\" d=\"M 25.5 4 C 37.374119 4 47 13.625877 47 25.5 C 47 37.374123 37.374119 47 25.5 47 C 13.625877 47 4 37.374123 4 25.5 C 4 13.625877 13.625877 4 25.5 4 Z M 17.975 17.974998 C 15.881312 17.974998 14.103745 18.670809 12.642242 20.062449 C 11.18074 21.45409 10.45 23.269981 10.45 25.510181 C 10.45 27.736805 11.18074 29.545912 12.642242 30.937551 C 14.103745 32.329193 15.881312 33.025002 17.975 33.025002 C 20.068687 33.025002 21.842855 32.329193 23.297562 30.937551 C 24.752264 29.545912 25.479607 27.736805 25.479607 25.510181 C 25.479607 23.283558 24.752264 21.471062 23.297562 20.072632 C 21.842855 18.674204 20.068687 17.974998 17.975 17.974998 Z M 31.006098 18.280481 L 27.784012 18.280481 L 27.784012 32.719521 L 31.006098 32.719521 L 31.006098 28.850101 L 32.637535 27.037582 L 36.532589 32.719521 L 40.549999 32.719521 L 34.901154 24.532646 L 40.529606 18.280481 L 36.287876 18.280481 L 31.006098 24.34936 L 31.006098 18.280481 Z M 17.975 21.111265 C 19.089819 21.111265 20.061874 21.48802 20.891193 22.241541 C 21.72051 22.995064 22.135162 24.07781 22.135162 25.489815 C 22.135162 26.901821 21.72051 27.981174 20.891193 28.727909 C 20.061874 29.474642 19.089819 29.848003 17.975 29.848003 C 16.86018 29.848003 15.884727 29.474642 15.048611 28.727909 C 14.212496 27.981174 13.794444 26.901821 13.794444 25.489815 C 13.794444 24.07781 14.209096 22.998459 15.038414 22.251724 C 15.881327 21.491413 16.86018 21.111265 17.975 21.111265 Z\"/></svg>';\n\tconst sdtIcon = '<svg width=\"50\" height=\"50\" viewBox=\"0 0 50 50\" xmlns=\"http://www.w3.org/2000/svg\" data-tooltip=\"SDT\"><path id=\"Oval\" fill=\"#00A1FE\" fill-rule=\"evenodd\" stroke=\"none\" d=\"M 46 25 C 46 13.40202 36.59798 4 25 4 C 13.40202 4 4 13.40202 4 25 C 4 36.59798 13.40202 46 25 46 C 36.59798 46 46 36.59798 46 25 Z\"/><g id=\"Group\"><path id=\"Path\" fill=\"#000000\" fill-opacity=\"0.01\" stroke=\"none\" d=\"M 5 5 L 45 5 L 45 45 L 5 45 Z\"/><path id=\"path1\" fill=\"#ffffff\" stroke=\"none\" d=\"M 25 9.0625 C 16.19795 9.0625 9.0625 16.197948 9.0625 25 C 9.0625 33.801994 16.19795 40.9375 25 40.9375 C 33.801998 40.9375 40.9375 33.801994 40.9375 25 L 36.25 25 C 36.25 31.213245 31.213249 36.25 25 36.25 C 18.7868 36.25 13.75 31.213245 13.75 25 C 13.75 18.786802 18.7868 13.75 25 13.75 L 25 9.0625 Z\"/><path id=\"path2\" fill=\"#ffffff\" stroke=\"none\" d=\"M 33.75 12.5 C 33.75 13.880699 32.630753 15 31.25 15 C 29.869299 15 28.75 13.880699 28.75 12.5 C 28.75 11.119301 29.869299 10 31.25 10 C 32.630753 10 33.75 11.119301 33.75 12.5 Z\"/><path id=\"path3\" fill=\"#ffffff\" stroke=\"none\" d=\"M 40 18.75 C 40 20.130701 38.880753 21.25 37.5 21.25 C 36.119247 21.25 35 20.130701 35 18.75 C 35 17.369301 36.119247 16.25 37.5 16.25 C 38.880753 16.25 40 17.369301 40 18.75 Z\"/><path id=\"path4\" fill=\"#ffffff\" fill-rule=\"evenodd\" stroke=\"none\" d=\"M 23.125 16.000004 L 26.880026 16.000004 L 26.880026 24.899998 L 33.125 28.647003 L 30.725 31.83075 L 23.125 27.066555 L 23.125 16.000004 Z\"/></g></svg>';\n\t// Animated throbber for when we're updating data...\n\tconst loadingSpinner = '<svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><style>.spinner_VpEe{animation:spinner_vXu6 1.2s cubic-bezier(0.52,.6,.25,.99) infinite}.spinner_eahp{animation-delay:.4s}.spinner_f7Y2{animation-delay:.8s}@keyframes spinner_vXu6{0%{r:0;opacity:1}100%{r:11px;opacity:0}}</style><circle class=\"spinner_VpEe\" cx=\"12\" cy=\"12\" r=\"0\" fill=\"red\"/><circle class=\"spinner_VpEe spinner_eahp\" cx=\"12\" cy=\"12\" r=\"0\" fill=\"red\"/><circle class=\"spinner_VpEe spinner_f7Y2\" cx=\"12\" cy=\"12\" r=\"0\" fill=\"red\"/></svg>';\n\t// Icons for toggling visiiblity of the top toolbar...\n\tconst optionsToggleVisibleIcon = '<svg class=\"svg-inline--fa fa-square-caret-up\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"square-caret-up\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" data-fa-i2svg=\"\" style=\"width: 25px; height: 25px;\"><path fill=\"#000000\" d=\"M241.6 175.7C237.1 170.8 230.7 168 224 168S210.9 170.8 206.4 175.7l-96 104c-6.469 7-8.188 17.19-4.375 25.91C109.8 314.3 118.5 320 127.1 320h192c9.531 0 18.16-5.656 22-14.38c3.813-8.719 2.094-18.91-4.375-25.91L241.6 175.7zM384 32H64C28.65 32 0 60.66 0 96v320c0 35.34 28.65 64 64 64h320c35.35 0 64-28.66 64-64V96C448 60.66 419.3 32 384 32zM400 416c0 8.82-7.178 16-16 16H64c-8.822 0-16-7.18-16-16V96c0-8.82 7.178-16 16-16h320c8.822 0 16 7.18 16 16V416z\"></path></svg>';\n\tconst optionsToggleHiddenIcon = '<svg class=\"svg-inline--fa fa-square-caret-down\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"square-caret-down\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" data-fa-i2svg=\"\" style=\"width: 25px; height: 25px;\"><path fill=\"#000000\" d=\"M320 192H128C118.5 192 109.8 197.7 105.1 206.4C102.2 215.1 103.9 225.3 110.4 232.3l96 104C210.9 341.2 217.3 344 224 344s13.09-2.812 17.62-7.719l96-104c6.469-7 8.188-17.19 4.375-25.91C338.2 197.7 329.5 192 320 192zM384 32H64C28.65 32 0 60.66 0 96v320c0 35.34 28.65 64 64 64h320c35.35 0 64-28.66 64-64V96C448 60.66 419.3 32 384 32zM400 416c0 8.82-7.178 16-16 16H64c-8.822 0-16-7.18-16-16V96c0-8.82 7.178-16 16-16h320c8.822 0 16 7.18 16 16V416z\"></path></svg>';\n\n\n\t// I'm making various different map color schemes available, created using Google's style editor (https://mapstyle.withgoogle.com/). Feel free to create your own and add it as a variable. We'll then set which style later in the 'initMap' function.\n\n\tconst standardStyle = [ { \"stylers\": [ { \"lightness\": 60 } ] }, { \"elementType\": \"labels\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.land_parcel\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.neighborhood\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"labels.text\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"poi.business\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"road\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"road\", \"elementType\": \"labels.icon\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"transit\", \"stylers\": [ { \"visibility\": \"off\" } ] } ];\n\t// const standardStyle = [ { \"stylers\": [ { \"lightness\": 60 } ] } ];\n\n\tconst silverStyle = [ { \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#f5f5f5\" } ] }, { \"elementType\": \"labels.icon\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#616161\" }, { \"lightness\": 70 } ] }, { \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#f5f5f5\" } ] }, { \"featureType\": \"administrative\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.country\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"color\": \"#000000\" }, { \"lightness\": 85 } ] }, { \"featureType\": \"administrative.land_parcel\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.land_parcel\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#bdbdbd\" } ] }, { \"featureType\": \"administrative.neighborhood\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.province\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"color\": \"#000000\" }, { \"lightness\": 80 } ] }, { \"featureType\": \"poi\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#eeeeee\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"labels.text\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#757575\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#e5e5e5\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#9e9e9e\" } ] }, { \"featureType\": \"road\", \"stylers\": [ { \"lightness\": 45 } ] }, { \"featureType\": \"road\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#ffffff\" }, { \"lightness\": 55 } ] }, { \"featureType\": \"road\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"lightness\": 55 } ] }, { \"featureType\": \"road\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"lightness\": 55 } ] }, { \"featureType\": \"road\", \"elementType\": \"labels\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"road.arterial\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#757575\" } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#dadada\" }, { \"lightness\": 50 }, { \"weight\": 0.5 } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#616161\" } ] }, { \"featureType\": \"road.local\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#9e9e9e\" } ] }, { \"featureType\": \"transit.line\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#e5e5e5\" } ] }, { \"featureType\": \"transit.station\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#eeeeee\" } ] }, { \"featureType\": \"water\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#c9c9c9\" }, { \"lightness\": 20 } ] }, { \"featureType\": \"water\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"lightness\": 35 } ] }, { \"featureType\": \"water\", \"elementType\": \"labels.text\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"water\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#9e9e9e\" } ] } ];\n\n\tconst silverBlueStyle = [ { \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#f5f5f5\" } ] }, { \"elementType\": \"labels.icon\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#616161\" }, { \"lightness\": 70 } ] }, { \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#f5f5f5\" } ] }, { \"featureType\": \"administrative\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.country\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"color\": \"#000000\" }, { \"lightness\": 85 } ] }, { \"featureType\": \"administrative.land_parcel\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.land_parcel\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#bdbdbd\" } ] }, { \"featureType\": \"administrative.neighborhood\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.province\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"color\": \"#000000\" }, { \"lightness\": 80 } ] }, { \"featureType\": \"poi\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#eeeeee\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"labels.text\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#757575\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#e5e5e5\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#9e9e9e\" } ] }, { \"featureType\": \"road\", \"stylers\": [ { \"lightness\": 45 } ] }, { \"featureType\": \"road\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#ffffff\" }, { \"lightness\": 55 } ] }, { \"featureType\": \"road\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"lightness\": 55 } ] }, { \"featureType\": \"road\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"lightness\": 55 } ] }, { \"featureType\": \"road\", \"elementType\": \"labels\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"road.arterial\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#757575\" } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#dadada\" }, { \"lightness\": 50 }, { \"weight\": 0.5 } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#616161\" } ] }, { \"featureType\": \"road.local\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#9e9e9e\" } ] }, { \"featureType\": \"transit.line\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#e5e5e5\" } ] }, { \"featureType\": \"transit.station\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#eeeeee\" } ] }, { \"featureType\": \"water\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#c9c9c9\" }, { \"lightness\": 20 } ] }, { \"featureType\": \"water\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"color\": \"#cad0d8\" }, { \"lightness\": 35 } ] }, { \"featureType\": \"water\", \"elementType\": \"labels.text\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"water\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#9e9e9e\" } ] } ];\n\n\tconst darkStyle = [ { \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#212121\" } ] }, { \"elementType\": \"geometry.fill\", \"stylers\": [ { \"lightness\": 10 } ] }, { \"elementType\": \"labels\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"elementType\": \"labels.icon\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#757575\" } ] }, { \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#212121\" } ] }, { \"featureType\": \"administrative\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#757575\" } ] }, { \"featureType\": \"administrative\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.country\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#9e9e9e\" } ] }, { \"featureType\": \"administrative.land_parcel\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.locality\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#bdbdbd\" } ] }, { \"featureType\": \"administrative.neighborhood\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#757575\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#181818\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#616161\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#1b1b1b\" } ] }, { \"featureType\": \"road\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"color\": \"#2c2c2c\" } ] }, { \"featureType\": \"road\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#8a8a8a\" } ] }, { \"featureType\": \"road.arterial\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#373737\" } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#3c3c3c\" } ] }, { \"featureType\": \"road.highway.controlled_access\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#4e4e4e\" } ] }, { \"featureType\": \"road.local\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#616161\" } ] }, { \"featureType\": \"transit\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#757575\" } ] }, { \"featureType\": \"water\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#000000\" } ] }, { \"featureType\": \"water\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#3d3d3d\" } ] } ];\n\n\tconst aubergineStyle = [ { \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#1d2c4d\" } ] }, { \"elementType\": \"labels\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#8ec3b9\" } ] }, { \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#1a3646\" } ] }, { \"featureType\": \"administrative\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.country\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"color\": \"#4b6878\" } ] }, { \"featureType\": \"administrative.land_parcel\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.land_parcel\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#64779e\" } ] }, { \"featureType\": \"administrative.neighborhood\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"administrative.province\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"color\": \"#4b6878\" } ] }, { \"featureType\": \"landscape.man_made\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"color\": \"#334e87\" } ] }, { \"featureType\": \"landscape.natural\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#023e58\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#283d6a\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#6f9ba5\" } ] }, { \"featureType\": \"poi\", \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#1d2c4d\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"color\": \"#023e58\" } ] }, { \"featureType\": \"poi.park\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#3C7680\" } ] }, { \"featureType\": \"road\", \"stylers\": [ { \"visibility\": \"off\" } ] }, { \"featureType\": \"road\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#304a7d\" } ] }, { \"featureType\": \"road\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#98a5be\" } ] }, { \"featureType\": \"road\", \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#1d2c4d\" } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#2c6675\" } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"geometry.stroke\", \"stylers\": [ { \"color\": \"#255763\" } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#b0d5ce\" } ] }, { \"featureType\": \"road.highway\", \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#023e58\" } ] }, { \"featureType\": \"transit\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#98a5be\" } ] }, { \"featureType\": \"transit\", \"elementType\": \"labels.text.stroke\", \"stylers\": [ { \"color\": \"#1d2c4d\" } ] }, { \"featureType\": \"transit.line\", \"elementType\": \"geometry.fill\", \"stylers\": [ { \"color\": \"#283d6a\" } ] }, { \"featureType\": \"transit.station\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#3a4762\" } ] }, { \"featureType\": \"water\", \"elementType\": \"geometry\", \"stylers\": [ { \"color\": \"#0e1626\" } ] }, { \"featureType\": \"water\", \"elementType\": \"labels.text.fill\", \"stylers\": [ { \"color\": \"#4e6d70\" } ] } ];\n\n\t// RainViewer map options (feel free to change these to suit your taste)...\n\tconst rvOptionKind = 'radar'; // can be 'radar' or 'satellite'\n\tconst rvOptionColorScheme = 4; // from 0 to 8. Check the https://rainviewer.com/api/color-schemes.html for additional inforvation\n\tconst rvOptionSmoothData = 1; // 0 - not smooth, 1 - smooth\n\tconst rvOptionSnowColors = 1; // 0 - do not show snow colors, 1 - show snow colors\n\t// Variables for holding RainViewer API data...\n\tlet rvAPIData = {};\n\tlet rvMapFrames = [];\n\tlet rvLastPastFramePosition = -1;\n\tlet weatherRefresher = null;\n\n\t// Number formatter for use in wildfire data...\n\tconst numFormatOptions = {\n\t\tstyle: 'decimal',  // Other options: 'currency', 'percent', etc.\n\t\tminimumFractionDigits: 0,\n\t\tmaximumFractionDigits: 0,\n\t}\n\n\t// Adding a top-level placeholder for our Google Map objects...\n\tlet map = \"\";\n\tlet clusterer = \"\";\n\tlet bounds = \"\";\n\n\t// Fetch helper with timeout & AbortController...\n\tif (!window.fetchJson) {\n\t\twindow.fetchJson = async function(url, { timeoutMs = 8000 } = {}) {\n\t\t\tconst ac = new AbortController();\n\t\t\tconst timer = setTimeout(() => ac.abort(\"timeout\"), timeoutMs);\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(url, { signal: ac.signal, credentials: \"omit\", cache: \"no-store\" });\n\t\t\t\tif (!res.ok) throw new Error(`${res.status} ${res.statusText}`);\n\t\t\t\tconst ct = res.headers.get(\"content-type\") || \"\";\n\t\t\t\tif (ct.includes(\"application/json\")) return await res.json();\n\t\t\t\treturn await res.text();\n\t\t\t} finally { clearTimeout(timer); }\n\t\t};\n\t}\n\n\t// Batch builder to avoid jank when (re)building many markers...\n\tif (!window.buildMarkersInBatches) {\n\t\twindow.buildMarkersInBatches = async function(items, fn, batchSize = 250) {\n\t\t\tfor (let i = 0; i < items.length; i += batchSize) {\n\t\t\t\tconst slice = items.slice(i, i + batchSize);\n\t\t\t\tfor (const it of slice) { try { fn(it); } catch(e) {} }\n\t\t\t\tawait new Promise(r => { if ('requestIdleCallback' in window) requestIdleCallback(()=>r()); else setTimeout(r,0); });\n\t\t\t}\n\t\t};\n\t}\n\n\t// Variable for holding our map markers...\n\tlet markers = [];\n\t// For tracking if we've already established an initial center for our map based on markers...\n\tlet centerCalculated = false;\n\n\t// For caching marker latitude/longitude information between refreshes...\n\tconst __LMBMW_CACHE_KEY = \"lm_bmw.cachedAddresses.v1\";\n\tfunction loadCache() {\n\t\ttry {\n\t\t\tconst obj = JSON.parse(localStorage.getItem(__LMBMW_CACHE_KEY));\n\t\t\treturn (obj && typeof obj === \"object\") ? obj : {};\n\t\t} catch (e) { return {}; }\n\t}\n\tfunction saveCache() {\n\t\ttry { localStorage.setItem(__LMBMW_CACHE_KEY, JSON.stringify(cachedAddresses)); } catch (e) {}\n\t}\n\tfunction clearCache() {\n\t\ttry {\n\t\t\tlocalStorage.removeItem(__LMBMW_CACHE_KEY);\n\t\t\t// Display our progress to the user...\n\t\t\tdocument.getElementById(\"refreshStatusArea\").innerHTML = \"Cache has been reset\";\n\t\t\tdocument.getElementById(\"refreshStatusArea\").style.display = \"flex\";\n\t\t\t// Add timer to remove message after 2 seconds...\n\t\t\tsetTimeout(() => {\n\t\t\t\tdocument.getElementById(\"refreshStatusArea\").style.display = \"none\";\n\t\t\t}, 2000);\n\t\t} catch (e) {}\n\t}\n\tlet cachedAddresses = loadCache();\n\n\t// For holding our LM group data...\n\tlet groupData = [];\n\t// For timing our refreshes...\n\tlet refreshStartTime = new Date();\n\t// For tracking when to do a full refresh...\n\tlet pollCount = 0;\n\tlet fullRefresh = true;\n\n\t// For holding our connection status data...\n\tlet lineData = [];\n\n\t// Pre-populate the group path filter field...\n\tdocument.getElementById(\"customGroupFilterField\").value = groupPathFilter;\n\n\t// Set toolbar icons...\n\tdocument.getElementById(\"showClearedLabel\").innerHTML = clearedIcon;\n\tdocument.getElementById(\"showWarningsLabel\").innerHTML = warningIcon;\n\tdocument.getElementById(\"showErrorsLabel\").innerHTML = errorIcon;\n\tdocument.getElementById(\"showCriticalsLabel\").innerHTML = criticalIcon;\n\tdocument.getElementById(\"showSDTLabel\").innerHTML = sdtIcon;\n\n\t// Placeholder for marker cluster info...\n\tlet clusterInfoWindow = null;\n\n\t// We've prepped everything, so now calling the function to populate the map...\n\tinitMap();\n\n\n\t// ----- FUNCTIONS\n\n\t// Function to create our map...\n\tasync function initMap() {\n\t\t// Load some libraries needed by Google Maps...\n\t\tconst { Map, RenderingType, InfoWindow } = await google.maps.importLibrary(\"maps\");\n\t\tconst { AdvancedMarkerElement, PinElement } = await google.maps.importLibrary(\"marker\");\n\t\tconst {ColorScheme} = await google.maps.importLibrary(\"core\");\n\n\t\t// Create our Google Map...\n\t\tmap = new google.maps.Map(document.getElementById(\"googleMap\"), {\n\t\t\tzoom: 3,\n\t\t\tcenter: { lat: 0, lng: 0 },\n\t\t\tmapId: \"DEMO_MAP_ID\",\n\t\t\t// colorScheme: ColorScheme.DARK,\n\t\t\tcolorScheme: ColorScheme.LIGHT,\n\t\t\tzoomControl: true,\n\t\t\tcameraControl: false,\n\t\t\tmapTypeControl: false,\n\t\t\t// scaleControl: boolean,\n\t\t\tstreetViewControl: false,\n\t\t\trotateControl: false,\n\t\t\tfullscreenControl: true,\n\t\t\ttilt: mapTilt,\n\t\t\theading: mapHeading,\n\t\t\tgestureHandling: mapGestureHandling,\n\t\t});\n\n\t\t// Vector maps are nicer but sometimes don't load right away. Plus they're mainly useful if tilt controls are enabled, so use the normal raster map by default...\n\t\tif (showMapTiltControls) {\n\t\t\tmap.setRenderingType(RenderingType.VECTOR);\n\t\t};\n\n\t\t// Add some custom controls to the map...\n\t\tconst weatherControlDiv = document.createElement(\"div\");\n\t\t// Create a button to the map for toggling visibility of the options bar...\n\t\tconst weatherControls = createWeatherToggleControl(map);\n\t\tweatherControlDiv.appendChild(weatherControls);\n\n\t\t// Create a div to hold our refresh & zoom reset buttons...\n\t\tconst weatherControlButtonDiv = document.createElement(\"div\");\n\t\tweatherControlButtonDiv.style.display = \"flex\";\n\t\tweatherControlButtonDiv.style.flexDirection = \"column\";\n\t\tweatherControlButtonDiv.style.backgroundColor = \"rgb(255 255 255)\";\n\t\tweatherControlButtonDiv.style.border = \"0\";\n\t\tweatherControlButtonDiv.style.borderRadius = \"3px\";\n\t\tweatherControlButtonDiv.style.boxShadow = \"0 1px 4px rgba(0,0,0,0.3)\";\n\t\tweatherControlButtonDiv.style.width = \"40px\";\n\t\tweatherControlButtonDiv.style.height = \"81px\";\n\t\tweatherControlButtonDiv.style.margin = \"0 10px\";\n\t\t// Create a button to force-refresh the map data...\n\t\tconst weatherRefreshControl = createWeatherRefreshControl(map);\n\t\tweatherControlButtonDiv.appendChild(weatherRefreshControl);\n\t\tconst weatherControlDivider = document.createElement(\"div\");\n\t\t// Create a divider between the two buttons...\n\t\tweatherControlDivider.innerHTML = '<div style=\"position: relative; overflow: hidden; width: 30px; height: 1px; margin: 0px 5px; background-color: rgb(230, 230, 230); top: 0px;\"></div>';\n\t\tweatherControlButtonDiv.appendChild(weatherControlDivider);\n\t\t// Create a button to reset the zoom on the map...\n\t\tconst mapZoomResetControl = createZoomResetControl(map);\n\t\tweatherControlButtonDiv.appendChild(mapZoomResetControl);\n\t\t// Add our button div to our custom map controls...\n\t\tweatherControlDiv.appendChild(weatherControlButtonDiv);\n\t\t// Attach our controls to the map...\n\t\tmap.controls[google.maps.ControlPosition.TOP_LEFT].push(weatherControlDiv);\n\n\t\t// Optionally create a div to hold our map tilt & heading buttons...\n\t\tif (showMapTiltControls) {\n\t\t\tconst mapControlButtonDiv = document.createElement(\"div\");\n\t\t\tmapControlButtonDiv.style.display = \"flex\";\n\t\t\tmapControlButtonDiv.style.flexDirection = \"column\";\n\t\t\tmapControlButtonDiv.style.backgroundColor = \"rgb(255 255 255)\";\n\t\t\tmapControlButtonDiv.style.border = \"0\";\n\t\t\tmapControlButtonDiv.style.borderRadius = \"20px\";\n\t\t\tmapControlButtonDiv.style.boxShadow = \"0 1px 3px rgba(0,0,0,0.3)\";\n\t\t\tmapControlButtonDiv.style.width = \"40px\";\n\t\t\tmapControlButtonDiv.style.margin = \"0 10px\";\n\t\t\tmapControlButtonDiv.style.alignItems = \"center\";\n\t\t\tmapControlButtonDiv.style.padding = \"5px 0\";\n\t\t\t// Create a button to tilt the map forward...\n\t\t\tconst mapRotateForwardControl = createRotateForwardControl(map);\n\t\t\tmapControlButtonDiv.appendChild(mapRotateForwardControl);\n\t\t\t// Create a button to tilt the map backward...\n\t\t\tconst mapRotateBackControl = createRotateBackControl(map);\n\t\t\tmapControlButtonDiv.appendChild(mapRotateBackControl);\n\t\t\t// Create a button to rotate the map right...\n\t\t\tconst mapRotateRightControl = createRotateRightControl(map);\n\t\t\tmapControlButtonDiv.appendChild(mapRotateRightControl);\n\t\t\t// Create a button to rotate the map left...\n\t\t\tconst mapRotateLeftControl = createRotateLeftControl(map);\n\t\t\tmapControlButtonDiv.appendChild(mapRotateLeftControl);\n\t\t\t// Attach our controls to the map...\n\t\t\tmap.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(mapControlButtonDiv);\n\t\t};\n\n\t\t// Add an area to display when we're updating...\n\t\tconst updateAreaDiv = await createUpdateArea(map);\n\n\t\t// *** MAP THEME ***\n\t\t// Set our map theme (can be set via default at beginning of this script or via a \"MapStyle\" dashboard token)...\n\t\tlet styledMapType = new google.maps.StyledMapType(silverStyle);\n\t\tif (mapStyle == \"standard\") {\n\t\t\tstyledMapType = new google.maps.StyledMapType(standardStyle);\n\t\t} else if (mapStyle == \"dark\") {\n\t\t\tstyledMapType = new google.maps.StyledMapType(darkStyle);\n\t\t} else if (mapStyle == \"aubergine\") {\n\t\t\tstyledMapType = new google.maps.StyledMapType(aubergineStyle);\n\t\t} else if (mapStyle == \"silverblue\") {\n\t\t\tstyledMapType = new google.maps.StyledMapType(silverBlueStyle);\n\t\t};\n\n\t\tmap.mapTypes.set(\"customMapStyle\", styledMapType);\n\t\tmap.setMapTypeId(\"customMapStyle\");\n\n\t\t// Toggle visibility of our weather options...\n\t\tenableWeather();\n\n\t\t// Toggle hiding the options bar if set as the default...\n\t\tif (hideMapOptionsByDefault) {\n\t\t\tdocument.getElementById(\"optionsBar\").classList.remove(\"optionsVisible\");\n\t\t\tdocument.getElementById(\"optionsBar\").classList.add(\"optionsHidden\");\n\t\t};\n\n\t\t// Load our LogicMonitor data only after we know our update area has been created...\n\t\twaitForElm('#refreshStatusArea').then((elm) => {\n\t\t\t// console.log('Element is ready');\n\t\t\trefreshGroupData();\n\t\t});\n\n\t\t// Refresh the map data at regular intervals (using the 'statusUpdateIntervalMinutes' variable set near the top of this script)...\n\t\tif (!developmentFlag) {\n\t\t\tmapDataRefresher = setInterval(function() {\n\t\t\t\trefreshGroupData(timedRefresh = true);\n\t\t\t\tconsole.log(\"Map data refreshed.\");\n\t\t\t}, statusUpdateIntervalMinutes*1000*60);\n\t\t};\n\t};\n\n\t// Function for creating & styling the map button for toggling the options bar...\n\tfunction createWeatherToggleControl(map) {\n\t\tconst weatherToggle = document.createElement(\"button\");\n\n\t\tweatherToggle.id = \"weatherControlToggle\";\n\t\tweatherToggle.style.backgroundColor = \"rgb(255 255 255)\";\n\t\tweatherToggle.style.border = \"0\";\n\t\tweatherToggle.style.borderRadius = \"3px\";\n\t\tweatherToggle.style.boxShadow = \"0 1px 4px rgba(0,0,0,0.3)\";\n\t\t// weatherToggle.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.3)\";\n\t\tweatherToggle.style.cursor = \"pointer\";\n\t\tweatherToggle.style.fontSize = \"x-large\";\n\t\tweatherToggle.style.textAlign = \"center\";\n\t\tweatherToggle.style.margin = \"10px\";\n\t\tweatherToggle.style.height = \"40px\";\n\t\tweatherToggle.style.width = \"40px\";\n\t\tweatherToggle.style.verticalAlign = \"middle\";\n\t\t// weatherToggle.innerHTML = 'Toggle Controls';\n\t\tweatherToggle.title = \"Toggle visibility of the map controls\";\n\t\tif (hideMapOptionsByDefault) {\n\t\t\tweatherToggle.innerHTML = optionsToggleHiddenIcon;\n\t\t} else {\n\t\t\tweatherToggle.innerHTML = optionsToggleVisibleIcon;\n\t\t};\n\t\tweatherToggle.type = \"button\";\n\n\t\tweatherToggle.addEventListener(\"click\", () => {\n\t\t\tconst optionsBar = document.getElementById(\"optionsBar\");\n\t\t\tif (optionsBar.classList.contains(\"optionsHidden\")) {\n\t\t\t\toptionsBar.classList.remove(\"optionsHidden\");\n\t\t\t\toptionsBar.classList.add(\"optionsVisible\");\n\t\t\t\tweatherToggle.innerHTML = optionsToggleVisibleIcon;\n\t\t\t} else {\n\t\t\t\toptionsBar.classList.remove(\"optionsVisible\");\n\t\t\t\toptionsBar.classList.add(\"optionsHidden\");\n\t\t\t\tweatherToggle.innerHTML = optionsToggleHiddenIcon;\n\t\t\t};\n\t\t});\n\n\t\treturn weatherToggle;\n\t};\n\n\tfunction createWeatherRefreshControl(map) {\n\t\tconst weatherControls = document.createElement(\"button\");\n\n\t\tweatherControls.id = \"weatherRefreshButton\";\n\t\tweatherControls.style.backgroundColor = \"rgb(255 255 255 / 0%)\";\n\t\tweatherControls.style.border = \"0\";\n\t\tweatherControls.style.borderRadius = \"3px\";\n\t\t// weatherControls.style.boxShadow = \"0 1px 4px rgba(0,0,0,0.3)\";\n\t\t// weatherControls.style.boxShadow = \"0 2px 6px rgba(0,0,0,0.3)\";\n\t\tweatherControls.style.cursor = \"pointer\";\n\t\tweatherControls.style.fontSize = \"x-large\";\n\t\tweatherControls.style.textAlign = \"center\";\n\t\t// weatherControls.style.margin = \"10px\";\n\t\tweatherControls.style.height = \"40px\";\n\t\tweatherControls.style.width = \"40px\";\n\t\tweatherControls.style.verticalAlign = \"middle\";\n\t\t// weatherControls.innerHTML = 'Toggle Controls';\n\t\tweatherControls.title = \"Force refresh the map data\";\n\t\tweatherControls.innerHTML = '<svg viewBox=\"-0.5 0 25 25\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"> <path d=\"M7.1998 10.8799L3.9998 14.0799L0.799805 10.8799\" stroke=\"#000000\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/> <path d=\"M17.72 6.77007C16.6086 5.63347 15.1839 4.85371 13.6275 4.53032C12.0711 4.20693 10.4536 4.35459 8.98145 4.95439C7.5093 5.5542 6.24924 6.57899 5.362 7.898C4.47476 9.21701 4.0006 10.7703 4 12.3599V14.0901\" stroke=\"#000000\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/> <path d=\"M16.7998 13.96L19.9998 10.75L23.1998 13.96\" stroke=\"#000000\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/> <path d=\"M6.28027 18.0801C7.39163 19.2167 8.8164 19.9962 10.3728 20.3196C11.9292 20.643 13.5467 20.4956 15.0188 19.8958C16.491 19.2959 17.751 18.2712 18.6383 16.9521C19.5255 15.6331 19.9997 14.0796 20.0003 12.49V10.76\" stroke=\"#000000\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>';\n\t\tweatherControls.type = \"button\";\n\n\t\tweatherControls.addEventListener(\"click\", refreshGroupData);\n\n\t\treturn weatherControls;\n\t};\n\n\tfunction createZoomResetControl(map) {\n\t\tconst weatherControls = document.createElement(\"button\");\n\n\t\tweatherControls.id = \"weatherZoomResetButton\";\n\t\tweatherControls.style.backgroundColor = \"rgb(255 255 255 / 0%)\";\n\t\tweatherControls.style.border = \"0\";\n\t\tweatherControls.style.borderRadius = \"3px\";\n\t\tweatherControls.style.cursor = \"pointer\";\n\t\tweatherControls.style.fontSize = \"x-large\";\n\t\tweatherControls.style.textAlign = \"center\";\n\t\t// weatherControls.style.margin = \"10px\";\n\t\tweatherControls.style.height = \"40px\";\n\t\tweatherControls.style.width = \"40px\";\n\t\tweatherControls.style.verticalAlign = \"middle\";\n\t\t// weatherControls.innerHTML = 'Toggle Controls';\n\t\tweatherControls.title = \"Reset map zoom\";\n\t\tweatherControls.innerHTML = '<svg xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:cc=\"http://creativecommons.org/ns#\" xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"25px\" height=\"25px\" viewBox=\"0 0 400 400.00001\" id=\"svg2\" version=\"1.1\" inkscape:version=\"0.91 r13725\" sodipodi:docname=\"minimize.svg\"> <defs id=\"defs4\" /> <g transform=\"translate(0,-652.36216)\"> <path style=\"opacity:1;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1\" d=\"M 17.6035,652.36212 0,670.05352 l 108.5469,109.0918 -84.0235,0 0,25.0195 126.5235,0 0,-127.1563 -24.8965,0 0,84.4434 -108.5469,-109.0898 z m 364.793,0 -108.5469,109.0898 0,-84.4434 -24.8965,0 0,127.1563 126.5235,0 0,-25.0195 -84.0235,0 L 400,670.05352 382.3965,652.36212 Z M 24.5234,900.5593 l 0,25.0196 84.0235,0 L 0,1034.6708 l 17.6035,17.6914 108.5469,-109.09 0,84.4435 24.8965,0 0,-127.1564 -126.5235,0 z m 224.4297,0 0,127.1564 24.8965,0 0,-84.4435 108.5469,109.09 L 400,1034.6708 291.4531,925.5789 l 84.0235,0 0,-25.0196 -126.5235,0 z\" id=\"minimize\"> <title id=\"title23704\">Reset map zoom</title></path></g></svg>';\n\t\tweatherControls.type = \"button\";\n\n\t\tweatherControls.addEventListener(\"click\", resetZoom);\n\n\t\treturn weatherControls;\n\t};\n\n\tfunction createRotateRightControl(map) {\n\t\tconst weatherControls = document.createElement(\"button\");\n\n\t\tweatherControls.id = \"mapRotateRightButton\";\n\t\tweatherControls.style.backgroundColor = \"rgb(255 255 255 / 0%)\";\n\t\tweatherControls.style.border = \"0\";\n\t\tweatherControls.style.borderRadius = \"3px\";\n\t\tweatherControls.style.cursor = \"pointer\";\n\t\tweatherControls.style.fontSize = \"x-large\";\n\t\tweatherControls.style.textAlign = \"center\";\n\t\t// weatherControls.style.margin = \"10px\";\n\t\tweatherControls.style.height = \"30px\";\n\t\tweatherControls.style.width = \"30px\";\n\t\tweatherControls.style.verticalAlign = \"middle\";\n\t\t// weatherControls.innerHTML = 'Toggle Controls';\n\t\tweatherControls.title = \"Rotate Map Right\";\n\t\tweatherControls.innerHTML = '<svg viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\"> <path id=\"Path\" fill=\"#000000\" stroke=\"none\" d=\"M 30.322001 21.322001 C 30.228001 21.277 30.118999 21.250999 30.003 21.250999 C 29.705 21.250999 29.448 21.423 29.323999 21.673 L 29.322001 21.677 C 27.145 26.191999 22.604 29.250999 17.348 29.250999 C 10.03 29.250999 4.097 23.318001 4.097 16 C 4.097 8.681999 10.029 2.75 17.347 2.749001 L 17.347 2.749001 C 17.358999 2.749001 17.374001 2.749001 17.389 2.749001 C 21.684999 2.749001 25.499001 4.813 27.893 8.003 L 27.917 8.036999 L 22.274 8.036999 C 21.860001 8.036999 21.524 8.373001 21.524 8.786999 C 21.524 9.201 21.860001 9.536999 22.274 9.536999 L 22.274 9.536999 L 29.346001 9.536999 C 29.365 9.536999 29.381001 9.527 29.4 9.526001 C 29.507 9.512001 29.603001 9.483 29.693001 9.442001 L 29.687 9.445 C 29.702 9.437 29.718 9.437 29.733 9.429001 C 29.754999 9.410999 29.775 9.393 29.792999 9.374001 L 29.792999 9.374001 C 29.837 9.341 29.875999 9.306 29.910999 9.265999 L 29.912001 9.264999 C 29.938999 9.232 29.965 9.195 29.986 9.156 L 29.988001 9.152 C 30.038 9.071999 30.07 8.977001 30.079 8.875 L 30.079 8.873001 C 30.086 8.848999 30.091999 8.82 30.096001 8.790001 L 30.096001 8.785999 L 30.096001 1.715 C 30.096001 1.301001 29.76 0.965 29.346001 0.965 C 28.931999 0.965 28.596001 1.301001 28.596001 1.715 L 28.596001 1.715 L 28.596001 6.485001 C 25.898001 3.275 21.881001 1.247999 17.391001 1.247999 C 17.375 1.247999 17.358999 1.247999 17.344 1.247999 L 17.346001 1.247999 C 9.201 1.25 2.6 7.853001 2.6 15.998001 C 2.6 24.143999 9.204 30.747999 17.35 30.747999 C 23.198999 30.747999 28.253 27.344 30.638 22.408001 L 30.676001 22.32 C 30.722 22.226 30.747999 22.115 30.747999 21.997999 C 30.747999 21.701 30.575001 21.444 30.325001 21.322001 L 30.320999 21.32 Z\"/> </svg>';\n\t\t// weatherControls.innerHTML = '<svg viewBox=\"0 0 72 72\" xmlns=\"http://www.w3.org/2000/svg\"> <g id=\"Group-copy\"> <path id=\"Path\" fill=\"#000000\" stroke=\"#000000\" stroke-width=\"2\" d=\"M 31.638996 17.068626 C 31.183994 17.524628 31.183994 18.265625 31.638996 18.719627 L 35.817997 22.898624 C 26.449997 22.942627 17.635994 24.545628 10.962997 27.445625 C 3.893997 30.519627 -7e-06 34.722626 -7e-06 39.284626 C -7e-06 48.483627 15.904995 55.684624 36.204998 55.684624 C 56.506996 55.684624 72.410004 48.480625 72.410004 39.284626 C 72.410004 38.640625 71.886002 38.117626 71.241997 38.117626 C 70.598999 38.117626 70.073997 38.640625 70.073997 39.284626 C 70.073997 46.909626 54.562996 53.348625 36.204998 53.348625 C 17.847996 53.348625 2.335999 46.907623 2.335999 39.284626 C 2.335999 35.758625 5.821 32.228626 11.895996 29.586624 C 18.275993 26.810627 26.749996 25.273624 35.798996 25.233627 L 31.638996 29.389626 C 31.183994 29.843624 31.183994 30.584625 31.638996 31.040627 C 32.094997 31.494625 32.834995 31.494625 33.289997 31.040627 L 40.278996 24.056625 L 33.289997 17.067627 C 32.834995 16.610626 32.094997 16.610626 31.638996 17.068626 Z\"/> </g> </svg>';\n\t\tweatherControls.type = \"button\";\n\n\t\tweatherControls.addEventListener(\"click\", function() {adjustMap(\"rotate\", -5);});\n\n\t\treturn weatherControls;\n\t};\n\n\tfunction createRotateLeftControl(map) {\n\t\tconst weatherControls = document.createElement(\"button\");\n\n\t\tweatherControls.id = \"mapRotateLeftButton\";\n\t\tweatherControls.style.backgroundColor = \"rgb(255 255 255 / 0%)\";\n\t\tweatherControls.style.border = \"0\";\n\t\tweatherControls.style.borderRadius = \"3px\";\n\t\tweatherControls.style.cursor = \"pointer\";\n\t\tweatherControls.style.fontSize = \"x-large\";\n\t\tweatherControls.style.textAlign = \"center\";\n\t\t// weatherControls.style.margin = \"10px\";\n\t\tweatherControls.style.height = \"30px\";\n\t\tweatherControls.style.width = \"30px\";\n\t\tweatherControls.style.verticalAlign = \"middle\";\n\t\t// weatherControls.innerHTML = 'Toggle Controls';\n\t\tweatherControls.title = \"Rotate Map Left\";\n\t\tweatherControls.innerHTML = '<svg viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\"> <path id=\"Path\" fill=\"#000000\" stroke=\"none\" d=\"M 16 1.25 C 15.987 1.25 15.971 1.25 15.956 1.25 C 11.466 1.25 7.448 3.276001 4.769 6.464001 L 4.751 6.486 L 4.751 1.716999 C 4.751 1.302999 4.415 0.966999 4.001 0.966999 C 3.587 0.966999 3.251 1.302999 3.251 1.716999 L 3.251 1.716999 L 3.251 8.788 C 3.255 8.818001 3.261 8.845001 3.268 8.869999 L 3.267 8.865 C 3.275 8.970001 3.307 9.067001 3.358 9.15 L 3.356 9.146999 C 3.381 9.193001 3.408 9.232 3.438 9.269001 L 3.437 9.268 C 3.471 9.306 3.508 9.34 3.548 9.369999 L 3.55 9.371 C 3.57 9.390999 3.59 9.41 3.612 9.428001 L 3.613 9.429001 C 3.628 9.438 3.645 9.438 3.661 9.445999 C 3.703 9.466999 3.751 9.485001 3.802 9.497 L 3.807 9.498001 C 3.847 9.511 3.894 9.521 3.942 9.526001 L 3.945 9.526001 C 3.964 9.527 3.981 9.536999 4.001 9.536999 L 11.072 9.536999 C 11.486 9.536999 11.822 9.201 11.822 8.786999 C 11.822 8.373001 11.486 8.036999 11.072 8.036999 L 11.072 8.036999 L 5.429 8.036999 C 7.848 4.813 11.662 2.749001 15.958 2.749001 C 15.973 2.749001 15.988 2.749001 16.003 2.749001 L 16.000999 2.749001 C 23.318001 2.750999 29.247999 8.681999 29.247999 15.999001 C 29.247999 23.316 23.316 29.249001 15.998 29.249001 C 10.743 29.249001 6.203 26.190001 4.061 21.756001 L 4.027 21.677 C 3.903 21.423 3.647 21.250999 3.35 21.250999 C 2.936 21.250999 2.6 21.587 2.6 22.000999 C 2.6 22.117001 2.626 22.226999 2.674 22.325001 L 2.672 22.32 C 5.095 27.344999 10.15 30.750999 16.000999 30.750999 C 24.148001 30.750999 30.752001 24.146999 30.752001 16 C 30.752001 7.853001 24.148001 1.249001 16.002001 1.249001 L 16.002001 1.249001 Z\"/> </svg>';\n\t\tweatherControls.type = \"button\";\n\n\t\tweatherControls.addEventListener(\"click\", function() {adjustMap(\"rotate\", 5);});\n\n\t\treturn weatherControls;\n\t};\n\n\tfunction createRotateForwardControl(map) {\n\t\tconst weatherControls = document.createElement(\"button\");\n\n\t\tweatherControls.id = \"mapRotateForwardButton\";\n\t\tweatherControls.style.backgroundColor = \"rgb(255 255 255 / 0%)\";\n\t\tweatherControls.style.border = \"0\";\n\t\tweatherControls.style.borderRadius = \"3px\";\n\t\tweatherControls.style.cursor = \"pointer\";\n\t\tweatherControls.style.fontSize = \"x-large\";\n\t\tweatherControls.style.textAlign = \"center\";\n\t\t// weatherControls.style.margin = \"10px\";\n\t\tweatherControls.style.height = \"30px\";\n\t\tweatherControls.style.width = \"30px\";\n\t\tweatherControls.style.verticalAlign = \"middle\";\n\t\t// weatherControls.innerHTML = 'Toggle Controls';\n\t\tweatherControls.title = \"Rotate Map Up\";\n\t\tweatherControls.innerHTML = '<svg viewBox=\"0 0 72 72\" xmlns=\"http://www.w3.org/2000/svg\"> <g id=\"Group\"> <path id=\"Path\" fill=\"#000000\" stroke=\"#000000\" stroke-width=\"2\" d=\"M 55.341 31.229 C 54.884998 30.773998 54.144001 30.773998 53.689999 31.229 L 49.511002 35.408001 C 49.466999 26.040001 47.863998 17.225998 44.964001 10.553001 C 41.889999 3.484001 37.687 -0.410004 33.125 -0.410004 C 23.926001 -0.410004 16.725 15.494999 16.725 35.795002 C 16.725 56.097 23.929001 72 33.125 72 C 33.769001 72 34.292 71.475998 34.292 70.831993 C 34.292 70.188995 33.769001 69.663994 33.125 69.663994 C 25.5 69.663994 19.061001 54.153 19.061001 35.795002 C 19.061001 17.438 25.502001 1.926003 33.125 1.926003 C 36.651001 1.926003 40.181 5.411003 42.823002 11.486 C 45.598999 17.865997 47.136002 26.34 47.175999 35.389 L 43.02 31.229 C 42.566002 30.773998 41.825001 30.773998 41.368999 31.229 C 40.915001 31.685001 40.915001 32.424999 41.368999 32.880001 L 48.353001 39.868999 L 55.341999 32.880001 C 55.799 32.424999 55.799 31.685001 55.341 31.229 Z\"/> </g> </svg>';\n\t\tweatherControls.type = \"button\";\n\n\t\tweatherControls.addEventListener(\"click\", function() {adjustMap(\"tilt\", 5);});\n\n\t\treturn weatherControls;\n\t};\n\n\tfunction createRotateBackControl(map) {\n\t\tconst weatherControls = document.createElement(\"button\");\n\n\t\tweatherControls.id = \"mapRotateBackButton\";\n\t\tweatherControls.style.backgroundColor = \"rgb(255 255 255 / 0%)\";\n\t\tweatherControls.style.border = \"0\";\n\t\tweatherControls.style.borderRadius = \"3px\";\n\t\tweatherControls.style.cursor = \"pointer\";\n\t\tweatherControls.style.fontSize = \"x-large\";\n\t\tweatherControls.style.textAlign = \"center\";\n\t\t// weatherControls.style.margin = \"10px\";\n\t\tweatherControls.style.height = \"30px\";\n\t\tweatherControls.style.width = \"30px\";\n\t\tweatherControls.style.verticalAlign = \"middle\";\n\t\t// weatherControls.innerHTML = 'Toggle Controls';\n\t\tweatherControls.title = \"Rotate Map Down\";\n\t\tweatherControls.innerHTML = '<svg viewBox=\"0 0 72 72\" xmlns=\"http://www.w3.org/2000/svg\"> <g id=\"Group-copy\"> <path id=\"Path\" fill=\"#000000\" stroke=\"#000000\" stroke-width=\"2\" d=\"M 17.068624 40.361004 C 17.524626 40.816006 18.265623 40.816006 18.719625 40.361004 L 22.898623 36.182003 C 22.942625 45.550003 24.545628 54.364006 27.445625 61.037003 C 30.519627 68.106003 34.722626 72.000008 39.284626 72.000008 C 48.483627 72.000008 55.684624 56.095005 55.684624 35.795002 C 55.684624 15.493004 48.480625 -0.410004 39.284626 -0.410004 C 38.640625 -0.410004 38.117626 0.113998 38.117626 0.758003 C 38.117626 1.401001 38.640625 1.926003 39.284626 1.926003 C 46.909626 1.926003 53.348625 17.437004 53.348625 35.795002 C 53.348625 54.152004 46.907627 69.664001 39.284626 69.664001 C 35.758625 69.664001 32.228626 66.179001 29.586624 60.104004 C 26.810627 53.724007 25.273624 45.250004 25.233627 36.201004 L 29.389626 40.361004 C 29.843624 40.816006 30.584625 40.816006 31.040627 40.361004 C 31.494625 39.905003 31.494625 39.165005 31.040627 38.710003 L 24.056625 31.721004 L 17.067625 38.710003 C 16.610624 39.165005 16.610624 39.905003 17.068624 40.361004 Z\"/> </g> </svg>';\n\t\tweatherControls.type = \"button\";\n\n\t\tweatherControls.addEventListener(\"click\", function() {adjustMap(\"tilt\", -5);});\n\n\t\treturn weatherControls;\n\t};\n\n\tfunction createUpdateArea(map) {\n\t\tconst updateAreaDiv = document.createElement(\"div\");\n\t\tupdateAreaDiv.id = \"refreshStatusArea\";\n\t\tupdateAreaDiv.style.display = \"flex\";\n\t\tupdateAreaDiv.style.alignItems = \"center\";\n\t\tupdateAreaDiv.style.width = \"fit-content\";\n\t\tupdateAreaDiv.style.padding = \"0 10px\";\n\t\tupdateAreaDiv.style.margin = \"10px 0 0 0\";\n\t\tupdateAreaDiv.style.height = \"40px\";\n\t\tupdateAreaDiv.style.backgroundColor = \"rgb(255 255 255)\";\n\t\t// updateAreaDiv.style.backgroundColor = \"rgba(0, 0, 0,0.7)\";\n\t\t// updateAreaDiv.style.border = \"1px solid lightcoral\";\n\t\tupdateAreaDiv.style.border = \"0\";\n\t\tupdateAreaDiv.style.boxShadow = \"0 1px 4px rgba(0,0,0,0.3)\";\n\t\tupdateAreaDiv.innerHTML = \"Updating...\";\n\t\t// Attach to the map...\n\t\tmap.controls[google.maps.ControlPosition.TOP_LEFT].push(updateAreaDiv);\n\n\t\treturn updateAreaDiv;\n\t}\n\n\tfunction adjustMap(mode, amount) {\n\t\tswitch (mode) {\n\t\t\tcase \"tilt\":\n\t\t\t\tmap.setTilt(map.getTilt() + amount);\n\t\t\t\tmapTilt = map.getTilt();\n\t\t\t\tbreak;\n\t\t\tcase \"rotate\":\n\t\t\t\tmap.setHeading(map.getHeading() + amount);\n\t\t\t\tmapHeading = map.getHeading();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t};\n\t};\n\n\t// Function to load our LogicMonitor data and add pins to the map...\n\tasync function refreshGroupData(timedRefresh = false) {\n\t\t// Capture current time for tracking how long the total refresh takes...\n\t\trefreshStartTime = performance.now();\n\n\t\t// Get the current value of the group path filter field...\n\t\tconst groupPathFilterFieldValue = document.getElementById(\"customGroupFilterField\").value;\n\t\tif (groupPathFilterFieldValue != \"\" && groupPathFilterFieldValue != groupPathFilter) {\n\t\t\tgroupPathFilter = groupPathFilterFieldValue;\n\n\t\t\t// The filter changed so clear any previous markers from the map...\n\t\t\tfor (let i = 0; i < markers.length; i++) {\n\t\t\t\tmarkers[i].setMap(null);\n\t\t\t\tif (typeof clusterer == \"object\") {\n\t\t\t\t\tclusterer.setMap(null);\n\t\t\t\t};\n\t\t\t};\n\t\t\tmarkers = [];\n\t\t} else if (groupPathFilterFieldValue == \"\") {\n\t\t\t// The user cleared the field, so reset it back to the initial value...\n\t\t\tgroupPathFilter = initialGroupPathFilter;\n\t\t};\n\t\tdocument.getElementById(\"customGroupFilterField\").value = groupPathFilter;\n\n\t\t// Get current state of the severity checkboxes on the toolbar...\n\t\tshowCleared = document.getElementById(\"showCleared\").checked;\n\t\tshowWarnings = document.getElementById(\"showWarnings\").checked;\n\t\tshowErrors = document.getElementById(\"showErrors\").checked;\n\t\tshowCriticals = document.getElementById(\"showCriticals\").checked;\n\t\tshowSDT = document.getElementById(\"showSDT\").checked;\n\t\t// If the user unchecked all the severities it'd essentially query all severities, so re-check all the checkboxes if that happens...\n\t\tif (!showCleared && !showWarnings && !showErrors && !showCriticals && !showSDT) {\n\t\t\tdocument.getElementById(\"showCleared\").checked = true;\n\t\t\tdocument.getElementById(\"showWarnings\").checked = true;\n\t\t\tdocument.getElementById(\"showErrors\").checked = true;\n\t\t\tdocument.getElementById(\"showCriticals\").checked = true;\n\t\t\tdocument.getElementById(\"showSDT\").checked = true;\n\t\t};\n\t\t// Get current state of the auto-zoom checkbox on the toolbar...\n\t\tautoResetMapOnRefresh = document.getElementById(\"autoZoom\").checked;\n\n\t\t// If there was a wildcard in the group path then do a \"like\" search, otherwise search for an exact match...\n\t\tlet pathOperator = \":\";\n\t\tif (groupPathFilter.includes(\"*\")) {\n\t\t\tpathOperator = \"~\";\n\t\t};\n\n\t\t// Temporarily disable the toolbar fields to prevent user from refreshing before previous refresh is complete...\n\t\tdocument.getElementById(\"mapOptionsArea\").classList.add(\"disabled\");\n\t\tlet tmpRefreshButton = document.getElementById(\"weatherRefreshButton\");\n\t\tif (tmpRefreshButton != null) {\n\t\t\tdocument.getElementById(\"weatherRefreshButton\").classList.add(\"disabled\");\n\t\t};\n\n\t\t// Clear any previously fetched data...\n\t\tgroupData = [];\n\t\t// For tracking how many groups to fetch & pagination...\n\t\tlet totalGroups = 1000;\n\t\tlet offset = 0;\n\n\t\t// Display our progress to the user...\n\t\tdocument.getElementById(\"refreshStatusArea\").innerHTML = loadingSpinner + \"&nbsp;Updating\";\n\t\tdocument.getElementById(\"refreshStatusArea\").style.display = \"flex\";\n\n\t\t// Prepare to call the LogicMonitor API method...\n\t\tconst httpVerb = \"GET\";\n\n\t\t// List of fields to fetch...\n\t\tlet fieldList = \"alertStatus,displayName,description,id,hostStatus,name,sdtStatus,numOfHosts,numOfAWSDevices,numOfAzureDevices,numOfGcpDevices,numOfKubernetesDevices,numOfDirectDevices,numOfSubGroups,customProperties,autoProperties\";\n\t\t// Only fetch custom & inherited properties on full refreshes...\n\t\tif (cachedAddresses.length == 0 || pollCount > fullRefreshInterval) {\n\t\t\tfullRefresh = true;\n\t\t\tfieldList = fieldList + \",inheritedProperties,systemProperties\";\n\t\t\tpollCount = 0;\n\t\t};\n\n\t\t// Determine whether to fetch groups or resources...\n\t\tlet deviceFilter = \"\";\n\t\tlet resourcePath = \"/device/groups\";\n\t\tif (mapSourceType != \"groups\") {\n\t\t\tresourcePath = \"/device/devices\";\n\t\t\tdeviceFilter = \",deviceType:0|4\";\n\t\t\tif (mapSourceType == \"services\") {\n\t\t\t\tdeviceFilter = \",deviceType:6\";\n\t\t\t};\n\t\t};\n\n\t\t// Set our severity filters to query...\n\t\tlet statusFilter = \"\";\n\t\tlet statusArray = [];\n\t\t// if (!showCleared && showWarnings && showErrors && showCriticals) {\n\t\tif (showCleared) {\n\t\t\tstatusArray.push(\"none\");\n\t\t};\n\t\tif (showWarnings) {\n\t\t\tstatusArray.push(\"*warn*\");\n\t\t};\n\t\tif (showErrors) {\n\t\t\tstatusArray.push(\"*error*\");\n\t\t};\n\t\tif (showCriticals) {\n\t\t\tstatusArray.push(\"*critical*\");\n\t\t};\n\t\tif (statusArray.length > 0) {\n\t\t\tstatusFilter = ',alertStatus:' + '\"' + statusArray.join(\"|\") + '\"';\n\t\t};\n\t\tif (!showSDT) {\n\t\t\tstatusFilter = statusFilter + ',sdtStatus:\"none-none-*\"';\n\t\t}\n\n\t\t// Reset our zoom level when the filter options change...\n\t\tif (centerCalculated && autoZoom && !timedRefresh) {\n\t\t\tcenterCalculated = false;\n\t\t};\n\n\t\t// Start fetching data from LM that have location in custom properties, paginating the data as necessary...\n\t\ttry {\n\t\t\twhile (offset < totalGroups) {\n\t\t\t\t// let queryParams = `?v=3&size=1000&offset=${offset}&fields=${fieldList}&filter=fullPath${pathOperator}\"${groupPathFilter}\"${statusFilter}${deviceFilter}`;\n\t\t\t\tlet queryParams = `?v=3&size=1000&offset=${offset}&fields=${fieldList}&filter=customProperties.name:\"location\",fullPath${pathOperator}\"${groupPathFilter}\"${statusFilter}${deviceFilter}`;\n\n\t\t\t\t// The 'fullpath' attribute only exists for group queries - for devices & services we'll use 'system.groups' instead...\n\t\t\t\tif (mapSourceType != \"groups\") {\n\t\t\t\t\tif (groupPathFilter != \"*\") {\n\t\t\t\t\t\t// Strip off leading or trailing asterisks since they're not needed in this case...\n\t\t\t\t\t\tlet tmpPathFilter = groupPathFilter.replace(/^\\*/, \"\").replace(/\\*$/, \"\");\n\t\t\t\t\t\tif (tmpPathFilter != \"\") {\n\t\t\t\t\t\t\t// queryParams = '?v=3&size=1000&offset=' + offset + '&filter=systemProperties~\"{\\\\\"name\\\\\":\\\\\"system.groups\\\\\",\\\\\"value\\\\\":\\\\\"*' + tmpPathFilter + '*\\\\\"}\"' + statusFilter + deviceFilter;\n\t\t\t\t\t\t\tqueryParams = '?v=3&size=1000&offset=' + offset + '&filter=customProperties.name:\"location\",systemProperties~\"{\\\\\"name\\\\\":\\\\\"system.groups\\\\\",\\\\\"value\\\\\":\\\\\"*' + tmpPathFilter + '*\\\\\"}\"' + statusFilter + deviceFilter;\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tqueryParams = '?v=3&size=1000&offset=' + offset + '&filter=customProperties.name:\"location\"' + statusFilter + deviceFilter;\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\t// Call the LogicMonitor API to get a list of groups...\n\t\t\t\tconst markerData = await LMClient({\n\t\t\t\t\tresourcePath: resourcePath,\n\t\t\t\t\tqueryParams: queryParams,\n\t\t\t\t\thttpVerb: httpVerb,\n\t\t\t\t\tpostBody: null,\n\t\t\t\t\tapiVersion: '3',\n\t\t\t\t});\n\t\t\t\t// Process the group data we received...\n\t\t\t\tconsole.debug('Group request succeeded with JSON response', markerData);\n\n\t\t\t\tif (markerData.total != 0) {\n\t\t\t\t\tif (markerData.total != totalGroups) {\n\t\t\t\t\t\ttotalGroups = markerData.total;\n\t\t\t\t\t};\n\n\t\t\t\t\tgroupData = groupData.concat(markerData.items);\n\n\t\t\t\t\toffset = groupData.length;\n\n\t\t\t\t\t// Display our progress to the user...\n\t\t\t\t\tdocument.getElementById(\"refreshStatusArea\").innerHTML = loadingSpinner + \"&nbsp;Updating: \" + offset + \" of \" + totalGroups + \" (\" + Math.round(offset/totalGroups*100) + \"%)\";\n\t\t\t\t\t// document.getElementById(\"refreshStatusArea\").innerHTML = \"Updating: \" + Math.round(offset/totalGroups*100) + \"%\";\n\t\t\t\t} else {\n\t\t\t\t\t// Indicate that no results were found...\n\t\t\t\t\tif (offset == 0) {\n\t\t\t\t\t\tconsole.debug('No results found');\n\t\t\t\t\t\tdocument.getElementById(\"refreshStatusArea\").innerHTML = \"<span class='noResultMessage'>No results</span>\";\n\t\t\t\t\t\ttotalGroups = -1; // Stop the loop\n\t\t\t\t\t\t// Re-enable the toolbar fields...\n\t\t\t\t\t\tdocument.getElementById(\"mapOptionsArea\").classList.remove(\"disabled\");\n\t\t\t\t\t\tif (tmpRefreshButton != null) {\n\t\t\t\t\t\t\tdocument.getElementById(\"weatherRefreshButton\").classList.remove(\"disabled\");\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Clear any previous markers from the map...\n\t\t\t\t\t\tfor (let i = 0; i < markers.length; i++) {\n\t\t\t\t\t\t\tmarkers[i].setMap(null);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tmarkers = [];\n\t\t\t\t\t\tif (typeof clusterer == \"object\") {\n\t\t\t\t\t\t\tclusterer.setMap(null);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Reset the map zoom...\n\t\t\t\t\t\tbounds = new google.maps.LatLngBounds();\n\t\t\t\t\t\tresetZoom();\n\t\t\t\t\t\tcenterCalculated = false;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t};\n\n\n\t\t\t// Start fetching data from LM that have location in inherited properties, paginating the data as necessary...\n\t\t\t// Inherited properties don't apply to groups, so skip this if not looking at resources and/or services...\n\t\t\tconsole.debug('totalGroups: ' + totalGroups);\n\t\t\tif (mapSourceType != \"groups\" && pollInheritedLocations) {\n\t\t\t\toffset = 0;\n\t\t\t\tlet tmpTotalGroups = 1000;\n\t\t\t\twhile (offset < tmpTotalGroups) {\n\t\t\t\t\t// let queryParams = `?v=3&size=1000&offset=${offset}&fields=${fieldList}&filter=fullPath${pathOperator}\"${groupPathFilter}\"${statusFilter}${deviceFilter}`;\n\t\t\t\t\tlet queryParams = `?v=3&size=1000&offset=${offset}&fields=${fieldList}&filter=inheritedProperties.name:\"location\",fullPath${pathOperator}\"${groupPathFilter}\"${statusFilter}${deviceFilter}`;\n\n\t\t\t\t\t// The 'fullpath' attribute only exists for group queries - for devices & services we'll use 'system.groups' instead...\n\t\t\t\t\tif (groupPathFilter != \"*\") {\n\t\t\t\t\t\t// Strip off leading or trailing asterisks since they're not needed in this case...\n\t\t\t\t\t\tlet tmpPathFilter = groupPathFilter.replace(/^\\*/, \"\").replace(/\\*$/, \"\");\n\t\t\t\t\t\tif (tmpPathFilter != \"\") {\n\t\t\t\t\t\t\t// queryParams = '?v=3&size=1000&offset=' + offset + '&filter=systemProperties~\"{\\\\\"name\\\\\":\\\\\"system.groups\\\\\",\\\\\"value\\\\\":\\\\\"*' + tmpPathFilter + '*\\\\\"}\"' + statusFilter + deviceFilter;\n\t\t\t\t\t\t\tqueryParams = '?v=3&size=1000&offset=' + offset + '&filter=inheritedProperties.name:\"location\",systemProperties~\"{\\\\\"name\\\\\":\\\\\"system.groups\\\\\",\\\\\"value\\\\\":\\\\\"*' + tmpPathFilter + '*\\\\\"}\"' + statusFilter + deviceFilter;\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tqueryParams = '?v=3&size=1000&offset=' + offset + '&filter=inheritedProperties.name:\"location\"' + statusFilter + deviceFilter;\n\t\t\t\t\t};\n\t\t\t\t\t// console.debug(\"Query params for inherited locations: \" + queryParams);\n\n\t\t\t\t\t// Call the LogicMonitor API to get a list of groups...\n\t\t\t\t\tconst markerData = await LMClient({\n\t\t\t\t\t\tresourcePath: resourcePath,\n\t\t\t\t\t\tqueryParams: queryParams,\n\t\t\t\t\t\thttpVerb: httpVerb,\n\t\t\t\t\t\tpostBody: null,\n\t\t\t\t\t\tapiVersion: '3',\n\t\t\t\t\t});\n\t\t\t\t\t// Process the group data we received...\n\t\t\t\t\t// console.debug('Group request succeeded with JSON response', markerData);\n\n\t\t\t\t\t// console.debug(\"Inherited locations found: \" + markerData.total);\n\t\t\t\t\tif (markerData.total != 0) {\n\t\t\t\t\t\tif (markerData.total != tmpTotalGroups) {\n\t\t\t\t\t\t\ttmpTotalGroups = markerData.total;\n\t\t\t\t\t\t\tif (totalGroups >= 0) {\n\t\t\t\t\t\t\t\ttotalGroups = totalGroups + markerData.total;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttotalGroups = markerData.total;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tgroupData = groupData.concat(markerData.items);\n\n\t\t\t\t\t\toffset = groupData.length;\n\n\t\t\t\t\t\t// Display our progress to the user...\n\t\t\t\t\t\tdocument.getElementById(\"refreshStatusArea\").innerHTML = loadingSpinner + \"&nbsp;Updating: \" + offset + \" of \" + tmpTotalGroups + \" (\" + Math.round(offset/tmpTotalGroups*100) + \"%)\";\n\t\t\t\t\t\t// document.getElementById(\"refreshStatusArea\").innerHTML = \"Updating: \" + Math.round(offset/totalGroups*100) + \"%\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We're done so stop the loop...\n\t\t\t\t\t\t// console.debug(\"We're done fetching inherited locations\");\n\t\t\t\t\t\ttmpTotalGroups = 0;\n\t\t\t\t\t\toffset = totalGroups;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\t// console.debug(\"totalGroups: \" + totalGroups + \" / tmpTotalGroups: \" + tmpTotalGroups + \" / offset: \" + offset);\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching group data:', error);\n\t\t\tdocument.getElementById(\"refreshStatusArea\").innerHTML = `<span class='noResultMessage'>Error loading data: ${error.message || 'Unknown error'}</span>`;\n\t\t\ttotalGroups = -1; // Stop the loop on error\n\t\t\t// Re-enable the toolbar fields...\n\t\t\tdocument.getElementById(\"mapOptionsArea\").classList.remove(\"disabled\");\n\t\t\tif (tmpRefreshButton != null) {\n\t\t\t\tdocument.getElementById(\"weatherRefreshButton\").classList.remove(\"disabled\");\n\t\t\t};\n\t\t}\n\n\t\t// If we've finished fetching all the group/resource data...\n\t\tif (offset == totalGroups) {\n\t\t\tconsole.debug('Total groups processed: ' + totalGroups);\n\t\t\t// Reset our progress indicator...\n\t\t\tdocument.getElementById(\"refreshStatusArea\").innerHTML = \"\";\n\t\t\tdocument.getElementById(\"refreshStatusArea\").style.display = \"none\";\n\t\t\t// Re-enable the toolbar fields...\n\t\t\tdocument.getElementById(\"mapOptionsArea\").classList.remove(\"disabled\");\n\t\t\tif (tmpRefreshButton != null) {\n\t\t\t\tdocument.getElementById(\"weatherRefreshButton\").classList.remove(\"disabled\");\n\t\t\t};\n\n\t\t\t// Prepare Google geocoding for translating a street address to latitude & longitude...\n\t\t\tconst geocoder = new google.maps.Geocoder();\n\t\t\tconst parser = new DOMParser();\n\n\t\t\tlet itemsProcessed = 0;\n\n\t\t\t// Clear any previous markers from the map...\n\t\t\tfor (let i = 0; i < markers.length; i++) {\n\t\t\t\tmarkers[i].setMap(null);\n\t\t\t};\n\t\t\tmarkers = [];\n\n\t\t\t// For use in zooming the map to encompass all our markers on initial draw...\n\t\t\tbounds = new google.maps.LatLngBounds();\n\n\t\t\t// Start looping through the groups...\n\t\t\tgroupData.forEach((thisItem) => {\n\t\t\t\tlet groupID = thisItem.id;\n\t\t\t\tlet highestSeverity = \"\";\n\t\t\t\tlet sdtStatus = \"\";\n\n\t\t\t\t// Parse the alarm status...\n\t\t\t\tlet alertStatusArray = thisItem.alertStatus.match(/([\\w]+)-([\\w]+)-([\\w]+)/);\n\t\t\t\tif (alertStatusArray) {\n\t\t\t\t\tlet alertStatus = alertStatusArray[1];\n\t\t\t\t\tlet alertSeverity = alertStatusArray[2];\n\n\t\t\t\t\tif ((alertSeverity == \"warn\" && highestSeverity == \"\") || (alertSeverity == \"error\" && highestSeverity != \"critical\") || (alertSeverity == \"critical\")) {\n\t\t\t\t\t\thighestSeverity = alertSeverity;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\t// Parse the SDT status...\n\t\t\t\tlet sdtStatusArray = thisItem.sdtStatus.match(/([\\w]+)-([\\w]+)-([\\w]+)/);\n\t\t\t\tif (sdtStatusArray[1].toLowerCase() == \"sdt\" || sdtStatusArray[2].toLowerCase() == \"sdt\") {\n\t\t\t\t\tsdtStatus = \"sdt\";\n\t\t\t\t};\n\n\t\t\t\t// Variables for each severity...\n\t\t\t\t// The SVG icon for the group's severity...\n\t\t\t\tlet sevIcon = clearedIcon;\n\t\t\t\t// We'll use the pin's z-index to reflect the group's severity for use with marker clustering...\n\t\t\t\tlet pinIndex = 0;\n\t\t\t\tif (highestSeverity != \"\") {\n\t\t\t\t\tif (highestSeverity == \"warn\") {\n\t\t\t\t\t\tsevIcon = warningIcon;\n\t\t\t\t\t\tpinBG = \"#f5ca1d\";\n\t\t\t\t\t\tpinBorder = \"#967c14\";\n\t\t\t\t\t\tpinIndex = 1;\n\t\t\t\t\t} else if (highestSeverity == \"error\") {\n\t\t\t\t\t\tsevIcon = errorIcon;\n\t\t\t\t\t\tpinBG = \"#ff8c00\";\n\t\t\t\t\t\tpinBorder = \"#ac5101\";\n\t\t\t\t\t\tpinIndex = 2;\n\t\t\t\t\t} else if (highestSeverity == \"critical\") {\n\t\t\t\t\t\tsevIcon = criticalIcon;\n\t\t\t\t\t\tpinBG = \"#e0351b\";\n\t\t\t\t\t\tpinBorder = \"#9a2614\";\n\t\t\t\t\t\tpinIndex = 3;\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\thighestSeverity = \"clear\";\n\t\t\t\t};\n\n\t\t\t\t// If in SDT...\n\t\t\t\tif (sdtStatus == \"sdt\") {\n\t\t\t\t\thighestSeverity = \"sdt\";\n\t\t\t\t\tsevIcon = sdtIcon;\n\t\t\t\t\tpinBG = \"#00a1fe\";\n\t\t\t\t\tpinBorder = \"#00a1fe\";\n\t\t\t\t\tpinIndex = 4;\n\t\t\t\t};\n\n\t\t\t\t// Get the group's location (hopefully an address)...\n\t\t\t\tlet address = \"\";\n\t\t\t\tlet latProp = \"\";\n\t\t\t\tlet lngProp = \"\";\n\t\t\t\talreadyGeocoded = false;\n\t\t\t\t// First check to see if the location is in custom properties (defined on the group/resource itself)...\n\t\t\t\tif (fullRefresh) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\taddress = thisItem.customProperties.find((locationProp) => locationProp.name.toLowerCase() === \"location\").value;\n\n\t\t\t\t\t\t// See if there are custom properties for latitude and longitude...\n\t\t\t\t\t\tif (!ignoreLatLongProps) {\n\t\t\t\t\t\t\tlatProp = thisItem.customProperties.find((locationProp) => locationProp.name.toLowerCase() === \"latitude\");\n\t\t\t\t\t\t\tlngProp = thisItem.customProperties.find((locationProp) => locationProp.name.toLowerCase() === \"longitude\");\n\t\t\t\t\t\t\tif (latProp && lngProp) {\n\t\t\t\t\t\t\t\tlet latVal = Number(latProp.value);\n\t\t\t\t\t\t\t\tlet lngVal = Number(lngProp.value);\n\t\t\t\t\t\t\t\tif (latVal > -90 && latVal < 90 && lngVal > -180 && lngVal < 180) {\n\t\t\t\t\t\t\t\t\t// address = `${latProp.value}, ${lngProp.value}`;\n\t\t\t\t\t\t\t\t\talreadyGeocoded = true;\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t// If not found in custom properties, try to get it from inherited properties...\n\t\t\t\t\t\t\taddress = thisItem.inheritedProperties.find((locationProp) => locationProp.name.toLowerCase() === \"location\").value;\n\n\t\t\t\t\t\t\t// See if there are inherited properties for latitude and longitude...\n\t\t\t\t\t\t\tif (!ignoreLatLongProps) {\n\t\t\t\t\t\t\t\tlatProp = thisItem.inheritedProperties.find((locationProp) => locationProp.name.toLowerCase() === \"latitude\");\n\t\t\t\t\t\t\t\tlngProp = thisItem.inheritedProperties.find((locationProp) => locationProp.name.toLowerCase() === \"longitude\");\n\t\t\t\t\t\t\t\tif (latProp && lngProp) {\n\t\t\t\t\t\t\t\t\tlet latVal = Number(latProp.value);\n\t\t\t\t\t\t\t\t\tlet lngVal = Number(lngProp.value);\n\t\t\t\t\t\t\t\t\tif (latVal > -90 && latVal < 90 && lngVal > -180 && lngVal < 180) {\n\t\t\t\t\t\t\t\t\t\t// address = `${latProp.value}, ${lngProp.value}`;\n\t\t\t\t\t\t\t\t\t\talreadyGeocoded = true;\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} catch(y) {\n\t\t\t\t\t\t\t// console.log(\"No address found for \" + thisItem.name);\n\t\t\t\t\t\t\t// totalGroups = totalGroups - 1;\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\t// Remove any extraneous characters from the address...\n\t\t\t\taddress = address.trim().replaceAll(\"\\t\", \"\").replaceAll(\"\\n\", \", \");\n\n\t\t\t\tresolveAddress(thisItem, address);\n\n\t\t\t\t// Resolve locations to latitude/longitude...\n\t\t\t\tasync function resolveAddress(thisItem, address) {\n\t\t\t\t\t// console.debug('Resolving address for ' + thisItem.name + ': ' + address);\n\t\t\t\t\t// Check to see if we've already geocoded this group's address and that the address hasn't changed...\n\t\t\t\t\tif (cachedAddresses[thisItem.id] && cachedAddresses[thisItem.id].address == address) {\n\t\t\t\t\t\tconsole.debug('Address already geocoded for ' + thisItem.name + ': ' + address);\n\t\t\t\t\t\t// Call the subfunction to add the group to the map...\n\t\t\t\t\t\tplotMarker(thisItem, cachedAddresses[thisItem.id].lat, cachedAddresses[thisItem.id].lng, cachedAddresses[thisItem.id].address);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (alreadyGeocoded) {\n\t\t\t\t\t\t\t// console.debug('Address already geocoded as custom properties for ' + thisItem.name + ': ' + address);\n\t\t\t\t\t\t\t// Cache the address for reuse...\n\t\t\t\t\t\t\tcachedAddresses[thisItem.id] = {lat: Number(latProp.value), lng: Number(lngProp.value), address: address};\n\t\t\t\t\t\t\tsaveCache();\n\t\t\t\t\t\t\t// Call the subfunction to add the group to the map...\n\t\t\t\t\t\t\tplotMarker(thisItem, cachedAddresses[thisItem.id].lat, cachedAddresses[thisItem.id].lng, cachedAddresses[thisItem.id].address);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// See if the location is a latitude/longitude...\n\t\t\t\t\t\t\tconst coodinateRE = /^([\\-]*[\\d]+[\\.\\d]+)[ ,]+([\\-]*[\\d]+[\\.\\d]+)$/;\n\t\t\t\t\t\t\tlet match = coodinateRE.exec(address);\n\t\t\t\t\t\t\tif (match && match.length == 3) {\n\t\t\t\t\t\t\t\t// It appears we have a latitude & longitude. Cache them for reuse...\n\t\t\t\t\t\t\t\tcachedAddresses[thisItem.id] = {lat: Number(match[1]), lng: Number(match[2]), address: address};\n\t\t\t\t\t\t\t\tsaveCache();\n\t\t\t\t\t\t\t\t// Call the subfunction to add the group to the map...\n\t\t\t\t\t\t\t\tplotMarker(thisItem, cachedAddresses[thisItem.id].lat, cachedAddresses[thisItem.id].lng, address);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Attempt to geocode the address...\n\t\t\t\t\t\t\t\tgeocoder.geocode( {'address': address}, function(results, status) {\n\t\t\t\t\t\t\t\t\tif (status == 'OK') {\n\t\t\t\t\t\t\t\t\t\t// Grab the longitude/latitude from the results...\n\t\t\t\t\t\t\t\t\t\tlet geocodedLocation = results[0].geometry.location;\n\n\t\t\t\t\t\t\t\t\t\t// Cache these coordinates for reuse later...\n\t\t\t\t\t\t\t\t\t\tcachedAddresses[thisItem.id] = {lat: Number(geocodedLocation.lat()), lng: Number(geocodedLocation.lng()), address: address};\n\t\t\t\t\t\t\t\t\t\tsaveCache();\n\t\t\t\t\t\t\t\t\t\t// Call the subfunction to add the group to the map...\n\t\t\t\t\t\t\t\t\t\tplotMarker(thisItem, cachedAddresses[thisItem.id].lat, cachedAddresses[thisItem.id].lng, address);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// We weren't provided a resolvable address, so deduct this item from our overall count...\n\t\t\t\t\t\t\t\t\t\ttotalGroups = totalGroups - 1;\n\t\t\t\t\t\t\t\t\t\t// We still call the `plotMarker` even though there's no marker to plot in case this was the last one to process...\n\t\t\t\t\t\t\t\t\t\tplotMarker(thisItem, null, null, null);\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\t// Subfunction to add markers to the map...\n\t\t\t\tasync function plotMarker(thisItem, lat, lng, address) {\n\t\t\t\t\tif (address != null) {\n\t\t\t\t\t\t// Start creating content for the group's map pin...\n\t\t\t\t\t\tconst content = document.createElement(\"div\");\n\t\t\t\t\t\tlet customContent = \"\";\n\n\t\t\t\t\t\t// Search the item's properties for any specified to display...\n\t\t\t\t\t\tif (displayProps != \"\") {\n\t\t\t\t\t\t\tconst propList = displayProps.split(\",\");\n\t\t\t\t\t\t\tpropList.forEach(thisProp => {\n\t\t\t\t\t\t\t\t// Check the custom properties...\n\t\t\t\t\t\t\t\tif (thisItem.customProperties) {\n\t\t\t\t\t\t\t\t\tlet propArray = thisItem.customProperties.filter(item => item.name == thisProp.trim());\n\t\t\t\t\t\t\t\t\tif (propArray.length == 1) {\n\t\t\t\t\t\t\t\t\t\tcustomContent = `${customContent}<div class=\"customItem\"><span class=\"customItemName\">${propArray[0].name}</span>: ${propArray[0].value}</div>`;\n\t\t\t\t\t\t\t\t\t// Check inherited properties...\n\t\t\t\t\t\t\t\t\t} else if (thisItem.inheritedProperties) {\n\t\t\t\t\t\t\t\t\t\tpropArray = thisItem.inheritedProperties.filter(item => item.name == thisProp.trim());\n\t\t\t\t\t\t\t\t\t\tif (propArray.length == 1) {\n\t\t\t\t\t\t\t\t\t\t\tcustomContent = `${customContent}<div class=\"customItem\"><span class=\"customItemName\">${propArray[0].name}</span>: ${propArray[0].value}</div>`;\n\t\t\t\t\t\t\t\t\t\t// Check auto properties...\n\t\t\t\t\t\t\t\t\t\t} else if (thisItem.autoProperties) {\n\t\t\t\t\t\t\t\t\t\t\tpropArray = thisItem.autoProperties.filter(item => item.name == thisProp.trim());\n\t\t\t\t\t\t\t\t\t\t\tif (propArray.length == 1) {\n\t\t\t\t\t\t\t\t\t\t\t\tcustomContent = `${customContent}<div class=\"customItem\"><span class=\"customItemName\">${propArray[0].name}</span>: ${propArray[0].value}</div>`;\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (customContent != \"\") {\n\t\t\t\t\t\t\t\tcustomContent = `<div class=\"customItemArea\">${customContent}</div>`;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\n\n\t\t\t\t\t\t// Look to see if connecting line info has been provided...\n\t\t\t\t\t\tif (thisItem.autoProperties) {\n\t\t\t\t\t\t\tlet propArray = thisItem.autoProperties.filter(item => item.name == connectionInfoProp);\n\t\t\t\t\t\t\tif (propArray.length == 1) {\n\t\t\t\t\t\t\t\t// Multiple connections to an endpoint can be specifed by separating them with a semicolon...\n\t\t\t\t\t\t\t\tconst connectionItems = propArray[0].value.split(\";\");\n\n\t\t\t\t\t\t\t\t// Loop through the connections...\n\t\t\t\t\t\t\t\tconnectionItems.forEach(thisConnection => {\n\t\t\t\t\t\t\t\t\t// Split the comma-separated parameters...\n\t\t\t\t\t\t\t\t\tlet params = thisConnection.split(\",\");\n\n\t\t\t\t\t\t\t\t\tif (params.length > 0) {\n\t\t\t\t\t\t\t\t\t\tlet tmp = {};\n\t\t\t\t\t\t\t\t\t\ttmp.connectionName = params[0].trim();\n\t\t\t\t\t\t\t\t\t\ttmp.datasourceID = params[1].trim();\n\t\t\t\t\t\t\t\t\t\ttmp.instanceID = params[2].trim();\n\t\t\t\t\t\t\t\t\t\ttmp.deviceIDSource = thisItem.id;\n\t\t\t\t\t\t\t\t\t\ttmp.deviceIDConnected = params[3].trim();\n\t\t\t\t\t\t\t\t\t\t// TODO: Maybe add support for another parameter for the source device ID to support group connections.\n\n\t\t\t\t\t\t\t\t\t\tlineData[`${tmp.deviceIDSource}${tmp.deviceIDConnected}`] = tmp;\n\t\t\t\t\t\t\t\t\t\t// lineData[tmp.deviceIDSource + \":\" + tmp.deviceIDConnected] = tmp;\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tcontent.classList.add(\"group\");\n\t\t\t\t\t\t// The pin's z-index gets overwritten when clicked to show details, so capture the original severity in the pin's metadata...\n\t\t\t\t\t\tcontent.dataset.severity = pinIndex;\n\t\t\t\t\t\t// Create the content shown when the pin is clicked...\n\t\t\t\t\t\tif (mapSourceType == \"groups\") {\n\t\t\t\t\t\t\t// Capture the group's description...\n\t\t\t\t\t\t\tlet groupDescription = thisItem.description;\n\t\t\t\t\t\t\t// If the group doesn't have a description then fallback to showing the address...\n\t\t\t\t\t\t\tif (groupDescription == \"\") {\n\t\t\t\t\t\t\t\tgroupDescription = address;\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tcontent.innerHTML = `\n\t\t\t\t\t\t\t\t<div class=\"icon ${highestSeverity}\">\n\t\t\t\t\t\t\t\t\t${sevIcon}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"details\">\n\t\t\t\t\t\t\t\t\t<div class=\"groupName\"><a href=\"/santaba/uiv4/resources/treeNodes/t-dg,id-${thisItem.id}?source=details\" target=\"_blank\">${thisItem.name}</a></div>\n\t\t\t\t\t\t\t\t\t<div class=\"description\">${groupDescription}${customContent}</div>\n\t\t\t\t\t\t\t\t\t<div class=\"features\">\n\t\t\t\t\t\t\t\t\t\t<div title=\"${thisItem.numOfHosts} Standard Devices\">\n\t\t\t\t\t\t\t\t\t\t\t<svg aria-hidden=\"true\" class=\"svg-inline--fa fa-server fa-lg server\" aria-labelledby=\"svg-inline--fa-title-yo645GLpJ5j9\" data-prefix=\"fas\" data-icon=\"server\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M64 32C28.7 32 0 60.7 0 96v64c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM344 152c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24zm96-24c0 13.3-10.7 24-24 24s-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24zM64 288c-35.3 0-64 28.7-64 64v64c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V352c0-35.3-28.7-64-64-64H64zM344 408c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24zm104-24c0 13.3-10.7 24-24 24s-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24z\"></path></svg>\n\t\t\t\t\t\t\t\t\t\t\t<span>${thisItem.numOfHosts}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div title=\"${thisItem.numOfAWSDevices + thisItem.numOfAzureDevices + thisItem.numOfGcpDevices} Cloud Devices\">\n\t\t\t\t\t\t\t\t\t\t\t<svg aria-hidden=\"true\" class=\"svg-inline--fa fa-cloud fa-lg cloud\" aria-labelledby=\"svg-inline--fa-title-b2yP7d2t26bK\" data-prefix=\"fas\" data-icon=\"cloud\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M0 336c0 79.5 64.5 144 144 144H512c70.7 0 128-57.3 128-128c0-61.9-44-113.6-102.4-125.4c4.1-10.7 6.4-22.4 6.4-34.6c0-53-43-96-96-96c-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32C167.6 32 96 103.6 96 192c0 2.7 .1 5.4 .2 8.1C40.2 219.8 0 273.2 0 336z\"></path></svg>\n\t\t\t\t\t\t\t\t\t\t\t<span>${thisItem.numOfAWSDevices + thisItem.numOfAzureDevices + thisItem.numOfGcpDevices}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div title=\"${thisItem.numOfKubernetesDevices} Kubernetes Devices\">\n\t\t\t\t\t\t\t\t\t\t\t<svg aria-hidden=\"true\" class=\"svg-inline--fa fa-dharmachakra fa-lg k8s\" aria-labelledby=\"svg-inline--fa-title-2sqfwGcxdo3a\" data-prefix=\"fas\" data-icon=\"dharmachakra\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M337.8 205.7l48.6-42.5c13.8 19.3 23.4 41.9 27.4 66.2l-64.4 4.3c-2.4-10.1-6.4-19.5-11.6-28zm140.1 19.5c-5.3-38.8-20.6-74.5-43.2-104.3l.8-.7C449 108.4 449.7 87.6 437 75s-33.4-12-45.2 1.5l-.7 .8c-29.8-22.6-65.5-37.9-104.3-43.2l.1-1.1c1.2-17.9-13-33-30.9-33s-32.1 15.2-30.9 33l.1 1.1c-38.8 5.3-74.5 20.6-104.3 43.2l-.7-.8C108.4 63 87.6 62.3 75 75s-12 33.4 1.5 45.2l.8 .7c-22.6 29.8-37.9 65.5-43.2 104.3l-1.1-.1c-17.9-1.2-33 13-33 30.9s15.2 32.1 33 30.9l1.1-.1c5.3 38.8 20.6 74.5 43.2 104.3l-.8 .7C63 403.6 62.3 424.4 75 437s33.4 12 45.2-1.5l.7-.8c29.8 22.6 65.5 37.9 104.3 43.2l-.1 1.1c-1.2 17.9 13 33 30.9 33s32.1-15.2 30.9-33l-.1-1.1c38.8-5.3 74.5-20.6 104.3-43.2l.7 .8c11.8 13.5 32.5 14.2 45.2 1.5s12-33.4-1.5-45.2l-.8-.7c22.6-29.8 37.9-65.5 43.2-104.3l1.1 .1c17.9 1.2 33-13 33-30.9s-15.2-32.1-33-30.9l-1.1 .1zM163.2 125.6c19.3-13.8 41.9-23.4 66.2-27.5l4.3 64.4c-10 2.4-19.5 6.4-28 11.6l-42.5-48.6zm-65 103.8c4.1-24.4 13.7-46.9 27.5-66.2l48.6 42.5c-5.3 8.5-9.2 18-11.6 28l-64.4-4.3zm27.5 119.4c-13.8-19.3-23.4-41.9-27.5-66.2l64.4-4.3c2.4 10 6.4 19.5 11.6 28l-48.6 42.5zm103.8 65c-24.4-4.1-46.9-13.7-66.2-27.4l42.5-48.6c8.5 5.3 18 9.2 28 11.6l-4.3 64.4zm119.4-27.4c-19.3 13.8-41.9 23.4-66.2 27.4l-4.3-64.4c10-2.4 19.5-6.4 28-11.6l42.5 48.6zm65-103.8c-4.1 24.4-13.7 46.9-27.4 66.2l-48.6-42.5c5.3-8.5 9.2-18 11.6-28l64.4 4.3zm-65-156.9l-42.5 48.6c-8.6-5.3-18-9.2-28-11.6l4.3-64.4c24.4 4.1 46.9 13.7 66.2 27.5zM256 288c-17.7 0-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32s-14.3 32-32 32z\"></path></svg>\n\t\t\t\t\t\t\t\t\t\t\t<span>${thisItem.numOfKubernetesDevices}</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"drillDownButton\" title=\"Open group in new tab\">\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"/santaba/uiv4/resources/treeNodes/t-dg,id-${thisItem.id}?source=details\" target=\"_blank\" class=\"link\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-arrow-up-right-from-square fa-lg link\" aria-labelledby=\"svg-inline--fa-title-H1L2MLago4gd\" data-prefix=\"fas\" data-icon=\"arrow-up-right-from-square\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M288 32c-17.7 0-32 14.3-32 32s14.3 32 32 32h50.7L169.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L384 141.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32H288zM80 64C35.8 64 0 99.8 0 144V400c0 44.2 35.8 80 80 80H336c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v80c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16h80c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z\"></path></svg></a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Capture the group's description...\n\t\t\t\t\t\t\tlet groupDescription = thisItem.description;\n\t\t\t\t\t\t\t// If the group doesn't have a description then fallback to showing the address...\n\t\t\t\t\t\t\tif (groupDescription == \"\") {\n\t\t\t\t\t\t\t\tgroupDescription = \"Host:\" + thisItem.name + \"<br/>Address: \" + cachedAddresses[groupID].address;\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tcontent.innerHTML = `\n\t\t\t\t\t\t\t\t<div class=\"icon ${highestSeverity}\">\n\t\t\t\t\t\t\t\t\t${sevIcon}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"details\">\n\t\t\t\t\t\t\t\t\t<div class=\"groupName\"><a href=\"/santaba/uiv4/resources/treeNodes/t-d,id-${thisItem.id}?source=details&tab=alert\" target=\"_blank\">${thisItem.displayName}</a></div>\n\t\t\t\t\t\t\t\t\t<div class=\"description\">${groupDescription}${customContent}</div>\n\t\t\t\t\t\t\t\t\t<div class=\"features\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"drillDownButton\" title=\"Open group in new tab\">\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"/santaba/uiv4/resources/treeNodes/t-d,id-${thisItem.id}?source=details&tab=alert\" target=\"_blank\" class=\"link\"><svg aria-hidden=\"true\" class=\"svg-inline--fa fa-arrow-up-right-from-square fa-lg link\" aria-labelledby=\"svg-inline--fa-title-H1L2MLago4gd\" data-prefix=\"fas\" data-icon=\"arrow-up-right-from-square\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M288 32c-17.7 0-32 14.3-32 32s14.3 32 32 32h50.7L169.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L384 141.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32H288zM80 64C35.8 64 0 99.8 0 144V400c0 44.2 35.8 80 80 80H336c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v80c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16h80c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z\"></path></svg></a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Add this group's pin to the map...\n\t\t\t\t\t\tlet marker = new google.maps.marker.AdvancedMarkerElement({\n\t\t\t\t\t\t\tposition: { lat: cachedAddresses[groupID].lat, lng: cachedAddresses[groupID].lng },\n\t\t\t\t\t\t\tmap: map,\n\t\t\t\t\t\t\tcontent: content,\n\t\t\t\t\t\t\t// content: glyphSvgPinElement.element,\n\t\t\t\t\t\t\ttitle: thisItem.name,\n\t\t\t\t\t\t\tzIndex: pinIndex,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Open info window when marker is clicked...\n\t\t\t\t\t\tmarker.addListener(\"gmp-click\", () => {\n\t\t\t\t\t\t\ttoggleHighlight(marker, thisItem)\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Add reference to this pin for use by the clustering algorithm or if we need to modify them later...\n\t\t\t\t\t\tmarkers.push(marker);\n\n\t\t\t\t\t\t// Add this marker to map's bounding box (for initial zooming)...\n\t\t\t\t\t\tbounds.extend(marker.position);\n\n\t\t\t\t\t\titemsProcessed = itemsProcessed + 1;\n\t\t\t\t\t};\n\t\t\t\t\t// console.log(\"itemsProcessed: \" + itemsProcessed + \" / totalGroups: \" + totalGroups);\n\n\t\t\t\t\t// If all items have been processed, initialize the marker cluster...\n\t\t\t\t\tif (itemsProcessed == totalGroups) {\n\t\t\t\t\t\t// If this is the first time drawing the map, center the map based on our markers...\n\t\t\t\t\t\tif (!centerCalculated || (timedRefresh && autoResetMapOnRefresh)) {\n\t\t\t\t\t\t\tresetZoom();\n\t\t\t\t\t\t\tcenterCalculated = true;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (!disableClustering) {\n\t\t\t\t\t\t\t// Reset our marker clustering on refreshes...\n\t\t\t\t\t\t\tif (typeof clusterer == \"object\") {\n\t\t\t\t\t\t\t\tclusterer.setMap(null);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t// We'll use MarkerCluster's SuperClusterAlgorithm since it's more optimized (the radius is to prevent overlap of clusters & markers)...\n\t\t\t\t\t\t\tconst algorithm = new markerClusterer.SuperClusterAlgorithm({radius: 120});\n\t\t\t\t\t\t\t// Initialize our marker clusters...\n\t\t\t\t\t\t\tclusterer = new markerClusterer.MarkerClusterer({\n\t\t\t\t\t\t\t\tmarkers,\n\t\t\t\t\t\t\t\tmap,\n\t\t\t\t\t\t\t\trenderer,\n\t\t\t\t\t\t\t\talgorithm,\n\t\t\t\t\t\t\t\tonClusterClick: () => {} // Override default zoom behavior\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Plot any connecting lines between resources...\n\t\t\t\t\t\tif (mapSourceType == \"resources\") {\n\t\t\t\t\t\t\tlineData.forEach(thisConnection => {\n\t\t\t\t\t\t\t\t// Look to see if connecting point exists on the map...\n\t\t\t\t\t\t\t\tif (cachedAddresses[thisConnection.deviceIDConnected]) {\n\t\t\t\t\t\t\t\t\t// Plot the connection on the map...\n\t\t\t\t\t\t\t\t\tplotConnection(thisConnection);\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Our refresh is now complete, so capture how long it took...\n\t\t\t\t\t\tlet refreshEndTime = performance.now();\n\t\t\t\t\t\tconsole.debug(`Total map refresh time: ${refreshEndTime - refreshStartTime} milliseconds`);\n\t\t\t\t\t\tpollCount = pollCount + 1;\n\t\t\t\t\t\tif (fullRefresh) {\n\t\t\t\t\t\t\tfullRefresh = false;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Carry forward our tilt/heading between refreshes...\n\t\t\t\t\t\tmap.setTilt(mapTilt);\n\t\t\t\t\t\tmap.setHeading(mapHeading);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t});\n\t\t};\n\t};\n\n\t// Function to fetch connection status & plot connecting lines on the map...\n\tasync function plotConnection(connection) {\n\t\t// Establish coordinates of the line start and end...\n\t\tconst tmpCoords = [\n\t\t\t{ lat: cachedAddresses[connection.deviceIDSource].lat, lng: cachedAddresses[connection.deviceIDSource].lng},\n\t\t\t{ lat: cachedAddresses[connection.deviceIDConnected].lat, lng: cachedAddresses[connection.deviceIDConnected].lng}\n\t\t];\n\n\t\t// Fetch the current alert status of the defined instance...\n\t\tlet resourcePath = `/device/devices/${connection.deviceIDSource}/devicedatasources/${connection.datasourceID}/instances/${connection.instanceID}`;\n\t\tlet httpVerb = \"GET\";\n\t\tconst instanceData = await LMClient({\n\t\t\tresourcePath: resourcePath,\n\t\t\tqueryParams: \"\",\n\t\t\thttpVerb: httpVerb,\n\t\t\tpostBody: null,\n\t\t\tapiVersion: '3',\n\t\t});\n\t\t// console.debug('Instance status succeeded with JSON response', instanceData);\n\n\t\t// Process the data we received...\n\t\tif (instanceData) {\n\t\t\tlet alertStatus = \"OK\";\n\t\t\tlet alertSeverity = \"clear\";\n\t\t\tlet sdtStatus = \"\";\n\t\t\tlet connectionColor = \"#85c25d\";\n\t\t\t// Parse the alarm status...\n\t\t\tlet alertStatusArray = instanceData.alertStatus.match(/([\\w]+)-([\\w]+)-([\\w]+)/);\n\t\t\tif (alertStatusArray) {\n\t\t\t\talertStatus = alertStatusArray[1];\n\t\t\t\talertSeverity = alertStatusArray[2];\n\t\t\t};\n\n\t\t\t// Determine color by severity...\n\t\t\tif (alertSeverity != \"\") {\n\t\t\t\tif (alertSeverity == \"warn\") {\n\t\t\t\t\tconnectionColor = \"#f5ca1d\";\n\t\t\t\t\talertStatus = \"Warning\";\n\t\t\t\t} else if (alertSeverity == \"error\") {\n\t\t\t\t\tconnectionColor = \"#ff8c00\";\n\t\t\t\t\talertStatus = \"Error\";\n\t\t\t\t} else if (alertSeverity == \"critical\") {\n\t\t\t\t\tconnectionColor = \"#e0351b\";\n\t\t\t\t\talertStatus = \"Critical\";\n\t\t\t\t};\n\t\t\t};\n\n\t\t\t// Parse the SDT status...\n\t\t\tlet sdtStatusArray = instanceData.sdtStatus.match(/([\\w]+)-([\\w]+)-([\\w]+)/);\n\t\t\tif (sdtStatusArray[1].toLowerCase() == \"sdt\" || sdtStatusArray[2].toLowerCase() == \"sdt\") {\n\t\t\t\tsdtStatus = \"sdt\";\n\t\t\t};\n\t\t\t// If in SDT...\n\t\t\tif (sdtStatus == \"sdt\") {\n\t\t\t\tconnectionColor = \"#00a1fe\";\n\t\t\t};\n\n\t\t\t// Plot the line on the map...\n\t\t\tconst thisPath = new google.maps.Polyline({\n\t\t\t\tpath: tmpCoords,\n\t\t\t\tgeodesic: useGeodesicLines,\n\t\t\t\tstrokeColor: connectionColor,\n\t\t\t\tstrokeOpacity: 1.0,\n\t\t\t\tstrokeWeight: connectingLineWeight,\n\t\t\t});\n\t\t\tthisPath.setMap(map);\n\n\n\t\t\t// Show connection info on hover...\n\t\t\tlet lineInfoWindow = new google.maps.InfoWindow({\n\t\t\t\tcontent: \"\"\n\t\t\t});\n\n\t\t\tgoogle.maps.event.addListener(thisPath, \"mouseover\", function(e) {\n\t\t\t\tlineInfoWindow.setPosition(e.latLng);\n\t\t\t\tlineInfoWindow.setContent(`<strong>${connection.connectionName}</strong><br/>Connection alert status: <a href=\"/santaba/uiv4/resources/treeNodes/t-i,id-${connection.instanceID}?source=details&tab=alert\" target=\"_blank\" title=\"Click to view alerts\" style=\"border: 0;\">${alertStatus}</a>`);\n\t\t\t\tlineInfoWindow.setHeaderDisabled(true);\n\t\t\t\tlineInfoWindow.open(map);\n\t\t\t});\n\t\t\tgoogle.maps.event.addListener(thisPath, \"mouseout\", function(e) {\n\t\t\t\tlineInfoWindow.close();\n\t\t\t});\n\t\t\tgoogle.maps.event.addListener(thisPath, \"click\", function(e) {\n\t\t\t\twindow.open(\"/santaba/uiv4/resources/treeNodes/t-i,id-\" + connection.instanceID + \"?source=details&tab=alert\");\n\t\t\t});\n\t\t};\n\t};\n\n\t// Function for showing/hiding a group's detail when clicked...\n\tfunction toggleHighlight(markerView, group) {\n\t\t// Close any open cluster details...\n\t\tif (clusterInfoWindow) {\n\t\t\tclusterInfoWindow.close();\n\t\t};\n\t\tif (markerView.content.classList.contains(\"highlight\")) {\n\t\t\tmarkerView.content.classList.remove(\"highlight\");\n\t\t\tmarkerView.content.parentElement.style.setProperty(\"z-index\", Number(markerView.content.dataset.severity));\n\t\t} else {\n\t\t\tlet foo = document.querySelectorAll('.highlight');\n\t\t\tif (foo.length > 0) {\n\t\t\t\tfoo[0].classList.remove(\"highlight\");\n\t\t\t\tfoo[0].parentElement.style.setProperty(\"z-index\", Number(foo[0].dataset.severity));\n\t\t\t};\n\n\t\t\tmarkerView.content.parentElement.style.setProperty(\"z-index\", 10);\n\t\t\tmarkerView.content.classList.add(\"highlight\");\n\t\t};\n\t};\n\n\t// Function processing status of Fetch calls...\n\tfunction status(response) {\n\t\tif (response.status >= 200 && response.status < 300) {\n\t\t\treturn Promise.resolve(response);\n\t\t} else {\n\t\t\treturn Promise.reject(new Error(response.statusText));\n\t\t};\n\t};\n\n\n\t// Pre-processor for JSON responses from Fetch calls...\n\tfunction json(response) {\n\t\treturn response.json();\n\t};\n\n\t// Our custom renderer for MarkerClusterer to create donut charts based on status of clustered items...\n\tconst renderer = {\n\t\trender ({ markers, count, position }) {\n\t\t\t// Since Google Maps markers don't have direct support for metadata, I'm using the marker's z-index to capture the group's severity: 1=warning, 2=error, 3=critical.\n\n\t\t\t// Create objects to hold per-severity metrics...\n\t\t\tconst severityCounts = new Map([[\"4\",0],[\"3\",0],[\"2\",0],[\"1\",0],[\"0\",0]]);\n\t\t\tconst severityPercents = new Map([[\"4\",0],[\"3\",0],[\"2\",0],[\"1\",0]]);\n\t\t\tconst severityOffsets = new Map([[\"4\",0],[\"3\",0],[\"2\",0],[\"1\",0]]);\n\n\t\t\t// Get counts of clustered pins by severity...\n\t\t\tmarkers.forEach((value, key) => {\n\t\t\t\tconst severity = value.zIndex > 0 ? value.zIndex.toString() : \"0\";\n\t\t\t\tseverityCounts.set(severity, (severityCounts.get(severity) || 0) + 1);\n\t\t\t});\n\n\t\t\t// (Credit for the technique I'm using to create SVG donut charts goes to this site: https://heyoka.medium.com/scratch-made-svg-donut-pie-charts-in-html5-2c587e935d72 )\n\n\t\t\t// Calculate sizes & offsets for our chart...\n\t\t\t// First segment should always have an offset of 25 to have it start at 12:00 on the circle...\n\t\t\tconst baseOffset = 25;\n\t\t\tlet offsetSum = 0;\n\t\t\t// Calculate percentages for each severity...\n\t\t\tseverityPercents.forEach((value, key) => {\n\t\t\t\tconst percent = (severityCounts.get(key)/count) * 100;\n\t\t\t\tseverityPercents.set(key, percent);\n\n\t\t\t\t// Calculate offsets needed per chart slice...\n\t\t\t\tif (percent > 0) {\n\t\t\t\t\tif (offsetSum == 0) {\n\t\t\t\t\t\t// This is our first item to chart, so it will establish the offset for subsequent chart slices...\n\t\t\t\t\t\tseverityOffsets.set(key, baseOffset);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Formula for calculating offset after first segment: 100-{sum of length of previous segments} + 25...\n\t\t\t\t\t\tconst offset = (100 - offsetSum) + baseOffset;\n\t\t\t\t\t\tseverityOffsets.set(key, offset);\n\t\t\t\t\t}\n\t\t\t\t\toffsetSum = offsetSum + percent;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Create an SVG donut chart representing severities of clustered pins...\n\t\t\tconst svg = window.btoa(`\n\t\t\t\t<svg fill=\"#0000ff\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 42 42\" class=\"donut\">\n\t\t\t\t\t<filter id=\"gaussian-blur\" x=\"-20%\" y=\"-20%\" width=\"140%\" height=\"140%\">\n\t\t\t\t\t\t<feDropShadow dx=\"0\" dy=\"${mapTilt/100+0.4}\" stdDeviation=\"1.3\" flood-opacity=\"0.7\" />\n\t\t\t\t\t</filter>\n\t\t\t\t\t<g filter=\"url(#gaussian-blur)\">\n\t\t\t\t\t\t<!-- Defines the center of the donut... -->\n\t\t\t\t\t\t<circle class=\"donut-hole\" cx=\"21\" cy=\"21\" r=\"15.91549430918954\" fill=\"#fff\"></circle>\n\t\t\t\t\t\t<!-- Our base circle, colored green by default... -->\n\t\t\t\t\t\t<circle class=\"donut-ring\" cx=\"21\" cy=\"21\" r=\"15.91549430918954\" fill=\"transparent\" stroke=\"#85c25d\" stroke-width=\"7\"></circle>\n\t\t\t\t\t\t<!-- First segment should always have an offset of 25 to have it start at 12am on the circle... -->\n\t\t\t\t\t\t<!-- SDTs... -->\n\t\t\t\t\t\t<circle class=\"donut-segment\" cx=\"21\" cy=\"21\" r=\"15.91549430918954\" fill=\"transparent\" stroke=\"#00a1fe\" stroke-width=\"7\" stroke-dasharray=\"${severityPercents.get(\"4\")} ${100-severityPercents.get(\"4\")}\" stroke-dashoffset=\"${severityOffsets.get(\"4\")}\"></circle>\n\t\t\t\t\t\t<!-- Criticals... -->\n\t\t\t\t\t\t<circle class=\"donut-segment\" cx=\"21\" cy=\"21\" r=\"15.91549430918954\" fill=\"transparent\" stroke=\"#e0351b\" stroke-width=\"7\" stroke-dasharray=\"${severityPercents.get(\"3\")} ${100-severityPercents.get(\"3\")}\" stroke-dashoffset=\"${severityOffsets.get(\"3\")}\"></circle>\n\t\t\t\t\t\t<!-- Errors... -->\n\t\t\t\t\t\t<circle class=\"donut-segment\" cx=\"21\" cy=\"21\" r=\"15.91549430918954\" fill=\"transparent\" stroke=\"#ff8c00\" stroke-width=\"7\" stroke-dasharray=\"${severityPercents.get(\"2\")} ${100-severityPercents.get(\"2\")}\" stroke-dashoffset=\"${severityOffsets.get(\"2\")}\"></circle>\n\t\t\t\t\t\t<!-- Warnings... -->\n\t\t\t\t\t\t<circle class=\"donut-segment\" cx=\"21\" cy=\"21\" r=\"15.91549430918954\" fill=\"transparent\" stroke=\"#f5ca1d\" stroke-width=\"7\" stroke-dasharray=\"${severityPercents.get(\"1\")} ${100-severityPercents.get(\"1\")}\" stroke-dashoffset=\"${severityOffsets.get(\"1\")}\"></circle>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>`);\n\n\t\t\t// Add the chart to the map...\n\t\t\tconst marker = new google.maps.Marker({\n\t\t\t\tposition,\n\t\t\t\ticon: {\n\t\t\t\t\turl: `data:image/svg+xml;base64,${svg}`,\n\t\t\t\t\tscaledSize: new google.maps.Size(45, 45),\n\t\t\t\t},\n\t\t\t\tlabel: {\n\t\t\t\t\ttext: String(count),\n\t\t\t\t\tcolor: \"rgba(0,0,0,0.9)\",\n\t\t\t\t\t// color: \"rgba(255,255,255,0.9)\",\n\t\t\t\t\tfontSize: \"12px\",\n\t\t\t\t},\n\t\t\t\t// adjust zIndex to be above other markers\n\t\t\t\tzIndex: 1000 + count,\n\t\t\t});\n\n\t\t\t// Create hover content\n\t\t\tconst getInfoContent = () => {\n\t\t\t\t// Get device details from markers\n\t\t\t\tconst deviceDetails = markers.map(marker => {\n\t\t\t\t\tconst content = marker.content;\n\t\t\t\t\tconst iconDiv = content.querySelector('.icon');\n\t\t\t\t\tconst nameLink = content.querySelector('.groupName a');\n\t\t\t\t\tlet status = 'clear';\n\t\t\t\t\tlet sdtStatus = '';\n\t\t\t\t\tlet statusRank = 0;\n\t\t\t\t\tif (iconDiv.classList.contains('critical')) {\n\t\t\t\t\t\tstatus = 'critical';\n\t\t\t\t\t\tstatusRank = 4;\n\t\t\t\t\t} else if (iconDiv.classList.contains('error')) {\n\t\t\t\t\t\tstatus = 'error';\n\t\t\t\t\t\tstatusRank = 3;\n\t\t\t\t\t} else if (iconDiv.classList.contains('warn')) {\n\t\t\t\t\t\tstatus = 'warning';\n\t\t\t\t\t\tstatusRank = 2;\n\t\t\t\t\t};\n\t\t\t\t\tif (iconDiv.classList.contains('sdt')) {\n\t\t\t\t\t\tsdtStatus = ' <span class=\"sdtNote\">(in SDT)</span>';\n\t\t\t\t\t\tstatus = 'sdt';\n\t\t\t\t\t\tstatusRank = 1;\n\t\t\t\t\t};\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: nameLink.textContent,\n\t\t\t\t\t\tlink: nameLink.href,\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t\tsdtStatus,\n\t\t\t\t\t\tstatusRank,\n\t\t\t\t\t\tposition: marker.position\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\t// Sort the resources by status, then alphabetically by severity...\n\t\t\t\tdeviceDetails.sort((a,b)=> (b.statusRank - a.statusRank || a.name.localeCompare(b.name)  ));\n\n\t\t\t\t// Calculate bounds for the cluster...\n\t\t\t\tconst clusterBounds = new google.maps.LatLngBounds();\n\t\t\t\tdeviceDetails.forEach(device => {\n\t\t\t\t\tclusterBounds.extend(device.position);\n\t\t\t\t});\n\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"mapInfoPopupWindow\">\n\t\t\t\t\t\t<div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;\">\n\t\t\t\t\t\t\t<div style=\"font-weight: 600; font-size: 14px;\">Cluster Summary</div>\n\t\t\t\t\t\t\t<button onclick=\"map.fitBounds(new google.maps.LatLngBounds(\n\t\t\t\t\t\t\t\tnew google.maps.LatLng(${clusterBounds.getSouthWest().lat()}, ${clusterBounds.getSouthWest().lng()}),\n\t\t\t\t\t\t\t\tnew google.maps.LatLng(${clusterBounds.getNorthEast().lat()}, ${clusterBounds.getNorthEast().lng()})\n\t\t\t\t\t\t\t))\" style=\"\n\t\t\t\t\t\t\t\tpadding: 6px 12px;\n\t\t\t\t\t\t\t\tbackground: #1a73e8;\n\t\t\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\t\t\tborder: none;\n\t\t\t\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t\t\t\t\tfont-size: 13px;\n\t\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\t\tgap: 6px;\n\t\t\t\t\t\t\t\ttransition: background 0.2s;\n\t\t\t\t\t\t\t\" onmouseover=\"this.style.background='#1557b0'\" onmouseout=\"this.style.background='#1a73e8'\">\n\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"14\" height=\"14\">\n\t\t\t\t\t\t\t\t\t<circle cx=\"11\" cy=\"11\" r=\"8\"/>\n\t\t\t\t\t\t\t\t\t<line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\n\t\t\t\t\t\t\t\t\t<line x1=\"11\" y1=\"8\" x2=\"11\" y2=\"14\"/>\n\t\t\t\t\t\t\t\t\t<line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\tZoom into Cluster\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style=\"display: grid; gap: 8px; margin-bottom: 16px;\">\n\t\t\t\t\t\t\t<div style=\"display: flex; align-items: center; gap: 8px;\">\n\t\t\t\t\t\t\t\t<div style=\"width: 12px; height: 12px; border-radius: 50%; background: #e0351b;\"></div>\n\t\t\t\t\t\t\t\t<span>Critical: ${severityCounts.get(\"3\") || 0}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style=\"display: flex; align-items: center; gap: 8px;\">\n\t\t\t\t\t\t\t\t<div style=\"width: 12px; height: 12px; border-radius: 50%; background: #ff8c00;\"></div>\n\t\t\t\t\t\t\t\t<span>Error: ${severityCounts.get(\"2\") || 0}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style=\"display: flex; align-items: center; gap: 8px;\">\n\t\t\t\t\t\t\t\t<div style=\"width: 12px; height: 12px; border-radius: 50%; background: #f5ca1d;\"></div>\n\t\t\t\t\t\t\t\t<span>Warning: ${severityCounts.get(\"1\") || 0}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style=\"display: flex; align-items: center; gap: 8px;\">\n\t\t\t\t\t\t\t\t<div style=\"width: 12px; height: 12px; border-radius: 50%; background: #85c25d;\"></div>\n\t\t\t\t\t\t\t\t<span>Clear: ${severityCounts.get(\"0\") || 0}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style=\"display: flex; align-items: center; gap: 8px;\">\n\t\t\t\t\t\t\t\t<div style=\"width: 12px; height: 12px; border-radius: 50%; background: #00a1fe;\"></div>\n\t\t\t\t\t\t\t\t<span>SDT: ${severityCounts.get(\"4\") || 0}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style=\"border-top: 1px solid #eee; padding-top: 12px;\">\n\t\t\t\t\t\t\t<div style=\"font-weight: 600; font-size: 14px; margin-bottom: 8px;\">${mapSourceType.replace(/^./, char => char.toUpperCase())} (${count})</div>\n\t\t\t\t\t\t\t<div style=\"display: grid; gap: 4px;\">\n\t\t\t\t\t\t\t\t${deviceDetails.map(device => `\n\t\t\t\t\t\t\t\t\t<div style=\"display: flex; align-items: center; padding: 4px 8px; background: #f8f9fa; border-radius: 4px; gap: 8px; max-height: 25px;\">\n\t\t\t\t\t\t\t\t\t\t<div style=\"width: 8px; height: 8px; border-radius: 50%; background: var(--${device.status}-color); flex-shrink: 0;\"></div>\n\t\t\t\t\t\t\t\t\t\t<a href=\"${device.link}\"\n\t\t\t\t\t\t\t\t\t\t   target=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t   style=\"color: #1a73e8; text-decoration: none; flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\"\n\t\t\t\t\t\t\t\t\t\t   onmouseover=\"this.style.textDecoration='underline'\"\n\t\t\t\t\t\t\t\t\t\t   onmouseout=\"this.style.textDecoration='none'\">\n\t\t\t\t\t\t\t\t\t\t\t${device.name}${device.sdtStatus}\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t<div style=\"display: flex; align-items: center;\">\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"${device.link}\"\n\t\t\t\t\t\t\t\t\t\t\t   target=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t\t   style=\"color: #1a73e8; display: flex; align-items: center; padding: 2px; border-radius: 4px; transition: background 0.2s;\"\n\t\t\t\t\t\t\t\t\t\t\t   onmouseover=\"this.style.background='#e8f0fe'\"\n\t\t\t\t\t\t\t\t\t\t\t   onmouseout=\"this.style.background='transparent'\">\n\t\t\t\t\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"14\" height=\"14\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6\"/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<polyline points=\"15 3 21 3 21 9\"/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<line x1=\"10\" y1=\"14\" x2=\"21\" y2=\"3\"/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`).join('')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t};\n\n\t\t\t// Add hover listener\n\t\t\tmarker.addListener('click', () => {\n\t\t\t\t// Close any other details already open...\n\t\t\t\tif (clusterInfoWindow) {\n\t\t\t\t\tclusterInfoWindow.close();\n\t\t\t\t};\n\t\t\t\tlet foo = document.querySelectorAll('.highlight');\n\t\t\t\tif (foo.length > 0) {\n\t\t\t\t\tfoo[0].classList.remove(\"highlight\");\n\t\t\t\t\tfoo[0].parentElement.style.setProperty(\"z-index\", Number(foo[0].dataset.severity));\n\t\t\t\t};\n\t\t\t\tclusterInfoWindow = new google.maps.InfoWindow();\n\t\t\t\tclusterInfoWindow.setContent(getInfoContent());\n\t\t\t\tclusterInfoWindow.open(map, marker);\n\t\t\t});\n\n\t\t\treturn marker;\n\t\t}\n\t};\n\n\t// Function to enable the weather overlays when the appropriate checkbox is selected...\n\tfunction enableWeather() {\n\t\tconst weatherCheckbox = document.getElementById(\"weather\");\n\t\tconst optionsElement = document.getElementById(\"weatherOptions\");\n\t\tconst showClearedElement = document.getElementById(\"showCleared\");\n\n\t\tif (weatherCheckbox.checked) {\n\t\t\t// Show the overlay options...\n\t\t\toptionsElement.style.display = \"inline-block\";\n\t\t\t// Add the weather overlays...\n\t\t\tinitWeather();\n\t\t} else {\n\t\t\t// Clear the timer that refreshes the weather...\n\t\t\tweatherRefresher = null;\n\t\t\t// Remove any previous overlay to ensure we don't keep stacking layers...\n\t\t\tmap.overlayMapTypes.clear();\n\t\t\tmap.data.forEach(function(feature) {\n\t\t\t\tmap.data.remove(feature);\n\t\t\t});\n\t\t\t// Hide the overlay options...\n\t\t\toptionsElement.style.display = \"none\";\n\t\t};\n\t};\n\n\t// Initialize the RainViewer API...\n\tfunction initWeather() {\n\t\tlet rvAPIRequest = new XMLHttpRequest();\n\t\trvAPIRequest.open(\"GET\", \"https://api.rainviewer.com/public/weather-maps.json\", true);\n\t\trvAPIRequest.onload = function(e) {\n\t\t\t// Store the API response for re-use purposes in memory...\n\t\t\trvAPIData = JSON.parse(rvAPIRequest.response);\n\t\t\taddWeatherLayer();\n\t\t};\n\t\trvAPIRequest.send();\n\n\t\t// Refresh the weather data at regular intervals (using the 'weatherRefreshMinutes' variable set near the top of this script)...\n\t\tweatherRefresher = setInterval(function() {\n\t\t\taddWeatherLayer();\n\t\t\tconsole.log(\"Weather maps refreshed.\")\n\t\t}, weatherRefreshMinutes*1000*60);\n\t};\n\n\t// Get the latest radar frame from RainViewer...\n\tfunction initRainViewerData() {\n\t\trvMapFrames = rvAPIData.radar.past;\n\t\tif (rvAPIData.radar.nowcast) {\n\t\t\trvMapFrames = rvMapFrames.concat(rvAPIData.radar.nowcast);\n\t\t\trvLastPastFramePosition = rvAPIData.radar.past.length - 1;\n\t\t};\n\t};\n\n\t// Function to add weather & other optional overlays to the map...\n\tasync function addWeatherLayer() {\n\t\tconst weatherCheckbox = document.getElementById(\"weather\");\n\t\tconst optionsElement = document.getElementById(\"weatherOptions\");\n\n\t\tif (weatherCheckbox.checked) {\n\t\t\tconst mapType = document.querySelector('input[name=\"weatherType\"]:checked').value;\n\t\t\tconst optionalMapType = document.querySelector('input[name=\"otherWeatherOverlays\"]:checked').value;\n\n\t\t\t// Add RainViewer layer if appropriate...\n\t\t\tif (mapType == \"radar\") {\n\t\t\t\t// Get the latest radar frame from RainViewer...\n\t\t\t\tinitRainViewerData();\n\n\t\t\t\t// The following three lines really only apply if we use RainViewer's satellite imagery, which I'm not currently but left it in here if needed...\n\t\t\t\tlet colorScheme = rvOptionKind == 'satellite' ? 0 : rvOptionColorScheme;\n\t\t\t\tlet smooth = rvOptionKind == 'satellite' ? 0 : rvOptionSmoothData;\n\t\t\t\tlet snow = rvOptionKind == 'satellite' ? 0 : rvOptionSnowColors;\n\n\t\t\t\t// Remove any previous overlay to ensure we don't keep stacking layers...\n\t\t\t\tmap.overlayMapTypes.clear();\n\n\t\t\t\t// Create the Google Maps layer...\n\t\t\t\tlet myMapType = new google.maps.ImageMapType({\n\t\t\t\t\tgetTileUrl: function(tile, zoom) {\n\t\t\t\t\t\treturn [rvAPIData.host + rvMapFrames[rvLastPastFramePosition].path, 256, zoom, tile.x, tile.y, colorScheme, smooth + '_' + snow + '.png'].join('/');\n\t\t\t\t\t},\n\t\t\t\t\ttileSize: new google.maps.Size(256, 256),\n\t\t\t\t\topacity: weatherOpacity,\n\t\t\t\t\tname : mapType,\n\t\t\t\t\tisPng: true\n\t\t\t\t});\n\n\t\t\t\t// Attach the weather layer to our maps widget...\n\t\t\t\tmap.overlayMapTypes.insertAt(0, myMapType);\n\n\t\t\t\t// Update the timestamp...\n\t\t\t\t// document.querySelector(\"#mapTimestampArea\").style.display = \"block\"; // Unhides the timestamp area.\n\t\t\t\t// document.getElementById(\"mapTimestamp\").innerHTML = (new Date(rvMapFrames[rvLastPastFramePosition].time * 1000)).toString();\n\n\t\t\t// Show NEXRAD layers if appropriate...\n\t\t\t} else if (mapType.match(/(nexrad|q2)/g)) {\n\t\t\t\t// Remove any previous overlay to ensure we don't keep stacking layers...\n\t\t\t\tmap.overlayMapTypes.clear();\n\n\t\t\t\t// Create the Google Maps layer...\n\t\t\t\tlet myMapType = new google.maps.ImageMapType({\n\t\t\t\t\tgetTileUrl: function(tile, zoom) {\n\t\t\t\t\t\treturn \"http://mesonet.agron.iastate.edu/cache/tile.py/1.0.0/\" + mapType + \"/\" + zoom + \"/\" + tile.x + \"/\" + tile.y +\".png?\"+ (new Date()).getTime();\n\t\t\t\t\t},\n\t\t\t\t\ttileSize: new google.maps.Size(256, 256),\n\t\t\t\t\topacity: weatherOpacity,\n\t\t\t\t\tname: mapType,\n\t\t\t\t\tisPng: true\n\t\t\t\t});\n\n\t\t\t\t// Attach the weather layer to our maps widget...\n\t\t\t\tmap.overlayMapTypes.insertAt(0, myMapType);\n\n\t\t\t// Show OpenWeather layers if appropriate...\n\t\t\t} else if (mapType != \"\" && openWeatherMapsAPIKey.length >= 32) {\n\t\t\t\t// Remove any previous overlay to ensure we don't keep stacking layers...\n\t\t\t\tmap.overlayMapTypes.clear();\n\n\t\t\t\t// Create the Google Maps layer...\n\t\t\t\tlet myMapType = new google.maps.ImageMapType({\n\t\t\t\t\tgetTileUrl: function(coord, zoom) {\n\t\t\t\t\t\treturn \"https://tile.openweathermap.org/map/\" + mapType + \"/\" + zoom + \"/\" + coord.x + \"/\" + coord.y + \".png?appid=\" + openWeatherMapsAPIKey;\n\t\t\t\t\t},\n\t\t\t\t\ttileSize: new google.maps.Size(256, 256),\n\t\t\t\t\tmaxZoom: 9,\n\t\t\t\t\tminZoom: 0,\n\t\t\t\t\topacity: weatherOpacity,\n\t\t\t\t\tname: mapType\n\t\t\t\t});\n\n\t\t\t\t// Attach the weather layer to our maps widget...\n\t\t\t\tmap.overlayMapTypes.insertAt(0, myMapType);\n\t\t\t};\n\n\t\t\t// Look to see if we should add wildfire into the map...\n\t\t\t// if (mapTitle.match(/fire/gi)) {\n\t\t\tif (optionalMapType == \"us-fires\") {\n\t\t\t\t// Clear any previous load of the wildfire data...\n\t\t\t\tmap.data.forEach(function(feature) {\n\t\t\t\t\tmap.data.remove(feature);\n\t\t\t\t});\n\t\t\t\tif (typeof parent.fireInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\tgoogle.maps.event.removeListener(parent.fireInfoWindowListenerHandle);\n\t\t\t\t};\n\t\t\t\tif (typeof parent.outageInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\tgoogle.maps.event.removeListener(parent.outageInfoWindowListenerHandle);\n\t\t\t\t};\n\t\t\t\tif (typeof parent.quakeInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\tgoogle.maps.event.removeListener(parent.quakeInfoWindowListenerHandle);\n\t\t\t\t};\n\n\t\t\t\t// Load the wildfire data from the ArcGIS site...\n\t\t\t\t// More info about this source of active US wildfire data can be found at: https://www.arcgis.com/home/item.html?id=d957997ccee7408287a963600a77f61f\n\t\t\t\t// From that site, you can click \"View\" above the \"URL\" field on the right-hand side. From there, you'll see info on the two available layers. We're using layer \"1\" for perimeter data (denoted in the URL below with the \"_1\"), and pulling geojson data (per the suffix).\n\t\t\t\t//map.data.loadGeoJson(\"https://opendata.arcgis.com/datasets/d957997ccee7408287a963600a77f61f_1.geojson\");\n\t\t\t\tmap.data.loadGeoJson(\"https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/USA_Wildfires_v1/FeatureServer/1/query?where=CurrentDateAge+<%3D+7&outFields=*&f=geojson\");\n\n\t\t\t\t// Color the wildfire areas as red...\n\t\t\t\tmap.data.setStyle({ fillColor: 'red', strokeWeight: 1.0, strokeColor: 'salmon' });\n\n\t\t\t\t// Show an info window on click of fire area...\n\t\t\t\tfireInfoWindow = new google.maps.InfoWindow({\n\t\t\t\t\tcontent: \"\"\n\t\t\t\t});\n\t\t\t\t// Show wildfire info on either \"click\" or \"mouseover\" (refer to the 'showWildfireInfoEvent' variable set at the top of this script)...\n\t\t\t\tparent.fireInfoWindowListenerHandle = map.data.addListener(showWildfireInfoEvent, function(event) {\n\t\t\t\t\t// Show an infowindow on click...\n\t\t\t\t\tlet comments = event.feature.getProperty(\"Comments\");\n\t\t\t\t\tif (comments == null) {\n\t\t\t\t\t\tcomments = \"(comments not available)\";\n\t\t\t\t\t};\n\t\t\t\t\tlet acres = event.feature.getProperty(\"GISAcres\");\n\t\t\t\t\tif (acres == null) {\n\t\t\t\t\t\tacres = \"(not available)\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tacres = Number(acres).toLocaleString('en-US', numFormatOptions)\n\t\t\t\t\t};\n\t\t\t\t\tlet fireCategory = event.feature.getProperty(\"FeatureCategory\");\n\t\t\t\t\tif (fireCategory == null) {\n\t\t\t\t\t\tfireCategory = \"(not available)\";\n\t\t\t\t\t};\n\t\t\t\t\tfireInfoWindow.setContent('<div style=\"line-height:1.35;overflow:hidden;white-space:nowrap;color:black;\"><span style=\"font-weight:700;\">Wildfire &quot;'+ event.feature.getProperty(\"IncidentName\") + '&quot;</span><br/>' + comments + '<br/><br/>Calculated Acres: ' + acres + '<br/>Category: ' + fireCategory + '<br/>Days Since Last GIS Update: ' + event.feature.getProperty(\"CurrentDateAge\") + '<br/>GIS Map Method: ' + event.feature.getProperty(\"MapMethod\") + '</div>');\n\t\t\t\t\tlet anchor = new google.maps.MVCObject();\n\t\t\t\t\tanchor.set(\"position\",event.latLng);\n\t\t\t\t\tfireInfoWindow.open(map, anchor);\n\t\t\t\t});\n\t\t\t\tif (showWildfireInfoEvent == \"mouseover\") {\n\t\t\t\t\tparent.fireInfoWindowListenerHandle = map.data.addListener('mouseout', function(event) {\n\t\t\t\t\t\tfireInfoWindow.close();\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t// Look to see if we should add power outages to the map...\n\t\t\t} else if (optionalMapType == \"us-poweroutages\") {\n\t\t\t\t// Variables for holding the number of counties...\n\t\t\t\tlet countyCount = 0;\n\t\t\t\tlet pageCount = 0;\n\t\t\t\tlet maxPerPage = 1000;\n\t\t\t\tlet countyFeatures = [];\n\n\t\t\t\tlet countyAPIRequest = new XMLHttpRequest();\n\t\t\t\tcountyAPIRequest.open(\"GET\", \"https://services.arcgis.com/pGfbNJoYypmNq86F/ArcGIS/rest/services/County_Power_Outages/FeatureServer/0/query?where=0%3D0&outFields=*&returnCountOnly=true&f=pjson\", false);\n\n\t\t\t\tcountyAPIRequest.onload = function(e) {\n\t\t\t\t\t// Store the API response for re-use purposes in memory...\n\t\t\t\t\tcountyAPIData = JSON.parse(countyAPIRequest.response);\n\t\t\t\t\tcountyCount = parseInt(countyAPIData.count);\n\t\t\t\t\tpageCount = Math.ceil(countyCount / maxPerPage);\n\t\t\t\t\tlet thisPage = 0;\n\t\t\t\t\tlet offset = 0;\n\n\t\t\t\t\t// Try to determine which style has been applied to the map so we can tune our border colors appropriately...\n\t\t\t\t\t// The map will only have a \"geometry\" style if the \"Standard\" map has been overridden...\n\t\t\t\t\t// try {\n\t\t\t\t\t// \tlet mapGeometryStyleElement = lm_map.styles.find((element) => element.elementType == \"geometry\");\n\t\t\t\t\t// \tlet mapGeometryStyle = mapGeometryStyleElement.stylers[0].color;\n\t\t\t\t\t// \tmapStyle = mapStyles.get(mapGeometryStyle);\n\t\t\t\t\t// } catch (e) {};\n\n\t\t\t\t\tfor (let currentPage = 0; currentPage <= pageCount; currentPage++) {\n\t\t\t\t\t\toffset = currentPage * maxPerPage;\n\t\t\t\t\t\t// console.log(\"Loading page \" + currentPage + \" of \" + pageCount);\n\n\t\t\t\t\t\tlet countyDataRequest = new XMLHttpRequest();\n\n\t\t\t\t\t\tcountyDataRequest.open(\"GET\", \"https://services.arcgis.com/pGfbNJoYypmNq86F/ArcGIS/rest/services/County_Power_Outages/FeatureServer/0/query?where=0%3D0&outFields=*&resultOffset=\" + offset + \"&resultRecordCount=\" + maxPerPage + \"&f=pgeojson\", true);\n\n\t\t\t\t\t\tcountyDataRequest.onload = function(e) {\n\t\t\t\t\t\t\tthisPage = thisPage + 1;\n\n\t\t\t\t\t\t\t// Store the API response for re-use purposes in memory...\n\t\t\t\t\t\t\tlet results = JSON.parse(countyDataRequest.response);\n\t\t\t\t\t\t\tlet tmpArray = countyFeatures.concat(results.features);\n\t\t\t\t\t\t\tcountyFeatures = tmpArray;\n\n\t\t\t\t\t\t\tif (countyFeatures.length == countyCount) {\n\t\t\t\t\t\t\t\t// console.log(\"Loading complete\");\n\n\t\t\t\t\t\t\t\t// Reset any lingering map popups, hightlights, etc...\n\t\t\t\t\t\t\t\tmap.data.forEach(function(feature) {\n\t\t\t\t\t\t\t\t\tmap.data.remove(feature);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (typeof parent.outageInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\t\t\t\t\tgoogle.maps.event.removeListener(parent.outageInfoWindowListenerHandle);\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tif (typeof parent.fireInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\t\t\t\t\tgoogle.maps.event.removeListener(parent.fireInfoWindowListenerHandle);\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tif (typeof parent.quakeInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\t\t\t\t\tgoogle.maps.event.removeListener(parent.quakeInfoWindowListenerHandle);\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tlet geoJSON = {\n\t\t\t\t\t\t\t\t\t\"type\" : \"FeatureCollection\",\n\t\t\t\t\t\t\t\t\t\"properties\" : {\n\t\t\t\t\t\t\t\t\t\t\"exceededTransferLimit\" : true\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\"features\" : countyFeatures\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tmap.data.addGeoJson(geoJSON);\n\n\t\t\t\t\t\t\t\t// Color the county borders...\n\t\t\t\t\t\t\t\t// Dynamically fill the county based on how many customers are currently without power...\n\t\t\t\t\t\t\t\tmap.data.setStyle(function(feature) {\n\t\t\t\t\t\t\t\t\tlet percentAffected = 0;\n\t\t\t\t\t\t\t\t\tlet strokeColor = \"salmon\";\n\t\t\t\t\t\t\t\t\tlet strokeOpacity = 0.1;\n\t\t\t\t\t\t\t\t\tif (feature.getProperty('CustomersTracked') > 0) {\n\t\t\t\t\t\t\t\t\t\t// Calculate what percentage of power customers are affected by outages...\n\t\t\t\t\t\t\t\t\t\tpercentAffected = feature.getProperty('CustomersOut') / feature.getProperty('CustomersTracked');\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// if (mapStyle == \"night\" || mapStyle == \"dark\") {\n\t\t\t\t\t\t\t\t\t// \tstrokeColor = \"cornflowerblue\";\n\t\t\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tfillColor: 'red',\n\t\t\t\t\t\t\t\t\t\tfillOpacity: percentAffected,\n\t\t\t\t\t\t\t\t\t\tstrokeWeight: 1.0,\n\t\t\t\t\t\t\t\t\t\tstrokeColor: strokeColor,\n\t\t\t\t\t\t\t\t\t\tstrokeOpacity: strokeOpacity\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Show county names on click...\n\t\t\t\t\t\t\t\tlet outageInfoWindow = new google.maps.InfoWindow({\n\t\t\t\t\t\t\t\t\tcontent: \"\"\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tparent.outageInfoWindowListenerHandle = map.data.addListener('click', function(event) {\n\t\t\t\t\t\t\t\t\t// Show an infowindow on click...\n\t\t\t\t\t\t\t\t\tlet timestamp = new Date(event.feature.getProperty(\"LastUpdatedDateTime\"));\n\t\t\t\t\t\t\t\t\tlet percentAffected = 0;\n\t\t\t\t\t\t\t\t\tif (event.feature.getProperty('CustomersTracked') > 0) {\n\t\t\t\t\t\t\t\t\t\t// Calculate what percentage of power customers are affected by outages...\n\t\t\t\t\t\t\t\t\t\tpercentAffected = event.feature.getProperty('CustomersOut') / event.feature.getProperty('CustomersTracked') * 100;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\toutageInfoWindow.setContent('<div style=\"line-height:1.5;overflow:hidden;white-space:nowrap;color:#333;\"><h3>'+ event.feature.getProperty(\"CountyName\") + ' County</h3><p style=\"padding:5px 0;\">Power Customers Affected: <strong>' + Math.round(percentAffected) + '%</strong> (' + event.feature.getProperty(\"CustomersOut\").toLocaleString() + ' of ' + event.feature.getProperty(\"CustomersTracked\").toLocaleString() + ')</p><p>Last Updated: ' + timestamp.toLocaleString() + '</p></div>');\n\t\t\t\t\t\t\t\t\tlet anchor = new google.maps.MVCObject();\n\t\t\t\t\t\t\t\t\tanchor.set(\"position\",event.latLng);\n\t\t\t\t\t\t\t\t\toutageInfoWindow.open(map, anchor);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Highlight counties on mouseover...\n\t\t\t\t\t\t\t\tmap.data.addListener('mouseover', function(event) {\n\t\t\t\t\t\t\t\t\tmap.data.revertStyle();\n\t\t\t\t\t\t\t\t\tmap.data.overrideStyle(event.feature, {strokeWeight: 3, strokeOpacity: 0.5});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t// map.data.addListener('mouseout', function(event) {\n\t\t\t\t\t\t\t\t\t// map.data.revertStyle();\n\t\t\t\t\t\t\t\t// });\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tcountyDataRequest.send();\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tcountyAPIRequest.send();\n\n\t\t\t} else if (optionalMapType == \"earthquakes\") {\n\t\t\t\t// Clear any previous load of the quake data...\n\t\t\t\tmap.data.forEach(function(feature) {\n\t\t\t\t\tmap.data.remove(feature);\n\t\t\t\t});\n\t\t\t\tif (typeof parent.fireInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\tgoogle.maps.event.removeListener(parent.fireInfoWindowListenerHandle);\n\t\t\t\t};\n\t\t\t\tif (typeof parent.outageInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\tgoogle.maps.event.removeListener(parent.outageInfoWindowListenerHandle);\n\t\t\t\t};\n\t\t\t\tif (typeof parent.quakeInfoWindowListenerHandle == \"object\") {\n\t\t\t\t\tgoogle.maps.event.removeListener(parent.quakeInfoWindowListenerHandle);\n\t\t\t\t};\n\n\t\t\t\t// Load the earthquake data for the past day from the USGS site...\n\t\t\t\t// More info about this source of earthquake data can be found at: https://publicapis.io/usgs-earthquake-hazards-program-api\n\t\t\t\tif (quakeMode == \"time\") {\n\t\t\t\t\tawait map.data.loadGeoJson(\"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_week.geojson\");\n\t\t\t\t} else {\n\t\t\t\t\tawait map.data.loadGeoJson(\"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_day.geojson\");\n\t\t\t\t};\n\t\t\t\t// Other options for different timeframes and magnitudes...\n\t\t\t\t// map.data.loadGeoJson(\"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson\");\n\t\t\t\t// await map.data.loadGeoJson(\"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_day.geojson\");\n\t\t\t\t// await map.data.loadGeoJson(\"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_day.geojson\");\n\t\t\t\t// await map.data.loadGeoJson(\"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson\");\n\t\t\t\t// await map.data.loadGeoJson(\"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_month.geojson\");\n\t\t\t\tconsole.debug(\"Earthquake data loaded\");\n\n\t\t\t\t// Style the earthquake markers...\n\t\t\t\t// map.data.setStyle({ fillColor: 'red', strokeWeight: 1.0, strokeColor: 'salmon', icon: {url: quakeIcon, scaledSize: { width: 40, height: 40}, anchor: { x: 20, y: 20 } } });\n\t\t\t\tmap.data.setStyle(function(feature) {\n\t\t\t\t\tlet alertColor = \"crimson\";\n\t\t\t\t\tlet iconOpacity = 1.0;\n\t\t\t\t\t// Set our minimum opacity...\n\t\t\t\t\ticonOpacity = 0.5;\n\n\t\t\t\t\t// Leaving logic here commented out for color-coding the icons based on PAGER alert color...\n\t\t\t\t\t// alertColor = \"gray\";\n\t\t\t\t\t// if (feature.getProperty('alert') != null) {\n\t\t\t\t\t// \talertColor = feature.getProperty('alert');\n\t\t\t\t\t// \tif (alertColor == \"green\") {\n\t\t\t\t\t// \t\talertColor = \"limegreen\";\n\t\t\t\t\t// \t} else if (alertColor == \"yellow\") {\n\t\t\t\t\t// \t\talertColor = \"rgb(209 209 43)\";\n\t\t\t\t\t// \t};\n\t\t\t\t\t// };\n\n\t\t\t\t\tif (quakeMode == \"time\") {\n\t\t\t\t\t\t// Leaving logic here commented out for changing the icon's opacity based on recency...\n\t\t\t\t\t\t// Calculate the icon's opacity based on how recent the quake occurred (newer = more opaque)...\n\t\t\t\t\t\tlet now = new Date();\n\t\t\t\t\t\tlet quakeTime = new Date(feature.getProperty('time'));\n\t\t\t\t\t\t// Calculate seconds since the quake occurred...\n\t\t\t\t\t\tlet timeDiff = now - quakeTime;\n\t\t\t\t\t\t// Calculate a scale based on seconds in a day...\n\t\t\t\t\t\tlet timeScale = (86400 * 12) / timeDiff * 100;\n\t\t\t\t\t\t// Change icon opacity based on age of the event...\n\t\t\t\t\t\tif (timeScale > iconOpacity) {\n\t\t\t\t\t\t\ticonOpacity = timeScale;\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet mag = feature.getProperty(\"mag\");\n\t\t\t\t\t\t// We'll use magnitude 7 as a the top of our scale (i.e. mag 7 will be full opacity, with lesser being more faded)...\n\t\t\t\t\t\tlet magScale = 1 - ((7 - mag) / 10);\n\t\t\t\t\t\tif (magScale > 0.5) {\n\t\t\t\t\t\t\ticonOpacity = magScale;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t// console.debug(`Opacity of ${feature.getProperty(\"place\")} (mag ${feature.getProperty(\"mag\")}): ${iconOpacity}`);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\ticon: {url: `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' data-tooltip='Earthquake' viewBox='0 0 302.836 302.836'%3E%3Cpath d='M271 256a15 15 0 0 1-15 15 15 15 0 0 1-15-15 15 15 0 0 1 15-15 15 15 0 0 1 15 15z' style='opacity:${iconOpacity};fill:${alertColor};fill-opacity:${iconOpacity};stroke:none;stroke-width:8;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1' transform='translate(-104.582 -104.582)'/%3E%3Cpath d='M256 139.29c-64.44 0-116.71 52.27-116.71 116.71S191.56 372.71 256 372.71 372.71 320.44 372.71 256 320.44 139.29 256 139.29zm0 3c62.818 0 113.71 50.892 113.71 113.71 0 62.818-50.892 113.71-113.71 113.71-62.818 0-113.71-50.892-113.71-113.71 0-62.818 50.892-113.71 113.71-113.71z' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;direction:ltr;block-progression:tb;writing-mode:lr-tb;baseline-shift:baseline;text-anchor:start;white-space:normal;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:${iconOpacity};isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:${iconOpacity};fill:${alertColor};fill-opacity:.55474453;fill-rule:nonzero;stroke:none;stroke-width:3;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:${iconOpacity};color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate' transform='translate(-104.582 -104.582)'/%3E%3Cpath d='M256 214.266c-22.996 0-41.734 18.738-41.734 41.734 0 22.996 18.738 41.734 41.734 41.734 22.996 0 41.734-18.738 41.734-41.734 0-22.996-18.738-41.734-41.734-41.734zm0 9c18.132 0 32.734 14.602 32.734 32.734S274.132 288.734 256 288.734 223.266 274.132 223.266 256s14.602-32.734 32.734-32.734z' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;direction:ltr;block-progression:tb;writing-mode:lr-tb;baseline-shift:baseline;text-anchor:start;white-space:normal;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:${iconOpacity};isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:${iconOpacity};fill:${alertColor};fill-opacity:${iconOpacity};fill-rule:nonzero;stroke:${alertColor};stroke-width:3;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:${iconOpacity};color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate' transform='translate(-104.582 -104.582)'/%3E%3Cpath d='M256 189.678c-36.594 0-66.322 29.728-66.322 66.322s29.728 66.322 66.322 66.322 66.322-29.728 66.322-66.322-29.728-66.322-66.322-66.322zm0 6c33.35 0 60.322 26.971 60.322 60.322 0 33.35-26.971 60.322-60.322 60.322-33.35 0-60.322-26.971-60.322-60.322 0-33.35 26.971-60.322 60.322-60.322z' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;direction:ltr;block-progression:tb;writing-mode:lr-tb;baseline-shift:baseline;text-anchor:start;white-space:normal;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:${iconOpacity};isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:${iconOpacity};fill:${alertColor};fill-opacity:${iconOpacity};fill-rule:nonzero;stroke:none;stroke-width:6;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:${iconOpacity};color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate' transform='translate(-104.582 -104.582)'/%3E%3Cpath d='M256 166.164c-49.591 0-89.836 40.245-89.836 89.836S206.41 345.836 256 345.836 345.836 305.59 345.836 256 305.59 166.164 256 166.164zm0 4c47.43 0 85.836 38.406 85.836 85.836S303.43 341.836 256 341.836 170.164 303.43 170.164 256 208.57 170.164 256 170.164z' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;direction:ltr;block-progression:tb;writing-mode:lr-tb;baseline-shift:baseline;text-anchor:start;white-space:normal;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:${iconOpacity};isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:${iconOpacity};fill:${alertColor};fill-opacity:${iconOpacity};fill-rule:nonzero;stroke:none;stroke-width:4;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:${iconOpacity};color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate' transform='translate(-104.582 -104.582)'/%3E%3Cpath d='M256 109.582c-80.853 0-146.418 65.565-146.418 146.418 0 80.853 65.565 146.418 146.418 146.418 80.853 0 146.418-65.565 146.418-146.418 0-80.853-65.565-146.418-146.418-146.418zm0 2c79.772 0 144.418 64.646 144.418 144.418S335.772 400.418 256 400.418 111.582 335.772 111.582 256 176.228 111.582 256 111.582z' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;direction:ltr;block-progression:tb;writing-mode:lr-tb;baseline-shift:baseline;text-anchor:start;white-space:normal;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:${iconOpacity};isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:${iconOpacity};fill:${alertColor};fill-opacity:.35766422;fill-rule:nonzero;stroke:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:${iconOpacity};color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate' transform='translate(-104.582 -104.582)'/%3E%3C/svg%3E`, scaledSize: { width: 40, height: 40}, anchor: { x: 20, y: 20 } },\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Show an info window on click of fire area...\n\t\t\t\tquakeInfoWindow = new google.maps.InfoWindow({\n\t\t\t\t\tcontent: \"\"\n\t\t\t\t});\n\t\t\t\t// Show wildfire info on either \"click\" or \"mouseover\" (refer to the 'showWildfireInfoEvent' variable set at the top of this script)...\n\t\t\t\tparent.quakeInfoWindowListenerHandle = map.data.addListener('click', function(event) {\n\t\t\t\t\tconst content = document.createElement(\"div\");\n\t\t\t\t\t// Show an infowindow on click...\n\t\t\t\t\tlet quakeTime = new Date(event.feature.getProperty(\"time\"));\n\t\t\t\t\tlet updated = new Date(event.feature.getProperty(\"updated\"));\n\t\t\t\t\tlet title = \"Earthquake Magnitude \" + event.feature.getProperty(\"mag\");\n\t\t\t\t\tlet alertLabel = \"(not available)\";\n\t\t\t\t\t// let alertLabelColor = \"inherit\";\n\t\t\t\t\tlet alertLabelColor = \"white\";\n\t\t\t\t\tif (event.feature.getProperty(\"alert\") != null) {\n\t\t\t\t\t\talertLabelColor = event.feature.getProperty(\"alert\");\n\t\t\t\t\t\talertLabel = event.feature.getProperty(\"alert\").toUpperCase();\n\t\t\t\t\t\tif (alertLabelColor == \"green\") {\n\t\t\t\t\t\t\talertLabelColor = \"lawngreen\";\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t\tlet quakeAgeInDays = (new Date() - quakeTime) / (86400 * 1000);\n\n\t\t\t\t\tquakeInfoWindow.setContent(`\n\t\t\t\t\t\t<div style=\"line-height:1.35;overflow:hidden;white-space:nowrap;color:black;\">\n\t\t\t\t\t\t\t<div style=\"font-weight:700;font-size: 1.1em;\">\n\t\t\t\t\t\t\t\tEarthquake Magnitude ${event.feature.getProperty(\"mag\")}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${event.feature.getProperty(\"place\")}<br/></br/>\n\t\t\t\t\t\t\tCurrent <a href=\"https://earthquake.usgs.gov/data/pager/onepager.php\" target=\"_blank\">USGS PAGER</a> Alert Level: <strong style=\"color: ${alertLabelColor}; background-color: black; padding: 5px; border-radius: 7px; font-size: 0.9em;\">${alertLabel}</strong><br/><br/>\n\t\t\t\t\t\t\t<div style=\"font-size: 0.95em;\">\n\t\t\t\t\t\t\t\t<span style=\"font-weight: 500;\">Detected:</span> ${quakeTime.toLocaleString()} <span style=\"font-size: 0.95em;\">(${quakeAgeInDays.toFixed(1)} days ago)</span><br/>\n\t\t\t\t\t\t\t\t<span style=\"font-weight: 500;\">Updated:</span> ${updated.toLocaleString()}\n\t\t\t\t\t\t\t</div><br/><br/>\n\t\t\t\t\t\t\t<a href=\"${event.feature.getProperty(\"url\")}\" target=\"_blank\">More details</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`);\n\n\t\t\t\t\tquakeInfoWindow.setPosition(event.latLng);\n\t\t\t\t\tquakeInfoWindow.open(map);\n\t\t\t\t});\n\t\t\t\tif (showWildfireInfoEvent == \"mouseover\") {\n\t\t\t\t\tparent.quakeInfoWindowListenerHandle = map.data.addListener('mouseout', function(event) {\n\t\t\t\t\t\tquakeInfoWindow.close();\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t};\n\n\t// Function called when the \"Reset Zoom\" button is pressed...\n\tfunction resetZoom() {\n\t\t// If there's only 1 marker, avoid zooming in super close (i.e. use the default zoom level 3)...\n\t\tif (markers.length > 0) {\n\t\t\tmap.fitBounds(bounds);\n\t\t};\n\t\t// Reset the tilt & heading back to their original values...\n\t\tmapTilt = defaultMapTilt;\n\t\tmapHeading = defaultMapHeading;\n\t\tmap.setTilt(mapTilt);\n\t\tmap.setHeading(mapHeading);\n\t};\n\n\t// Function to capture presses of the Enter key in the 'Group Filter' field (without this the widget refreshes in an error)...\n\tfunction groupkeyHandler(e) {\n\t\t// Get the keycode of which key was pressed...\n\t\tlet key = e.keyCode || e.which;\n\t\t// If the key was the Enter/Return key...\n\t\tif (key == 13) {\n\t\t\t// Stop the form from submitting...\n\t\t\te.preventDefault();\n\t\t\t// Refresh the group data...\n\t\t\trefreshGroupData();\n\t\t};\n\t};\n\n\tfunction toggleMiscOptions() {\n\t\tlet areaElement = document.getElementById(\"optionsToggleArea\");\n\t\tlet gearIcon = document.getElementById(\"gearIcon\");\n\t\tlet gearIconChevron = document.getElementById(\"gearIconChevron\");\n\n\t\tif (areaElement.style.display == \"flex\") {\n\t\t\tareaElement.style.display = \"none\";\n\t\t\tgearIcon.style.fill = \"#aaa\";\n\t\t\tgearIconChevron.style.display = \"none\";\n\t\t} else {\n\t\t\tareaElement.style.display = \"flex\";\n\t\t\tgearIcon.style.fill = \"blue\";\n\t\t\t// gearIcon.style.fill = \"#555\";\n\t\t\tgearIconChevron.style.display = \"block\";\n\t\t};\n\t};\n\n\tfunction waitForElm(selector) {\n\t\treturn new Promise(resolve => {\n\t\t\tif (document.querySelector(selector)) {\n\t\t\t\treturn resolve(document.querySelector(selector));\n\t\t\t};\n\n\t\t\tconst observer = new MutationObserver(mutations => {\n\t\t\t\tif (document.querySelector(selector)) {\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\tresolve(document.querySelector(selector));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If you get \"parameter 1 is not of type 'Node'\" error, see https://stackoverflow.com/a/77855838/492336\n\t\t\tobserver.observe(document.body, {\n\t\t\t\tchildList: true,\n\t\t\t\tsubtree: true\n\t\t\t});\n\t\t});\n\t};\n</script><!-- If used as an embedded widget outside a normal LM dashboard then trying to load Google's marker clustering script or Font Awesome's CSS externally breaks due to XSS, so I'm embedding the entire script here. Normally we would load this from https://unpkg.com/@googlemaps/markerclusterer@2.5.3/dist/index.min.js and https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/svg-with-js.min.css respectively.--><script>\n\tconst markerClusterer=function(t){\"use strict\";function e(t,e){var s={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(s[r]=t[r]);if(null!=t&&\"function\"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(s[r[o]]=t[r[o]])}return s}class s{static isAdvancedMarkerAvailable(t){return google.maps.marker&&!0===t.getMapCapabilities().isAdvancedMarkersAvailable}static isAdvancedMarker(t){return google.maps.marker&&t instanceof google.maps.marker.AdvancedMarkerElement}static setMap(t,e){this.isAdvancedMarker(t)?t.map=e:t.setMap(e)}static getPosition(t){if(this.isAdvancedMarker(t)){if(t.position){if(t.position instanceof google.maps.LatLng)return t.position;if(t.position.lat&&t.position.lng)return new google.maps.LatLng(t.position.lat,t.position.lng)}return new google.maps.LatLng(null)}return t.getPosition()}static getVisible(t){return!!this.isAdvancedMarker(t)||t.getVisible()}}class r{constructor(t){let{markers:e,position:s}=t;this.markers=e,s&&(s instanceof google.maps.LatLng?this._position=s:this._position=new google.maps.LatLng(s))}get bounds(){if(0===this.markers.length&&!this._position)return;const t=new google.maps.LatLngBounds(this._position,this._position);for(const e of this.markers)t.extend(s.getPosition(e));return t}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter((t=>s.getVisible(t))).length}push(t){this.markers.push(t)}delete(){this.marker&&(s.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}}const o=(t,e,r,o)=>{const n=i(t.getBounds(),e,o);return r.filter((t=>n.contains(s.getPosition(t))))},i=(t,e,s)=>{const{northEast:r,southWest:o}=h(t,e),i=l({northEast:r,southWest:o},s);return c(i,e)},n=(t,e,s)=>{const r=i(t,e,s),o=r.getNorthEast(),n=r.getSouthWest();return[n.lng(),n.lat(),o.lng(),o.lat()]},a=(t,e)=>{const s=(e.lat-t.lat)*Math.PI/180,r=(e.lng-t.lng)*Math.PI/180,o=Math.sin(s/2),i=Math.sin(r/2),n=o*o+Math.cos(t.lat*Math.PI/180)*Math.cos(e.lat*Math.PI/180)*i*i;return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))},h=(t,e)=>({northEast:e.fromLatLngToDivPixel(t.getNorthEast()),southWest:e.fromLatLngToDivPixel(t.getSouthWest())}),l=(t,e)=>{let{northEast:s,southWest:r}=t;return s.x+=e,s.y-=e,r.x-=e,r.y+=e,{northEast:s,southWest:r}},c=(t,e)=>{let{northEast:s,southWest:r}=t;const o=e.fromDivPixelToLatLng(r),i=e.fromDivPixelToLatLng(s);return new google.maps.LatLngBounds(o,i)};class u{constructor(t){let{maxZoom:e=16}=t;this.maxZoom=e}noop(t){let{markers:e}=t;return m(e)}}class p extends u{constructor(t){var{viewportPadding:s=60}=t;super(e(t,[\"viewportPadding\"])),this.viewportPadding=60,this.viewportPadding=s}calculate(t){let{markers:e,map:s,mapCanvasProjection:r}=t;return s.getZoom()>=this.maxZoom?{clusters:this.noop({markers:e}),changed:!1}:{clusters:this.cluster({markers:o(s,r,e,this.viewportPadding),map:s,mapCanvasProjection:r})}}}const m=t=>t.map((t=>new r({position:s.getPosition(t),markers:[t]})));function d(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,\"default\")?t.default:t}var g=function t(e,s){if(e===s)return!0;if(e&&s&&\"object\"==typeof e&&\"object\"==typeof s){if(e.constructor!==s.constructor)return!1;var r,o,i;if(Array.isArray(e)){if((r=e.length)!=s.length)return!1;for(o=r;0!=o--;)if(!t(e[o],s[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if((r=(i=Object.keys(e)).length)!==Object.keys(s).length)return!1;for(o=r;0!=o--;)if(!Object.prototype.hasOwnProperty.call(s,i[o]))return!1;for(o=r;0!=o--;){var n=i[o];if(!t(e[n],s[n]))return!1}return!0}return e!=e&&s!=s},f=d(g);const k=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class w{static from(t){if(!(t instanceof ArrayBuffer))throw new Error(\"Data must be an instance of ArrayBuffer.\");const[e,s]=new Uint8Array(t,0,2);if(219!==e)throw new Error(\"Data does not appear to be in a KDBush format.\");const r=s>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const o=k[15&s];if(!o)throw new Error(\"Unrecognized array type.\");const[i]=new Uint16Array(t,2,1),[n]=new Uint32Array(t,4,1);return new w(n,i,o,t)}constructor(t,e=64,s=Float64Array,r){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const o=k.indexOf(this.ArrayType),i=2*t*this.ArrayType.BYTES_PER_ELEMENT,n=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-n%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${s}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+n+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+i+n+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+n+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+o]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=e,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return y(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,s,r){if(!this._finished)throw new Error(\"Data not yet indexed - call index.finish().\");const{ids:o,coords:i,nodeSize:n}=this,a=[0,o.length-1,0],h=[];for(;a.length;){const l=a.pop()||0,c=a.pop()||0,u=a.pop()||0;if(c-u<=n){for(let n=u;n<=c;n++){const a=i[2*n],l=i[2*n+1];a>=t&&a<=s&&l>=e&&l<=r&&h.push(o[n])}continue}const p=u+c>>1,m=i[2*p],d=i[2*p+1];m>=t&&m<=s&&d>=e&&d<=r&&h.push(o[p]),(0===l?t<=m:e<=d)&&(a.push(u),a.push(p-1),a.push(1-l)),(0===l?s>=m:r>=d)&&(a.push(p+1),a.push(c),a.push(1-l))}return h}within(t,e,s){if(!this._finished)throw new Error(\"Data not yet indexed - call index.finish().\");const{ids:r,coords:o,nodeSize:i}=this,n=[0,r.length-1,0],a=[],h=s*s;for(;n.length;){const l=n.pop()||0,c=n.pop()||0,u=n.pop()||0;if(c-u<=i){for(let s=u;s<=c;s++)C(o[2*s],o[2*s+1],t,e)<=h&&a.push(r[s]);continue}const p=u+c>>1,m=o[2*p],d=o[2*p+1];C(m,d,t,e)<=h&&a.push(r[p]),(0===l?t-s<=m:e-s<=d)&&(n.push(u),n.push(p-1),n.push(1-l)),(0===l?t+s>=m:e+s>=d)&&(n.push(p+1),n.push(c),n.push(1-l))}return a}}function y(t,e,s,r,o,i){if(o-r<=s)return;const n=r+o>>1;M(t,e,n,r,o,i),y(t,e,s,r,n-1,1-i),y(t,e,s,n+1,o,1-i)}function M(t,e,s,r,o,i){for(;o>r;){if(o-r>600){const n=o-r+1,a=s-r+1,h=Math.log(n),l=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*l*(n-l)/n)*(a-n/2<0?-1:1);M(t,e,s,Math.max(r,Math.floor(s-a*l/n+c)),Math.min(o,Math.floor(s+(n-a)*l/n+c)),i)}const n=e[2*s+i];let a=r,h=o;for(v(t,e,r,s),e[2*o+i]>n&&v(t,e,r,o);a<h;){for(v(t,e,a,h),a++,h--;e[2*a+i]<n;)a++;for(;e[2*h+i]>n;)h--}e[2*r+i]===n?v(t,e,r,h):(h++,v(t,e,h,o)),h<=s&&(r=h+1),s<=h&&(o=h-1)}}function v(t,e,s,r){x(t,s,r),x(e,2*s,2*r),x(e,2*s+1,2*r+1)}function x(t,e,s){const r=t[e];t[e]=t[s],t[s]=r}function C(t,e,s,r){const o=t-s,i=e-r;return o*o+i*i}const P={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},_=Math.fround||(E=new Float32Array(1),t=>(E[0]=+t,E[0]));var E;const A=3,b=5,L=6;class O{constructor(t){this.options=Object.assign(Object.create(P),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:s,maxZoom:r}=this.options;e&&console.time(\"total time\");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;const i=[];for(let e=0;e<t.length;e++){const s=t[e];if(!s.geometry)continue;const[r,o]=s.geometry.coordinates,n=_(T(r)),a=_(j(o));i.push(n,a,1/0,e,-1,1),this.options.reduce&&i.push(0)}let n=this.trees[r+1]=this._createTree(i);e&&console.timeEnd(o);for(let t=r;t>=s;t--){const s=+Date.now();n=this.trees[t]=this._createTree(this._cluster(n,t)),e&&console.log(\"z%d: %d clusters in %dms\",t,n.numItems,+Date.now()-s)}return e&&console.timeEnd(\"total time\"),this}getClusters(t,e){let s=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let o=180===t[2]?180:((t[2]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)s=-180,o=180;else if(s>o){const t=this.getClusters([s,r,180,i],e),n=this.getClusters([-180,r,o,i],e);return t.concat(n)}const n=this.trees[this._limitZoom(e)],a=n.range(T(s),j(i),T(o),j(r)),h=n.data,l=[];for(const t of a){const e=this.stride*t;l.push(h[e+b]>1?Z(h,e,this.clusterProps):this.points[h[e+A]])}return l}getChildren(t){const e=this._getOriginId(t),s=this._getOriginZoom(t),r=\"No cluster with the specified id.\",o=this.trees[s];if(!o)throw new Error(r);const i=o.data;if(e*this.stride>=i.length)throw new Error(r);const n=this.options.radius/(this.options.extent*Math.pow(2,s-1)),a=i[e*this.stride],h=i[e*this.stride+1],l=o.within(a,h,n),c=[];for(const e of l){const s=e*this.stride;i[s+4]===t&&c.push(i[s+b]>1?Z(i,s,this.clusterProps):this.points[i[s+A]])}if(0===c.length)throw new Error(r);return c}getLeaves(t,e,s){e=e||10,s=s||0;const r=[];return this._appendLeaves(r,t,e,s,0),r}getTile(t,e,s){const r=this.trees[this._limitZoom(t)],o=Math.pow(2,t),{extent:i,radius:n}=this.options,a=n/i,h=(s-a)/o,l=(s+1+a)/o,c={features:[]};return this._addTileFeatures(r.range((e-a)/o,h,(e+1+a)/o,l),r.data,e,s,o,c),0===e&&this._addTileFeatures(r.range(1-a/o,h,1,l),r.data,o,s,o,c),e===o-1&&this._addTileFeatures(r.range(0,h,a/o,l),r.data,-1,s,o,c),c.features.length?c:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const s=this.getChildren(t);if(e++,1!==s.length)break;t=s[0].properties.cluster_id}return e}_appendLeaves(t,e,s,r,o){const i=this.getChildren(e);for(const e of i){const i=e.properties;if(i&&i.cluster?o+i.point_count<=r?o+=i.point_count:o=this._appendLeaves(t,i.cluster_id,s,r,o):o<r?o++:t.push(e),t.length===s)break}return o}_createTree(t){const e=new w(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let s=0;s<t.length;s+=this.stride)e.add(t[s],t[s+1]);return e.finish(),e.data=t,e}_addTileFeatures(t,e,s,r,o,i){for(const n of t){const t=n*this.stride,a=e[t+b]>1;let h,l,c;if(a)h=I(e,t,this.clusterProps),l=e[t],c=e[t+1];else{const s=this.points[e[t+A]];h=s.properties;const[r,o]=s.geometry.coordinates;l=T(r),c=j(o)}const u={type:1,geometry:[[Math.round(this.options.extent*(l*o-s)),Math.round(this.options.extent*(c*o-r))]],tags:h};let p;p=a||this.options.generateId?e[t+A]:this.points[e[t+A]].id,void 0!==p&&(u.id=p),i.features.push(u)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:s,extent:r,reduce:o,minPoints:i}=this.options,n=s/(r*Math.pow(2,e)),a=t.data,h=[],l=this.stride;for(let s=0;s<a.length;s+=l){if(a[s+2]<=e)continue;a[s+2]=e;const r=a[s],c=a[s+1],u=t.within(a[s],a[s+1],n),p=a[s+b];let m=p;for(const t of u){const s=t*l;a[s+2]>e&&(m+=a[s+b])}if(m>p&&m>=i){let t,i=r*p,n=c*p,d=-1;const g=((s/l|0)<<5)+(e+1)+this.points.length;for(const r of u){const h=r*l;if(a[h+2]<=e)continue;a[h+2]=e;const c=a[h+b];i+=a[h]*c,n+=a[h+1]*c,a[h+4]=g,o&&(t||(t=this._map(a,s,!0),d=this.clusterProps.length,this.clusterProps.push(t)),o(t,this._map(a,h)))}a[s+4]=g,h.push(i/m,n/m,1/0,g,-1,m),o&&h.push(d)}else{for(let t=0;t<l;t++)h.push(a[s+t]);if(m>1)for(const t of u){const s=t*l;if(!(a[s+2]<=e)){a[s+2]=e;for(let t=0;t<l;t++)h.push(a[s+t])}}}}return h}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,s){if(t[e+b]>1){const r=this.clusterProps[t[e+L]];return s?Object.assign({},r):r}const r=this.points[t[e+A]].properties,o=this.options.map(r);return s&&o===r?Object.assign({},o):o}}function Z(t,e,s){return{type:\"Feature\",id:t[e+A],properties:I(t,e,s),geometry:{type:\"Point\",coordinates:[(r=t[e],360*(r-.5)),S(t[e+1])]}};var r}function I(t,e,s){const r=t[e+b],o=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+\"k\":r,i=t[e+L],n=-1===i?{}:Object.assign({},s[i]);return Object.assign(n,{cluster:!0,cluster_id:t[e+A],point_count:r,point_count_abbreviated:o})}function T(t){return t/360+.5}function j(t){const e=Math.sin(t*Math.PI/180),s=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return s<0?0:s>1?1:s}function S(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}class z extends u{constructor(t){var{maxZoom:s,radius:r=60}=t,o=e(t,[\"maxZoom\",\"radius\"]);super({maxZoom:s}),this.state={zoom:-1},this.superCluster=new O(Object.assign({maxZoom:this.maxZoom,radius:r},o))}calculate(t){let e=!1;const r={zoom:t.map.getZoom()};if(!f(t.markers,this.markers)){e=!0,this.markers=[...t.markers];const r=this.markers.map((t=>{const e=s.getPosition(t);return{type:\"Feature\",geometry:{type:\"Point\",coordinates:[e.lng(),e.lat()]},properties:{marker:t}}}));this.superCluster.load(r)}return e||(this.state.zoom<=this.maxZoom||r.zoom<=this.maxZoom)&&(e=!f(this.state,r)),this.state=r,e&&(this.clusters=this.cluster(t)),{clusters:this.clusters,changed:e}}cluster(t){let{map:e}=t;return this.superCluster.getClusters([-180,-90,180,90],Math.round(e.getZoom())).map((t=>this.transformCluster(t)))}transformCluster(t){let{geometry:{coordinates:[e,o]},properties:i}=t;if(i.cluster)return new r({markers:this.superCluster.getLeaves(i.cluster_id,1/0).map((t=>t.properties.marker)),position:{lat:o,lng:e}});const n=i.marker;return new r({markers:[n],position:s.getPosition(n)})}}class U{constructor(t,e){this.markers={sum:t.length};const s=e.map((t=>t.count)),r=s.reduce(((t,e)=>t+e),0);this.clusters={count:e.length,markers:{mean:r/e.length,sum:r,min:Math.min(...s),max:Math.max(...s)}}}}class B{render(t,e,r){let{count:o,position:i}=t;const n=`<svg fill=\"${o>Math.max(10,e.clusters.markers.mean)?\"#ff0000\":\"#0000ff\"}\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 240 240\" width=\"50\" height=\"50\">\\n<circle cx=\"120\" cy=\"120\" opacity=\".6\" r=\"70\" />\\n<circle cx=\"120\" cy=\"120\" opacity=\".3\" r=\"90\" />\\n<circle cx=\"120\" cy=\"120\" opacity=\".2\" r=\"110\" />\\n<text x=\"50%\" y=\"50%\" style=\"fill:#fff\" text-anchor=\"middle\" font-size=\"50\" dominant-baseline=\"middle\" font-family=\"roboto,arial,sans-serif\">${o}</text>\\n</svg>`,a=`Cluster of ${o} markers`,h=Number(google.maps.Marker.MAX_ZINDEX)+o;if(s.isAdvancedMarkerAvailable(r)){const t=(new DOMParser).parseFromString(n,\"image/svg+xml\").documentElement;t.setAttribute(\"transform\",\"translate(0 25)\");const e={map:r,position:i,zIndex:h,title:a,content:t};return new google.maps.marker.AdvancedMarkerElement(e)}const l={position:i,zIndex:h,title:a,icon:{url:`data:image/svg+xml;base64,${btoa(n)}`,anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(l)}}class D{constructor(){!function(t,e){for(let s in e.prototype)t.prototype[s]=e.prototype[s]}(D,google.maps.OverlayView)}}var N;t.MarkerClustererEvents=void 0,(N=t.MarkerClustererEvents||(t.MarkerClustererEvents={})).CLUSTERING_BEGIN=\"clusteringbegin\",N.CLUSTERING_END=\"clusteringend\",N.CLUSTER_CLICK=\"click\";const F=(t,e,s)=>{s.fitBounds(e.bounds)};return t.AbstractAlgorithm=u,t.AbstractViewportAlgorithm=p,t.Cluster=r,t.ClusterStats=U,t.DefaultRenderer=B,t.GridAlgorithm=class extends p{constructor(t){var{maxDistance:s=4e4,gridSize:r=40}=t;super(e(t,[\"maxDistance\",\"gridSize\"])),this.clusters=[],this.state={zoom:-1},this.maxDistance=s,this.gridSize=r}calculate(t){let{markers:e,map:s,mapCanvasProjection:r}=t;const i={zoom:s.getZoom()};let n=!1;return this.state.zoom>=this.maxZoom&&i.zoom>=this.maxZoom||(n=!f(this.state,i)),this.state=i,s.getZoom()>=this.maxZoom?{clusters:this.noop({markers:e}),changed:n}:{clusters:this.cluster({markers:o(s,r,e,this.viewportPadding),map:s,mapCanvasProjection:r})}}cluster(t){let{markers:e,map:s,mapCanvasProjection:r}=t;return this.clusters=[],e.forEach((t=>{this.addToClosestCluster(t,s,r)})),this.clusters}addToClosestCluster(t,e,o){let n=this.maxDistance,h=null;for(let e=0;e<this.clusters.length;e++){const r=this.clusters[e],o=a(r.bounds.getCenter().toJSON(),s.getPosition(t).toJSON());o<n&&(n=o,h=r)}if(h&&i(h.bounds,o,this.gridSize).contains(s.getPosition(t)))h.push(t);else{const e=new r({markers:[t]});this.clusters.push(e)}}},t.MarkerClusterer=class extends D{constructor(t){let{map:e,markers:s=[],algorithmOptions:r={},algorithm:o=new z(r),renderer:i=new B,onClusterClick:n=F}=t;super(),this.markers=[...s],this.clusters=[],this.algorithm=o,this.renderer=i,this.onClusterClick=n,e&&this.setMap(e)}addMarker(t,e){this.markers.includes(t)||(this.markers.push(t),e||this.render())}addMarkers(t,e){t.forEach((t=>{this.addMarker(t,!0)})),e||this.render()}removeMarker(t,e){const r=this.markers.indexOf(t);return-1!==r&&(s.setMap(t,null),this.markers.splice(r,1),e||this.render(),!0)}removeMarkers(t,e){let s=!1;return t.forEach((t=>{s=this.removeMarker(t,!0)||s})),s&&!e&&this.render(),s}clearMarkers(t){this.markers.length=0,t||this.render()}render(){const e=this.getMap();if(e instanceof google.maps.Map&&e.getProjection()){google.maps.event.trigger(this,t.MarkerClustererEvents.CLUSTERING_BEGIN,this);const{clusters:r,changed:o}=this.algorithm.calculate({markers:this.markers,map:e,mapCanvasProjection:this.getProjection()});if(o||null==o){const t=new Set;for(const e of r)1==e.markers.length&&t.add(e.markers[0]);const e=[];for(const r of this.clusters)null!=r.marker&&(1==r.markers.length?t.has(r.marker)||s.setMap(r.marker,null):e.push(r.marker));this.clusters=r,this.renderClusters(),requestAnimationFrame((()=>e.forEach((t=>s.setMap(t,null)))))}google.maps.event.trigger(this,t.MarkerClustererEvents.CLUSTERING_END,this)}}onAdd(){this.idleListener=this.getMap().addListener(\"idle\",this.render.bind(this)),this.render()}onRemove(){google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach((t=>s.setMap(t,null))),this.clusters.forEach((t=>t.delete())),this.clusters=[]}renderClusters(){const e=new U(this.markers,this.clusters),r=this.getMap();this.clusters.forEach((o=>{1===o.markers.length?o.marker=o.markers[0]:(o.marker=this.renderer.render(o,e,r),o.markers.forEach((t=>s.setMap(t,null))),this.onClusterClick&&o.marker.addListener(\"click\",(e=>{google.maps.event.trigger(this,t.MarkerClustererEvents.CLUSTER_CLICK,o),this.onClusterClick(e,o,r)}))),s.setMap(o.marker,r)}))}},t.MarkerUtils=s,t.NoopAlgorithm=class extends u{constructor(t){super(e(t,[]))}calculate(t){let{markers:e,map:s,mapCanvasProjection:r}=t;return{clusters:this.cluster({markers:e,map:s,mapCanvasProjection:r}),changed:!1}}cluster(t){return this.noop(t)}},t.SuperClusterAlgorithm=z,t.SuperClusterViewportAlgorithm=class extends p{constructor(t){var{maxZoom:s,radius:r=60,viewportPadding:o=60}=t,i=e(t,[\"maxZoom\",\"radius\",\"viewportPadding\"]);super({maxZoom:s,viewportPadding:o}),this.superCluster=new O(Object.assign({maxZoom:this.maxZoom,radius:r},i)),this.state={zoom:-1,view:[0,0,0,0]}}calculate(t){const e={zoom:Math.round(t.map.getZoom()),view:n(t.map.getBounds(),t.mapCanvasProjection,this.viewportPadding)};let r=!f(this.state,e);if(!f(t.markers,this.markers)){r=!0,this.markers=[...t.markers];const e=this.markers.map((t=>{const e=s.getPosition(t);return{type:\"Feature\",geometry:{type:\"Point\",coordinates:[e.lng(),e.lat()]},properties:{marker:t}}}));this.superCluster.load(e)}return r&&(this.clusters=this.cluster(t),this.state=e),{clusters:this.clusters,changed:r}}cluster(t){let{map:e,mapCanvasProjection:s}=t;const r={zoom:Math.round(e.getZoom()),view:n(e.getBounds(),s,this.viewportPadding)};return this.superCluster.getClusters(r.view,r.zoom).map((t=>this.transformCluster(t)))}transformCluster(t){let{geometry:{coordinates:[e,o]},properties:i}=t;if(i.cluster)return new r({markers:this.superCluster.getLeaves(i.cluster_id,1/0).map((t=>t.properties.marker)),position:{lat:o,lng:e}});const n=i.marker;return new r({markers:[n],position:s.getPosition(n)})}},t.defaultOnClusterClickHandler=F,t.distanceBetweenPoints=a,t.extendBoundsToPaddedViewport=i,t.extendPixelBounds=l,t.filterMarkersToPaddedViewport=o,t.getPaddedViewport=n,t.noop=m,t.pixelBoundsToLatLngBounds=c,Object.defineProperty(t,\"__esModule\",{value:!0}),t}({});\n//# sourceMappingURL=index.min.js.map\n</script><style>\n/*!\n * Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com\n * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)\n * Copyright 2024 Fonticons, Inc.\n */\n:host,:root{--fa-font-solid:normal 900 1em/1 \"Font Awesome 6 Free\";--fa-font-regular:normal 400 1em/1 \"Font Awesome 6 Free\";--fa-font-light:normal 300 1em/1 \"Font Awesome 6 Pro\";--fa-font-thin:normal 100 1em/1 \"Font Awesome 6 Pro\";--fa-font-duotone:normal 900 1em/1 \"Font Awesome 6 Duotone\";--fa-font-duotone-regular:normal 400 1em/1 \"Font Awesome 6 Duotone\";--fa-font-duotone-light:normal 300 1em/1 \"Font Awesome 6 Duotone\";--fa-font-duotone-thin:normal 100 1em/1 \"Font Awesome 6 Duotone\";--fa-font-brands:normal 400 1em/1 \"Font Awesome 6 Brands\";--fa-font-sharp-solid:normal 900 1em/1 \"Font Awesome 6 Sharp\";--fa-font-sharp-regular:normal 400 1em/1 \"Font Awesome 6 Sharp\";--fa-font-sharp-light:normal 300 1em/1 \"Font Awesome 6 Sharp\";--fa-font-sharp-thin:normal 100 1em/1 \"Font Awesome 6 Sharp\";--fa-font-sharp-duotone-solid:normal 900 1em/1 \"Font Awesome 6 Sharp Duotone\";--fa-font-sharp-duotone-regular:normal 400 1em/1 \"Font Awesome 6 Sharp Duotone\";--fa-font-sharp-duotone-light:normal 300 1em/1 \"Font Awesome 6 Sharp Duotone\";--fa-font-sharp-duotone-thin:normal 100 1em/1 \"Font Awesome 6 Sharp Duotone\"}svg.svg-inline--fa:not(:host),svg.svg-inline--fa:not(:root){overflow:visible;box-sizing:initial}.svg-inline--fa{display:var(--fa-display,inline-block);height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-2xs{vertical-align:.1em}.svg-inline--fa.fa-xs{vertical-align:0}.svg-inline--fa.fa-sm{vertical-align:-.07143em}.svg-inline--fa.fa-lg{vertical-align:-.2em}.svg-inline--fa.fa-xl{vertical-align:-.25em}.svg-inline--fa.fa-2xl{vertical-align:-.3125em}.svg-inline--fa.fa-pull-left{margin-right:var(--fa-pull-margin,.3em);width:auto}.svg-inline--fa.fa-pull-right{margin-left:var(--fa-pull-margin,.3em);width:auto}.svg-inline--fa.fa-li{width:var(--fa-li-width,2em);top:.25em}.svg-inline--fa.fa-fw{width:var(--fa-fw-width,1.25em)}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{transform-origin:center center}.fa-layers-text{left:50%;top:50%;transform:translate(-50%,-50%);transform-origin:center center}.fa-layers-counter{background-color:var(--fa-counter-background-color,#ff253a);border-radius:var(--fa-counter-border-radius,1em);box-sizing:border-box;color:var(--fa-inverse,#fff);line-height:var(--fa-counter-line-height,1);max-width:var(--fa-counter-max-width,5em);min-width:var(--fa-counter-min-width,1.5em);overflow:hidden;padding:var(--fa-counter-padding,.25em .5em);right:var(--fa-right,0);text-overflow:ellipsis;top:var(--fa-top,0);transform:scale(var(--fa-counter-scale,.25));transform-origin:top right}.fa-layers-bottom-right{bottom:var(--fa-bottom,0);right:var(--fa-right,0);top:auto;transform:scale(var(--fa-layers-scale,.25));transform-origin:bottom right}.fa-layers-bottom-left{bottom:var(--fa-bottom,0);left:var(--fa-left,0);right:auto;top:auto;transform:scale(var(--fa-layers-scale,.25));transform-origin:bottom left}.fa-layers-top-right{top:var(--fa-top,0);right:var(--fa-right,0);transform:scale(var(--fa-layers-scale,.25));transform-origin:top right}.fa-layers-top-left{left:var(--fa-left,0);right:auto;top:var(--fa-top,0);transform:scale(var(--fa-layers-scale,.25));transform-origin:top left}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-2xs{font-size:.625em;line-height:.1em;vertical-align:.225em}.fa-xs{font-size:.75em;line-height:.08333em;vertical-align:.125em}.fa-sm{font-size:.875em;line-height:.07143em;vertical-align:.05357em}.fa-lg{font-size:1.25em;line-height:.05em;vertical-align:-.075em}.fa-xl{font-size:1.5em;line-height:.04167em;vertical-align:-.125em}.fa-2xl{font-size:2em;line-height:.03125em;vertical-align:-.1875em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:var(--fa-li-margin,2.5em);padding-left:0}.fa-ul>li{position:relative}.fa-li{left:calc(var(--fa-li-width, 2em)*-1);position:absolute;text-align:center;width:var(--fa-li-width,2em);line-height:inherit}.fa-border{border-radius:var(--fa-border-radius,.1em);border:var(--fa-border-width,.08em) var(--fa-border-style,solid) var(--fa-border-color,#eee);padding:var(--fa-border-padding,.2em .25em .15em)}.fa-pull-left{float:left;margin-right:var(--fa-pull-margin,.3em)}.fa-pull-right{float:right;margin-left:var(--fa-pull-margin,.3em)}.fa-beat{animation-name:fa-beat;animation-delay:var(--fa-animation-delay,0s);animation-direction:var(--fa-animation-direction,normal);animation-duration:var(--fa-animation-duration,1s);animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-timing-function:var(--fa-animation-timing,ease-in-out)}.fa-bounce{animation-name:fa-bounce;animation-delay:var(--fa-animation-delay,0s);animation-direction:var(--fa-animation-direction,normal);animation-duration:var(--fa-animation-duration,1s);animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-timing-function:var(--fa-animation-timing,cubic-bezier(.28,.84,.42,1))}.fa-fade{animation-name:fa-fade;animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1))}.fa-beat-fade,.fa-fade{animation-delay:var(--fa-animation-delay,0s);animation-direction:var(--fa-animation-direction,normal);animation-duration:var(--fa-animation-duration,1s)}.fa-beat-fade{animation-name:fa-beat-fade;animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1))}.fa-flip{animation-name:fa-flip;animation-delay:var(--fa-animation-delay,0s);animation-direction:var(--fa-animation-direction,normal);animation-duration:var(--fa-animation-duration,1s);animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-timing-function:var(--fa-animation-timing,ease-in-out)}.fa-shake{animation-name:fa-shake;animation-duration:var(--fa-animation-duration,1s);animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-timing-function:var(--fa-animation-timing,linear)}.fa-shake,.fa-spin{animation-delay:var(--fa-animation-delay,0s);animation-direction:var(--fa-animation-direction,normal)}.fa-spin{animation-name:fa-spin;animation-duration:var(--fa-animation-duration,2s);animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-timing-function:var(--fa-animation-timing,linear)}.fa-spin-reverse{--fa-animation-direction:reverse}.fa-pulse,.fa-spin-pulse{animation-name:fa-spin;animation-direction:var(--fa-animation-direction,normal);animation-duration:var(--fa-animation-duration,1s);animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-timing-function:var(--fa-animation-timing,steps(8))}@media (prefers-reduced-motion:reduce){.fa-beat,.fa-beat-fade,.fa-bounce,.fa-fade,.fa-flip,.fa-pulse,.fa-shake,.fa-spin,.fa-spin-pulse{animation-delay:-1ms;animation-duration:1ms;animation-iteration-count:1;transition-delay:0s;transition-duration:0s}}@keyframes fa-beat{0%,90%{transform:scale(1)}45%{transform:scale(var(--fa-beat-scale,1.25))}}@keyframes fa-bounce{0%{transform:scale(1) translateY(0)}10%{transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0)}30%{transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em))}50%{transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0)}57%{transform:scale(1) translateY(var(--fa-bounce-rebound,-.125em))}64%{transform:scale(1) translateY(0)}to{transform:scale(1) translateY(0)}}@keyframes fa-fade{50%{opacity:var(--fa-fade-opacity,.4)}}@keyframes fa-beat-fade{0%,to{opacity:var(--fa-beat-fade-opacity,.4);transform:scale(1)}50%{opacity:1;transform:scale(var(--fa-beat-fade-scale,1.125))}}@keyframes fa-flip{50%{transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg))}}@keyframes fa-shake{0%{transform:rotate(-15deg)}4%{transform:rotate(15deg)}8%,24%{transform:rotate(-18deg)}12%,28%{transform:rotate(18deg)}16%{transform:rotate(-22deg)}20%{transform:rotate(22deg)}32%{transform:rotate(-12deg)}36%{transform:rotate(12deg)}40%,to{transform:rotate(0deg)}}@keyframes fa-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.fa-rotate-90{transform:rotate(90deg)}.fa-rotate-180{transform:rotate(180deg)}.fa-rotate-270{transform:rotate(270deg)}.fa-flip-horizontal{transform:scaleX(-1)}.fa-flip-vertical{transform:scaleY(-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{transform:scale(-1)}.fa-rotate-by{transform:rotate(var(--fa-rotate-angle,0))}.fa-stack{display:inline-block;vertical-align:middle;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;z-index:var(--fa-stack-z-index,auto)}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:var(--fa-inverse,#fff)}.fa-sr-only,.fa-sr-only-focusable:not(:focus),.sr-only,.sr-only-focusable:not(:focus){position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.svg-inline--fa .fa-primary{fill:var(--fa-primary-color,currentColor);opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:var(--fa-secondary-color,currentColor)}.svg-inline--fa .fa-secondary,.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}\n</style>"
      }
    },
    {
      "position": {
        "col": 11,
        "sizex": 2,
        "row": 1,
        "sizey": 12
      },
      "config": {
        "displaySettings": {},
        "isSupportCustomProperty": false,
        "supportCustomProperty": false,
        "name": "Description",
        "description": "",
        "theme": "newSolidBlue",
        "interval": 15,
        "type": "text",
        "timescale": "day",
        "version": 2,
        "content": "<div style=\"font-size: 0.9em; line-height: 1.25em;\"><h3>Overview:</h3><p id=\"isPasted\">On this dashboard is a fully custom, standalone map widget to overcome many limitations with our core Map widget. The ideas behind this are:</p><ul><li>Support for 1,000+ pins on the map (vs 400) to accommodate larger customers</li><li>Marker clustering to group adjacent pins together until zoomed in (along with easy zoom reset)</li><li>A donut chart to represent the severities of clustered markers</li><li>Quick &amp; easy on-the-fly filtering based on path and severities</li><li>Easy toggling of weather layers, earthquakes, US wildfires, and US power outages</li><li>More informational tips when clicking a pin</li><li>The ability to show colored lines representing connections between locations</li></ul><h3 id=\"isPasted\">Prerequisites:</h3><ul><li>Groups, resources, or services with valid addresses set in the usual &#39;location&#39; property.</li><li>If you want to show connections between locations and their status, load the &quot;Set Better Map Widget Connections&quot; PropertySource (locator 76JC33).</li></ul><h3 id=\"isPasted\">Initial Configuration:</h3><ol><li>Create a new Text widget to the dashboard.</li><li>On the Text widget&#39;s edit dialog, click the &quot;Source&quot; button and paste in the contents of the script, then save the widget.</li><li>Add dashboard tokens to modify the defaults of the widget as desired. A list of token options is provided below. (can also be found at top of the widget&#39;s source script)</li></ol><h3>Usage:</h3><p>Clicking on a marker cluster will display more info about that group, including the option to zoom in to see the clustered markers. To quickly reset the zoom, just click the bottom button in the upper-left corner of the map (the one with the 4 arrows).</p><p>By default the map will auto-refresh every 2 minutes, though that&#39;s configurable by changing the &#39;statusUpdateIntervalMinutes&#39; variable near the top of the script.</p><p>Note that by default the zoom level of the map will <em>not</em> auto-reset on refreshes to ensure that all markers are visible. Enabling that feature can be very useful when filtering on specific severities and new matching items appear, especially when displayed on overhead monitors.</p><p>Visibility of the toolbar along the top of the widget can be toggled using the button in the upper-left corner of the map.</p><h3>Optional Customization:</h3><p>Behavior of the widget can be customized using the following optional dashboard tokens.</p><ul><li id=\"isPasted\"><strong>MapGroupPathFilter</strong>: Allows setting a default group path to start. Default is &quot;<span style=\"font-family: monospace;\">*</span>&quot;.</li><li id=\"isPasted\"><strong>MapShowWeather</strong>: If weather should be shown by default. Options are &quot;global&quot; or &quot;nexrad&quot;. Default is &quot;global&quot;.</li><li id=\"isPasted\"><strong>MapOverlayOption</strong>: Which optional overlay to default to when weather is shown. Options are &quot;wildfires&quot;, &quot;outages&quot;, or &quot;earthquakes&quot;. Default is &quot;wildfires&quot;.</li><li id=\"isPasted\"><strong>HideMapOptions</strong>: If &quot;true&quot; then will hide the options bar by default. Default is &quot;false&quot;.</li><li id=\"isPasted\"><strong>MapSourceType</strong>: Whether to map &quot;groups&quot;, &quot;resources&quot;, or &quot;services&quot;. Default is &quot;groups&quot;.</li><li id=\"isPasted\"><strong>MapIgnoreCleared</strong>: If &quot;true&quot; then will only show items currently alerting (useful for maps with thousands of markers). Default is &quot;false&quot;.</li><li id=\"isPasted\"><strong>MapIgnoreWarnings</strong>: If &quot;true&quot; then won&#39;t show items in &quot;Warning&quot; status. Default is &quot;false&quot;.</li><li id=\"isPasted\"><strong>MapIgnoreErrors</strong>: If &quot;true&quot; then won&#39;t show items in &quot;Error&quot; status. Default is &quot;false&quot;.</li><li id=\"isPasted\"><strong>MapIgnoreCriticals</strong>: If &quot;true&quot; then won&#39;t show items in &quot;Critical&quot; status. Default is &quot;false&quot;.</li><li id=\"isPasted\"><strong>AutoResetMapOnRefresh</strong>: If &quot;true&quot; then the map will automatically zoom to encompass all items on timed refreshes. Default is &quot;false&quot;.</li><li id=\"isPasted\"><strong>MapDisableClustering</strong>: If &quot;true&quot; then clustering of adjacent markers on the map will be disabled. Might be desirable if showing connections between locations since clustering might hide markers at certain zoom levels. Default is &quot;false&quot;.</li><li id=\"isPasted\"><strong>MapDisplayProperties</strong>:&nbsp;An optional comma-delimited list of custom properties to show when viewing a group&#39;s/resource&#39;s details.</li><li id=\"isPasted\"><strong>MapStyle</strong>:&nbsp;Allows one of the following available map style options: &quot;silver&quot;, &quot;standard&quot;, &quot;dark&quot;, &quot;aubergine&quot;, or &quot;silverblue&quot;. Default is &quot;silver&quot;.</li></ul><h3>Showing Connections between Locations</h3><p>You can represent connectivity between locations. This only supports alert status of instances of the &quot;SNMP_Network_Interfaces&quot; datasource and any datasource with &quot;VPN&quot; in the name.</p><p>To configure, go to the specific instance of one of those datasources and add an instance-level property called &#39;custom_map_connection&#39;. The value should be in the following format:</p><p>{Connection Title} &gt; {Hostname/IP of the connected resource}</p><p>For example: &quot;London WAN &gt; 192.168.1.10&quot; would show a line titled &quot;London WAN&quot; representing this specific interface connected to the resource monitored as 192.168.1.10. A PropertySource - &quot;Set Better Map Widget Connections&quot; - configures those instance-level properties as resource-level properties along with other necessary data for the widget to use.</p></div>"
      }
    }
  ],
  "version": 2
}